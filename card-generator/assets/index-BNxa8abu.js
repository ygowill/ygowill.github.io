import{r as C,c as We,g as Ae,R as U}from"./vendor-BTWMFwqw.js";import{T as pe,S as Ie,a as w,B as $,b as A,D as ae,R as H,c as xe,d as le,e as Ye,U as Ue,I as Be,f as qe,g as Ge,h as Qe,A as ce,P as de,L as ye,i as Ke,j as Ve,k as Xe,l as Ze,m as Je,E as Q,n as et,o as tt,s as T,C as nt}from"./antd--KInuYqN.js";import{P as it,r as K}from"./pdf-CWo3jOmf.js";(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function l(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(r){if(r.ep)return;r.ep=!0;const o=l(r);fetch(r.href,o)}})();var ze={exports:{}},V={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var st=C,rt=Symbol.for("react.element"),ot=Symbol.for("react.fragment"),at=Object.prototype.hasOwnProperty,lt=st.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,ct={key:!0,ref:!0,__self:!0,__source:!0};function Te(t,n,l){var i,r={},o=null,c=null;l!==void 0&&(o=""+l),n.key!==void 0&&(o=""+n.key),n.ref!==void 0&&(c=n.ref);for(i in n)at.call(n,i)&&!ct.hasOwnProperty(i)&&(r[i]=n[i]);if(t&&t.defaultProps)for(i in n=t.defaultProps,n)r[i]===void 0&&(r[i]=n[i]);return{$$typeof:rt,type:t,key:o,ref:c,props:r,_owner:lt.current}}V.Fragment=ot;V.jsx=Te;V.jsxs=Te;ze.exports=V;var e=ze.exports,he={},ve=We;he.createRoot=ve.createRoot,he.hydrateRoot=ve.hydrateRoot;var X={},ke={exports:{}};(function(t){function n(l){return l&&l.__esModule?l:{default:l}}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports})(ke);var Z=ke.exports,J={};Object.defineProperty(J,"__esModule",{value:!0});J.default=void 0;var dt={items_per_page:"条/页",jump_to:"跳至",jump_to_confirm:"确定",page:"页",prev_page:"上一页",next_page:"下一页",prev_5:"向前 5 页",next_5:"向后 5 页",prev_3:"向前 3 页",next_3:"向后 3 页",page_size:"页码"};J.default=dt;var ee={},q={},te={},De={exports:{}},Ee={exports:{}},Le={exports:{}},Me={exports:{}};(function(t){function n(l){"@babel/helpers - typeof";return t.exports=n=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(i){return typeof i}:function(i){return i&&typeof Symbol=="function"&&i.constructor===Symbol&&i!==Symbol.prototype?"symbol":typeof i},t.exports.__esModule=!0,t.exports.default=t.exports,n(l)}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports})(Me);var Re=Me.exports,Ne={exports:{}};(function(t){var n=Re.default;function l(i,r){if(n(i)!="object"||!i)return i;var o=i[Symbol.toPrimitive];if(o!==void 0){var c=o.call(i,r||"default");if(n(c)!="object")return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(i)}t.exports=l,t.exports.__esModule=!0,t.exports.default=t.exports})(Ne);var ht=Ne.exports;(function(t){var n=Re.default,l=ht;function i(r){var o=l(r,"string");return n(o)=="symbol"?o:o+""}t.exports=i,t.exports.__esModule=!0,t.exports.default=t.exports})(Le);var gt=Le.exports;(function(t){var n=gt;function l(i,r,o){return(r=n(r))in i?Object.defineProperty(i,r,{value:o,enumerable:!0,configurable:!0,writable:!0}):i[r]=o,i}t.exports=l,t.exports.__esModule=!0,t.exports.default=t.exports})(Ee);var pt=Ee.exports;(function(t){var n=pt;function l(r,o){var c=Object.keys(r);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(r);o&&(a=a.filter(function(h){return Object.getOwnPropertyDescriptor(r,h).enumerable})),c.push.apply(c,a)}return c}function i(r){for(var o=1;o<arguments.length;o++){var c=arguments[o]!=null?arguments[o]:{};o%2?l(Object(c),!0).forEach(function(a){n(r,a,c[a])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(c)):l(Object(c)).forEach(function(a){Object.defineProperty(r,a,Object.getOwnPropertyDescriptor(c,a))})}return r}t.exports=i,t.exports.__esModule=!0,t.exports.default=t.exports})(De);var ut=De.exports,ne={};Object.defineProperty(ne,"__esModule",{value:!0});ne.commonLocale=void 0;ne.commonLocale={yearFormat:"YYYY",dayFormat:"D",cellMeridiemFormat:"A",monthBeforeYear:!0};var mt=Z.default;Object.defineProperty(te,"__esModule",{value:!0});te.default=void 0;var je=mt(ut),ft=ne,xt=(0,je.default)((0,je.default)({},ft.commonLocale),{},{locale:"zh_CN",today:"今天",now:"此刻",backToToday:"返回今天",ok:"确定",timeSelect:"选择时间",dateSelect:"选择日期",weekSelect:"选择周",clear:"清除",week:"周",month:"月",year:"年",previousMonth:"上个月 (翻页上键)",nextMonth:"下个月 (翻页下键)",monthSelect:"选择月份",yearSelect:"选择年份",decadeSelect:"选择年代",previousYear:"上一年 (Control键加左方向键)",nextYear:"下一年 (Control键加右方向键)",previousDecade:"上一年代",nextDecade:"下一年代",previousCentury:"上一世纪",nextCentury:"下一世纪",yearFormat:"YYYY年",cellDateFormat:"D",monthBeforeYear:!1});te.default=xt;var G={};Object.defineProperty(G,"__esModule",{value:!0});G.default=void 0;const yt={placeholder:"请选择时间",rangePlaceholder:["开始时间","结束时间"]};G.default=yt;var Oe=Z.default;Object.defineProperty(q,"__esModule",{value:!0});q.default=void 0;var vt=Oe(te),jt=Oe(G);const He={lang:Object.assign({placeholder:"请选择日期",yearPlaceholder:"请选择年份",quarterPlaceholder:"请选择季度",monthPlaceholder:"请选择月份",weekPlaceholder:"请选择周",rangePlaceholder:["开始日期","结束日期"],rangeYearPlaceholder:["开始年份","结束年份"],rangeMonthPlaceholder:["开始月份","结束月份"],rangeQuarterPlaceholder:["开始季度","结束季度"],rangeWeekPlaceholder:["开始周","结束周"]},vt.default),timePickerLocale:Object.assign({},jt.default)};He.lang.ok="确定";q.default=He;var wt=Z.default;Object.defineProperty(ee,"__esModule",{value:!0});ee.default=void 0;var Pt=wt(q);ee.default=Pt.default;var ie=Z.default;Object.defineProperty(X,"__esModule",{value:!0});X.default=void 0;var bt=ie(J),Ct=ie(ee),$t=ie(q),St=ie(G);const b="${label}不是一个有效的${type}",_t={locale:"zh-cn",Pagination:bt.default,DatePicker:$t.default,TimePicker:St.default,Calendar:Ct.default,global:{placeholder:"请选择",close:"关闭"},Table:{filterTitle:"筛选",filterConfirm:"确定",filterReset:"重置",filterEmptyText:"无筛选项",filterCheckAll:"全选",filterSearchPlaceholder:"在筛选项中搜索",emptyText:"暂无数据",selectAll:"全选当页",selectInvert:"反选当页",selectNone:"清空所有",selectionAll:"全选所有",sortTitle:"排序",expand:"展开行",collapse:"关闭行",triggerDesc:"点击降序",triggerAsc:"点击升序",cancelSort:"取消排序"},Modal:{okText:"确定",cancelText:"取消",justOkText:"知道了"},Tour:{Next:"下一步",Previous:"上一步",Finish:"结束导览"},Popconfirm:{cancelText:"取消",okText:"确定"},Transfer:{titles:["",""],searchPlaceholder:"请输入搜索内容",itemUnit:"项",itemsUnit:"项",remove:"删除",selectCurrent:"全选当页",removeCurrent:"删除当页",selectAll:"全选所有",deselectAll:"取消全选",removeAll:"删除全部",selectInvert:"反选当页"},Upload:{uploading:"文件上传中",removeFile:"删除文件",uploadError:"上传错误",previewFile:"预览文件",downloadFile:"下载文件"},Empty:{description:"暂无数据"},Icon:{icon:"图标"},Text:{edit:"编辑",copy:"复制",copied:"复制成功",expand:"展开",collapse:"收起"},Form:{optional:"（可选）",defaultValidateMessages:{default:"字段验证错误${label}",required:"请输入${label}",enum:"${label}必须是其中一个[${enum}]",whitespace:"${label}不能为空字符",date:{format:"${label}日期格式无效",parse:"${label}不能转换为日期",invalid:"${label}是一个无效日期"},types:{string:b,method:b,array:b,object:b,number:b,date:b,boolean:b,integer:b,float:b,regexp:b,email:b,url:b,hex:b},string:{len:"${label}须为${len}个字符",min:"${label}最少${min}个字符",max:"${label}最多${max}个字符",range:"${label}须在${min}-${max}字符之间"},number:{len:"${label}必须等于${len}",min:"${label}最小值为${min}",max:"${label}最大值为${max}",range:"${label}须在${min}-${max}之间"},array:{len:"须为${len}个${label}",min:"最少${min}个${label}",max:"最多${max}个${label}",range:"${label}数量须在${min}-${max}之间"},pattern:{mismatch:"${label}与模式不匹配${pattern}"}}},Image:{preview:"预览"},QRCode:{expired:"二维码过期",refresh:"点击刷新",scanned:"已扫描"},ColorPicker:{presetEmpty:"暂无",transparent:"无色",singleColor:"单色",gradientColor:"渐变色"}};X.default=_t;var It=X;const zt=Ae(It),{Title:Y,Text:j}=pe,{Option:Tt}=Ie,we=[{name:"标准卡",size:{width:5.9,height:8.6}},{name:"小卡",size:{width:4.2,height:6.1}},{name:"正方形",size:{width:6,height:6}},{name:"自定义",size:{width:0,height:0}}],kt=({layout:t,onChange:n})=>{const l=s=>{n({...t,...s})},i=s=>{l({cardSize:{...t.cardSize,...s}})},r=s=>{l({spacing:{...t.spacing,...s}})},o=s=>{l({pageSettings:{...t.pageSettings,...s}})},c=s=>{l({imageQuality:{...t.imageQuality,...s}})},a=s=>{s.name!=="自定义"&&i(s.size)},h=()=>{for(const s of we)if(s.name!=="自定义"&&s.size.width===t.cardSize.width&&s.size.height===t.cardSize.height)return s.name;return"自定义"};return e.jsxs("div",{className:"settings-panel",children:[e.jsx("div",{className:"section-title",children:e.jsx(Y,{level:4,children:"排版设置"})}),e.jsxs("div",{className:"form-section",children:[e.jsx(Y,{level:5,style:{marginTop:0,marginBottom:12},children:"卡片尺寸 (厘米)"}),e.jsxs(w,{direction:"vertical",style:{width:"100%"},children:[e.jsx(j,{type:"secondary",children:"预设尺寸:"}),e.jsx("div",{className:"size-presets",children:we.map(s=>e.jsx($,{type:h()===s.name?"primary":"default",size:"small",onClick:()=>a(s),style:{height:"auto",padding:"8px 12px"},children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{children:s.name}),s.name!=="自定义"&&e.jsxs("div",{style:{fontSize:"10px",opacity:.7},children:[s.size.width,"×",s.size.height]})]})},s.name))}),e.jsxs(w,{children:[e.jsxs("div",{children:[e.jsx(j,{children:"宽度:"}),e.jsx(A,{value:t.cardSize.width,onChange:s=>i({width:s||0}),min:1,max:15,step:.1,precision:1,addonAfter:"cm",style:{width:100}})]}),e.jsxs("div",{children:[e.jsx(j,{children:"高度:"}),e.jsx(A,{value:t.cardSize.height,onChange:s=>i({height:s||0}),min:1,max:20,step:.1,precision:1,addonAfter:"cm",style:{width:100}})]})]})]})]}),e.jsxs("div",{className:"form-section",style:{marginTop:16},children:[e.jsx(Y,{level:5,style:{marginBottom:12},children:"卡片间距 (厘米)"}),e.jsxs(w,{direction:"vertical",style:{width:"100%"},children:[e.jsxs("div",{children:[e.jsx(j,{children:"水平间距:"}),e.jsx(A,{value:t.spacing.horizontal,onChange:s=>r({horizontal:s||0}),min:0,max:5,step:.1,precision:1,addonAfter:"cm",style:{width:120,marginLeft:8}})]}),e.jsxs("div",{children:[e.jsx(j,{children:"垂直间距:"}),e.jsx(A,{value:t.spacing.vertical,onChange:s=>r({vertical:s||0}),min:0,max:5,step:.1,precision:1,addonAfter:"cm",style:{width:120,marginLeft:8}})]})]})]}),e.jsxs("div",{className:"form-section",style:{marginTop:16},children:[e.jsx(Y,{level:5,style:{marginBottom:12},children:"页面设置"}),e.jsxs(w,{direction:"vertical",style:{width:"100%"},children:[e.jsxs("div",{children:[e.jsx(j,{children:"页边距:"}),e.jsx(A,{value:t.pageSettings.margin,onChange:s=>o({margin:s||0}),min:0,max:5,step:.1,precision:1,addonAfter:"cm",style:{width:120,marginLeft:8}})]}),e.jsxs("div",{children:[e.jsx(j,{children:"纸张尺寸:"}),e.jsx(Ie,{value:"A4",style:{width:"100%",marginTop:4},disabled:!0,children:e.jsx(Tt,{value:"A4",children:"A4 (21.0 × 29.7 cm)"})})]})]})]}),e.jsx(ae,{style:{margin:"16px 0"}}),e.jsxs("div",{className:"form-section",children:[e.jsx(Y,{level:5,style:{marginTop:0,marginBottom:12},children:"图片设置"}),e.jsxs(w,{direction:"vertical",style:{width:"100%"},children:[e.jsxs("div",{children:[e.jsx(j,{children:"裁剪模式:"}),e.jsxs(H.Group,{value:t.cropMode,onChange:s=>l({cropMode:s.target.value}),style:{marginTop:8},children:[e.jsx(H.Button,{value:"fit",children:"等比缩放"}),e.jsx(H.Button,{value:"fill",children:"裁剪适应"})]})]}),e.jsxs("div",{children:[e.jsx(j,{children:"图片质量:"}),e.jsx("div",{style:{marginTop:8},children:e.jsxs(w,{direction:"vertical",style:{width:"100%"},children:[e.jsxs("div",{children:[e.jsxs(j,{type:"secondary",style:{fontSize:12},children:["分辨率倍数: ",t.imageQuality.resolution,"x"]}),e.jsx(xe,{title:"更高的分辨率会提升图片清晰度，但会增加文件大小和处理时间",children:e.jsx(le,{value:t.imageQuality.resolution,onChange:s=>c({resolution:s}),min:1,max:4,step:1,marks:{1:"1x",2:"2x",3:"3x",4:"4x"},style:{marginTop:4}})})]}),e.jsxs("div",{children:[e.jsxs(j,{type:"secondary",style:{fontSize:12},children:["压缩质量: ",Math.round(t.imageQuality.quality*100),"%"]}),e.jsx(xe,{title:"更高的质量会保持更多细节，但会增加文件大小",children:e.jsx(le,{value:t.imageQuality.quality,onChange:s=>c({quality:s}),min:.5,max:1,step:.05,marks:{.5:"50%",.75:"75%",.9:"90%",1:"100%"},style:{marginTop:4}})})]}),e.jsxs("div",{children:[e.jsx(j,{type:"secondary",style:{fontSize:12},children:"输出格式:"}),e.jsxs(H.Group,{value:t.imageQuality.format,onChange:s=>c({format:s.target.value}),style:{marginTop:4},children:[e.jsx(H.Button,{value:"png",children:"PNG (无损)"}),e.jsx(H.Button,{value:"jpeg",children:"JPEG (小文件)"})]})]})]})})]}),e.jsxs("div",{style:{marginTop:16},children:[e.jsxs(w,{align:"center",children:[e.jsx(j,{children:"显示切割线:"}),e.jsx(Ye,{checked:t.showCuttingLines,onChange:s=>n({...t,showCuttingLines:s})})]}),e.jsx("div",{style:{marginTop:4},children:e.jsx(j,{type:"secondary",style:{fontSize:12},children:"在每张卡片右下角显示切割参考线"})})]}),e.jsx("div",{style:{marginTop:16,padding:"8px 12px",backgroundColor:"#f9f9f9",borderRadius:"4px",border:"1px solid #e8e8e8"},children:e.jsxs(j,{type:"secondary",style:{fontSize:12},children:[e.jsx("div",{children:"• 等比缩放: 保持图片比例，可能有留白"}),e.jsx("div",{children:"• 裁剪适应: 填满卡片区域，可能裁剪图片"}),e.jsx("div",{children:"• PNG: 最佳质量，较大文件"}),e.jsx("div",{children:"• JPEG: 较小文件，轻微质量损失"}),e.jsx("div",{children:"• 切割线: 便于精确切割卡片"})]})})]})]})]})};function Pe(t){const n=t.split(`
`).map(r=>r.trim()).filter(r=>r),l={main:[],extra:[],side:[]};let i=null;for(const r of n){if(r.startsWith("#")||r.startsWith("!")){const o=r.toLowerCase();o.includes("main")?i="main":o.includes("extra")?i="extra":o.includes("side")&&(i="side");continue}/^\d+$/.test(r)&&i&&l[i].push(r)}return l}function be(t,n=!0,l=!1){const i=[...t.main,...n?t.extra:[],...l?t.side:[]],r=new Map,o=new Map;for(let a=0;a<i.length;a++){const h=i[a];r.set(h,(r.get(h)||0)+1),o.has(h)||o.set(h,a)}const c=[];for(const[a,h]of r)c.push({id:a,count:h,hasImage:!1,firstIndex:o.get(a)||0});return c.sort((a,h)=>(a.firstIndex||0)-(h.firstIndex||0))}function Ce(t){return!t||t.trim().length===0?!1:t.split(`
`).map(i=>i.trim()).filter(i=>i).some(i=>/^\d{8}$/.test(i))}function Dt(t){return new Promise((n,l)=>{const i=new FileReader;i.onload=r=>{var c;const o=(c=r.target)==null?void 0:c.result;n(o)},i.onerror=()=>{l(new Error("读取文件失败"))},i.readAsText(t,"utf-8")})}const{Dragger:Et}=Ue,{Title:Lt,Text:S}=pe,{TextArea:Mt}=Be,Rt=({cards:t,imageStatus:n,onCardsChange:l,onImageFolderSelect:i,hasImageFolder:r})=>{const[o,c]=C.useState(""),[a,h]=C.useState(!1);C.useRef(null);const s=async p=>{try{const x=await Dt(p);if(!Ce(x))throw new Error("无效的YDK文件格式");const y=Pe(x),v=be(y,!0,!0);console.log("YDK解析结果:",{main:y.main.length,extra:y.extra.length,side:y.side.length,总卡片数:v.length}),l(v),c(x)}catch(x){console.error("YDK文件解析失败:",x)}return!1},g=()=>{try{if(!Ce(o))throw new Error("无效的YDK格式");const p=Pe(o),x=be(p,!0,!0);console.log("YDK文本解析结果:",{main:p.main.length,extra:p.extra.length,side:p.side.length,总卡片数:x.length}),l(x),h(!1)}catch(p){console.error("YDK文本解析失败:",p)}},d=()=>{l([]),c("")},f=(()=>{const p=t.reduce((v,k)=>v+k.count,0),x=t.filter(v=>v.hasImage).reduce((v,k)=>v+k.count,0),y=p-x;return{total:p,found:x,missing:y}})();return e.jsxs("div",{className:"deck-panel",children:[e.jsx("div",{className:"section-title",children:e.jsx(Lt,{level:4,children:"卡组管理"})}),e.jsxs("div",{style:{padding:"16px"},children:[e.jsxs(w,{direction:"vertical",style:{width:"100%"},children:[a?e.jsxs("div",{children:[e.jsx(Mt,{value:o,onChange:p=>c(p.target.value),placeholder:"粘贴YDK文本内容...",rows:6,style:{marginBottom:12}}),e.jsxs(w,{children:[e.jsx($,{type:"primary",onClick:g,children:"导入"}),e.jsx($,{onClick:()=>h(!1),children:"取消"})]})]}):e.jsxs(Et,{accept:".ydk",beforeUpload:s,showUploadList:!1,style:{padding:"20px 16px"},children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(qe,{})}),e.jsx("p",{className:"ant-upload-text",children:"点击或拖拽YDK文件到此区域"}),e.jsx("p",{className:"ant-upload-hint",children:"支持.ydk格式的卡组文件"})]}),e.jsx("div",{children:e.jsxs(w,{children:[e.jsx($,{icon:e.jsx(Ge,{}),onClick:()=>h(!a),size:"small",children:a?"文件上传":"文本导入"}),t.length>0&&e.jsx($,{onClick:d,size:"small",danger:!0,children:"清空卡组"})]})})]}),e.jsx(ae,{}),e.jsx("div",{style:{marginBottom:16},children:e.jsxs(w,{direction:"vertical",style:{width:"100%"},children:[e.jsx(S,{strong:!0,children:"图片文件夹:"}),e.jsx($,{icon:e.jsx(Qe,{}),onClick:i,type:r?"default":"primary",block:!0,children:r?"重新选择图片文件夹":"选择图片文件夹"}),r&&e.jsx(ce,{message:"图片文件夹已选择",description:"文件命名格式: 卡片ID.jpg 或 卡片ID_卡片名.jpg",type:"success",showIcon:!0,size:"small"})]})}),e.jsx(ae,{}),t.length>0&&e.jsx("div",{style:{marginBottom:16},children:e.jsxs(w,{direction:"vertical",style:{width:"100%"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(S,{strong:!0,children:"卡组统计:"}),e.jsxs(S,{children:[t.length," 种卡片"]})]}),e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4},children:[e.jsx(S,{children:"总卡片数:"}),e.jsx(S,{children:f.total})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:4},children:[e.jsx(S,{style:{color:"#52c41a"},children:"已找到:"}),e.jsx(S,{children:f.found})]}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-between"},children:[e.jsx(S,{style:{color:"#ff4d4f"},children:"缺失:"}),e.jsx(S,{children:f.missing})]})]}),f.total>0&&e.jsx(de,{percent:Math.round(f.found/f.total*100),status:f.missing>0?"active":"success",size:"small"})]})}),n.isProcessing&&e.jsxs("div",{style:{marginBottom:16},children:[e.jsx(S,{children:"正在加载图片..."}),e.jsx(de,{percent:Math.round(n.loaded/n.total*100),size:"small"})]})]}),t.length>0&&e.jsx("div",{className:"deck-list",children:e.jsx(ye,{size:"small",dataSource:t,renderItem:p=>e.jsx(ye.Item,{className:"card-list-item",children:e.jsxs("div",{style:{display:"flex",alignItems:"center",width:"100%"},children:[e.jsx("div",{className:`card-status ${p.hasImage?"found":"missing"}`}),e.jsxs("div",{className:"card-info",style:{flex:1},children:[e.jsx("div",{className:"card-id",children:p.id}),p.name&&e.jsx("div",{style:{fontSize:12,color:"#666"},children:p.name})]}),e.jsx("div",{children:e.jsxs(Ke,{color:p.hasImage?"success":"error",children:[p.count,"张"]})})]})})})}),n.missing.length>0&&e.jsx("div",{style:{padding:"16px"},children:e.jsx(ce,{message:`缺失 ${n.missing.length} 张卡片图片`,description:e.jsx("div",{style:{marginTop:8},children:e.jsxs(S,{type:"secondary",style:{fontSize:12},children:["缺失的卡片ID: ",n.missing.slice(0,5).join(", "),n.missing.length>5&&"..."]})}),type:"warning",showIcon:!0,size:"small"})})]})},Nt=[".jpg",".jpeg",".png",".webp"];async function Ot(t,n,l){const i=[...n],r=[];let o=0;const c=n.length,a=new Map,h=[];try{for await(const[s,g]of t.entries())if(g.kind==="file"){const d=await g.getFile(),m=s.toLowerCase().substring(s.lastIndexOf("."));if(Nt.includes(m)){h.push(s);const f=[/^(\d{8})(?:[_\-\.]|$)/,/^(\d+)(?:[_\-\.]|$)/];let p=null;for(const x of f){const y=s.match(x);if(y){p=y[1],p=p.padStart(8,"0");break}}if(p){a.set(p,d);const x=p.replace(/^0+/,"")||"0";x!==p&&a.set(x,d),console.log(`找到图片: ${s} -> 卡片ID: ${p} (也映射为: ${x})`)}else console.warn(`无法解析图片文件名: ${s}`)}}console.log(`扫描完成，找到 ${h.length} 个图片文件:`,h),console.log(`成功匹配 ${a.size} 个卡片ID:`,Array.from(a.keys())),console.log("需要查找的卡片ID:",n.map(s=>s.id));for(let s=0;s<i.length;s++){const g=i[s];let d=a.get(g.id);if(!d){const m=g.id.replace(/^0+/,"")||"0",f=m.padStart(8,"0");d=a.get(f),d||(d=a.get(m)),d&&console.log(`通过变换ID找到图片: ${g.id} -> ${m} -> ${d.name}`)}if(d){const m=URL.createObjectURL(d);i[s]={...g,imageUrl:m,hasImage:!0},o++,console.log(`成功加载图片: ${g.id} -> ${d.name}`)}else r.push(g.id),i[s]={...g,hasImage:!1},console.warn(`未找到图片: ${g.id}`);l&&l(o,c,r)}}catch(s){throw console.error("加载图片时出错:",s),new Error("无法访问图片文件夹")}return i}function Ht(t){return new Promise((n,l)=>{const i=new Image;i.onload=()=>n(i),i.onerror=()=>l(new Error(`图片加载失败: ${t}`)),i.src=t})}function Ft(t,n,l,i="fill",r=2){const o=document.createElement("canvas"),c=o.getContext("2d"),a=n*r,h=l*r;o.width=a,o.height=h,c.imageSmoothingEnabled=!0,c.imageSmoothingQuality="high",c.fillStyle="#ffffff",c.fillRect(0,0,a,h);const{width:s,height:g}=t,d=n/l,m=s/g;let f,p,x,y;return i==="fit"?m>d?(f=a,p=a/m,x=0,y=(h-p)/2):(p=h,f=h*m,x=(a-f)/2,y=0):m>d?(p=h,f=h*m,x=(a-f)/2,y=0):(f=a,p=a/m,x=0,y=(h-p)/2),c.drawImage(t,x,y,f,p),o}function Wt(t){for(const n of t)n.imageUrl&&URL.revokeObjectURL(n.imageUrl)}const R=28.35;function se(t){const{cardSize:n,spacing:l,pageSettings:i}=t,r=n.width*R,o=n.height*R,c=l.horizontal*R,a=l.vertical*R,h=i.margin*R,s=i.width*R,g=i.height*R,d=s-2*h,m=g-2*h,f=Math.floor(c===0?d/r:(d+c)/(r+c)),p=Math.floor(a===0?m/o:(m+a)/(o+a)),x=f*p;return{columns:f,rows:p,cardsPerPage:x,cardWidthPt:r,cardHeightPt:o,spacingHPt:c,spacingVPt:a,marginPt:h,pageWidthPt:s,pageHeightPt:g,availableWidth:d,availableHeight:m}}function Fe(t,n){const l=se(n),i=[],r=[];for(const o of t)for(let c=0;c<o.count;c++)r.push({...o,count:1});for(let o=0;o<r.length;o+=l.cardsPerPage){const c=r.slice(o,o+l.cardsPerPage);i.push({cards:c,layout:{columns:l.columns,rows:l.rows}})}return i}async function At(t,n,l){const i=se(n),r=Fe(t,n);l&&l(0,r.length,"初始化PDF文档...");const o=await it.create(),c=new Map,a=t.filter(s=>s.hasImage&&s.imageUrl);l&&l(0,a.length,"预加载图片...");for(let s=0;s<a.length;s++){const g=a[s];if(g.imageUrl&&!c.has(g.id))try{const d=await Ht(g.imageUrl);c.set(g.id,d)}catch(d){console.warn(`图片加载失败: ${g.id}`,d)}l&&l(s+1,a.length,"预加载图片...")}for(let s=0;s<r.length;s++){const g=r[s];l&&l(s+1,r.length,`生成第${s+1}页...`);const d=o.addPage([i.pageWidthPt,i.pageHeightPt]);for(let m=0;m<g.cards.length;m++){const f=g.cards[m],p=m%g.layout.columns,x=Math.floor(m/g.layout.columns),y=i.spacingHPt===0?i.marginPt+p*i.cardWidthPt:i.marginPt+p*(i.cardWidthPt+i.spacingHPt),v=i.spacingVPt===0?i.pageHeightPt-i.marginPt-(x+1)*i.cardHeightPt:i.pageHeightPt-i.marginPt-(x+1)*(i.cardHeightPt+i.spacingVPt)+i.spacingVPt;if(f.hasImage&&f.imageUrl&&c.has(f.id)){const k=c.get(f.id),u=Ft(k,i.cardWidthPt,i.cardHeightPt,n.cropMode,n.imageQuality.resolution),P=Yt(u,n.imageQuality.quality,n.imageQuality.format),z=n.imageQuality.format==="png"?await o.embedPng(P):await o.embedJpg(P);d.drawImage(z,{x:y,y:v,width:i.cardWidthPt,height:i.cardHeightPt}),n.showCuttingLines&&Bt(d,y,v,i.cardWidthPt,i.cardHeightPt,i.pageHeightPt)}else d.drawRectangle({x:y,y:v,width:i.cardWidthPt,height:i.cardHeightPt,borderColor:K(.8,.8,.8),borderWidth:1,color:K(.95,.95,.95)}),d.drawText(f.id||"未知",{x:y+i.cardWidthPt/2-30,y:v+i.cardHeightPt/2,size:8,color:K(.5,.5,.5)})}}return l&&l(r.length,r.length,"保存PDF文件..."),await o.save()}function Yt(t,n=.95,l="png"){const i=l==="png"?"image/png":"image/jpeg",o=t.toDataURL(i,n).split(",")[1],c=atob(o),a=new Uint8Array(c.length);for(let h=0;h<c.length;h++)a[h]=c.charCodeAt(h);return a}function Ut(t,n="yugioh_cards.pdf"){const l=new Blob([t],{type:"application/pdf"}),i=URL.createObjectURL(l),r=document.createElement("a");r.href=i,r.download=n,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(i)}function Bt(t,n,l,i,r,o){const c=K(.6,.6,.6),a=1,h=a/2,s=n+i+h,g=l-h;t.drawLine({start:{x:0,y:g},end:{x:s,y:g},thickness:a,color:c}),t.drawLine({start:{x:s,y:0},end:{x:s,y:o},thickness:a,color:c})}function qt(){return{cardSize:{width:5.9,height:8.6},spacing:{horizontal:.6,vertical:.6},pageSettings:{width:21,height:29.7,margin:.6},cropMode:"fill",orientation:"portrait",imageQuality:{resolution:3,quality:.95,format:"png"},showCuttingLines:!0}}function $e(t){const n=se(t);console.log("=== 布局调试信息 ==="),console.log("页面尺寸 (pt):",{width:n.pageWidthPt,height:n.pageHeightPt}),console.log("页边距 (pt):",n.marginPt),console.log("可用区域 (pt):",{width:n.availableWidth,height:n.availableHeight}),console.log("卡片尺寸 (pt):",{width:n.cardWidthPt,height:n.cardHeightPt}),console.log("间距 (pt):",{horizontal:n.spacingHPt,vertical:n.spacingVPt}),console.log("网格:",{columns:n.columns,rows:n.rows}),console.log("每页卡片数:",n.cardsPerPage);const l=n.spacingHPt===0?n.columns*n.cardWidthPt:n.columns*n.cardWidthPt+(n.columns-1)*n.spacingHPt,i=n.spacingVPt===0?n.rows*n.cardHeightPt:n.rows*n.cardHeightPt+(n.rows-1)*n.spacingVPt;if(console.log("实际使用区域 (pt):",{width:l,height:i}),console.log("剩余空间 (pt):",{width:n.availableWidth-l,height:n.availableHeight-i}),n.columns>0&&n.rows>0){const r=n.marginPt,o=n.pageHeightPt-n.marginPt-n.cardHeightPt;if(console.log("第一张卡片位置 (pt):",{x:r,y:o}),n.columns>1){const c=n.spacingHPt===0?n.marginPt+n.cardWidthPt:n.marginPt+n.cardWidthPt+n.spacingHPt;console.log("第二张卡片位置 (pt):",{x:c,y:o})}}return n}const B=()=>window.innerWidth<=768,ge=()=>window.innerWidth<=480,Gt=()=>"ontouchstart"in window||navigator.maxTouchPoints>0,Se=()=>ge()?30:B()?50:80,Qt=()=>{if(!B())return;const t=document.querySelector("meta[name=viewport]"),n=t==null?void 0:t.content;document.addEventListener("focusin",l=>{(l.target instanceof HTMLInputElement||l.target instanceof HTMLTextAreaElement)&&t&&(t.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no")}),document.addEventListener("focusout",()=>{t&&n&&(t.content=n)})},Kt=()=>{typeof window>"u"||(Qt(),B()&&document.body.classList.add("mobile-device"),Gt()&&document.body.classList.add("touch-device"),ge()&&document.body.classList.add("small-screen"),window.addEventListener("orientationchange",()=>{setTimeout(()=>{window.scrollTo(0,0)},100)}),window.addEventListener("resize",()=>{const t=document.body;t.classList.toggle("mobile-device",B()),t.classList.toggle("small-screen",ge())}))},{Title:Vt,Text:_e}=pe,Xt=({cards:t,layout:n,isGenerating:l,onGeneratePdf:i,hasImageFolder:r})=>{const[o,c]=U.useState(()=>Se()),[a,h]=U.useState(1);C.useEffect(()=>{const u=()=>{B()&&c(Se())};return window.addEventListener("resize",u),()=>window.removeEventListener("resize",u)},[]);const s=C.useMemo(()=>{if(t.length===0)return{pages:[],layoutInfo:null};const u=se(n),P=Fe(t,n);return n.spacing.horizontal===0&&n.spacing.vertical===0&&(console.log("调试零间距布局:"),$e(n)),n.pageSettings.margin!==1&&(console.log(`调试页边距 ${n.pageSettings.margin}cm:`),$e(n)),{pages:P,layoutInfo:u}},[t,n]),{pages:g,layoutInfo:d}=s,m=U.useCallback(()=>{if(!d)return 80;const u=document.querySelector(".preview-content");if(!u)return 80;const P=u.clientWidth-40;let z=40;g.length>1&&(z+=80);const N=u.clientHeight-z,_=d.pageWidthPt,D=d.pageHeightPt,E=P/_*100,O=N/D*100,I=Math.min(E,O,400);return Math.max(25,Math.floor(I))},[d,g.length]),f=()=>{const u=m();c(u)};U.useEffect(()=>{d&&g.length>0&&setTimeout(()=>{const u=m();u>25&&c(u)},100)},[d,g.length,m]);const p=(u,P,z=0,N=0)=>{const _=z>0||N>0;return e.jsx("div",{className:`card-item ${u.hasImage?"":"missing"} ${_?"":"no-spacing"}`,style:{width:"100%",height:"100%",fontSize:`${Math.max(8,12*o/100)}px`},children:u.hasImage&&u.imageUrl?e.jsx("img",{src:u.imageUrl,alt:u.id}):e.jsxs("div",{style:{padding:"4px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"80%",marginBottom:"2px"},children:"缺失图片"}),e.jsx("div",{style:{fontSize:"70%",opacity:.7},children:u.id})]})})},x=(u,P)=>{if(!d)return null;const z=d.pageWidthPt*o/100,N=d.pageHeightPt*o/100,_=d.marginPt*o/100,D=d.spacingHPt*o/100,E=d.spacingVPt*o/100;return e.jsxs("div",{className:"pdf-page",style:{width:`${z}px`,height:`${N}px`,margin:"0 auto"},children:[e.jsx("div",{className:"card-container",style:{position:"relative",width:`${z-2*_}px`,height:`${N-2*_}px`,left:`${_}px`,top:`${_}px`,border:n.pageSettings.margin>0?"1px dashed rgba(255, 0, 0, 0.3)":"none",boxSizing:"border-box"},children:u.cards.map((O,I)=>{const F=I%u.layout.columns,W=Math.floor(I/u.layout.columns),L=d.cardWidthPt*o/100,M=d.cardHeightPt*o/100,re=D===0?F*L:F*(L+D),oe=E===0?W*M:W*(M+E);return e.jsx("div",{style:{position:"absolute",left:`${re}px`,top:`${oe}px`,width:`${L}px`,height:`${M}px`},children:p(O,I,D,E)},`${O.id}-${I}`)})}),n.showCuttingLines&&u.cards.map((O,I)=>{const F=I%u.layout.columns,W=Math.floor(I/u.layout.columns),L=d.cardWidthPt*o/100,M=d.cardHeightPt*o/100,re=_+(D===0?F*L:F*(L+D)),oe=_+(E===0?W*M:W*(M+E)),ue=2,me=re+L,fe=oe+M;return e.jsxs("div",{children:[e.jsx("div",{style:{position:"absolute",left:0,top:`${fe}px`,width:`${me}px`,height:`${ue}px`,backgroundColor:"#999",pointerEvents:"none",zIndex:10}}),e.jsx("div",{style:{position:"absolute",left:`${me}px`,top:0,width:`${ue}px`,height:`${fe}px`,backgroundColor:"#999",pointerEvents:"none",zIndex:10}})]},`cutting-${O.id}-${I}`)})]},P)},y=t.length>0&&r,v=t.reduce((u,P)=>u+P.count,0),k=t.filter(u=>u.hasImage).reduce((u,P)=>u+P.count,0);return e.jsxs("div",{className:"preview-area",children:[e.jsxs("div",{className:"preview-toolbar",children:[e.jsx("div",{children:e.jsxs(w,{align:"center",children:[e.jsx(Vt,{level:5,style:{margin:0},children:"预览"}),g.length>0&&e.jsxs(_e,{type:"secondary",children:[g.length," 页 | ",v," 张卡片",k<v&&e.jsxs("span",{style:{color:"#ff4d4f"},children:["(",v-k," 张缺失)"]}),d&&e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{color:"#d9d9d9",margin:"0 8px"},children:"|"}),e.jsxs("span",{children:["每页 ",d.cardsPerPage," 张"]}),e.jsx("span",{style:{color:"#d9d9d9",margin:"0 8px"},children:"|"}),e.jsxs("span",{children:[d.columns," 列 × ",d.rows," 行"]}),e.jsx("span",{style:{color:"#d9d9d9",margin:"0 8px"},children:"|"}),e.jsxs("span",{children:["卡片 ",n.cardSize.width,"×",n.cardSize.height,"cm"]})]})]})]})}),e.jsxs(w,{children:[e.jsxs(w,{align:"center",children:[e.jsx(Ve,{}),e.jsx(le,{value:o,onChange:c,min:25,max:400,style:{width:120},tooltip:{formatter:u=>`${u}%`}}),e.jsx(Xe,{}),e.jsxs(_e,{style:{minWidth:40},children:[o,"%"]}),e.jsx($,{size:"small",icon:e.jsx(Ze,{}),onClick:f,title:"适合窗口",children:"适合"}),e.jsxs($.Group,{size:"small",children:[e.jsx($,{onClick:()=>c(100),title:"实际大小",children:"100%"}),e.jsx($,{onClick:()=>c(150),title:"放大显示",children:"150%"}),e.jsx($,{onClick:()=>c(200),title:"高清显示",children:"200%"})]})]}),e.jsx($,{type:"primary",icon:e.jsx(Je,{}),onClick:i,loading:l,disabled:!y,children:"生成PDF"})]})]}),e.jsx("div",{className:"preview-content",children:g.length===0?e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:"100%",padding:"60px 20px"},children:t.length===0?e.jsx(Q,{image:Q.PRESENTED_IMAGE_SIMPLE,description:"请先导入YDK卡组文件"}):r?e.jsx(et,{size:"large",tip:"正在计算排版..."}):e.jsx(Q,{image:Q.PRESENTED_IMAGE_SIMPLE,description:"请先选择图片文件夹"})}):e.jsxs("div",{style:{width:"100%",minHeight:"100%",display:"flex",flexDirection:"column"},children:[g.length>1&&e.jsx("div",{style:{textAlign:"center",padding:"20px 20px 10px 20px",position:"sticky",top:0,backgroundColor:"#fafafa",zIndex:10,borderBottom:"1px solid #f0f0f0"},children:e.jsx(tt,{current:a,total:g.length,pageSize:1,onChange:h,showSizeChanger:!1,showQuickJumper:!0,showTitle:!1,showTotal:u=>`共 ${u} 页`})}),e.jsx("div",{style:{padding:"20px",display:"flex",justifyContent:"center",flex:1},children:g[a-1]&&x(g[a-1],a-1)})]})}),!y&&t.length>0&&e.jsx("div",{style:{position:"absolute",bottom:20,left:20,right:20},children:e.jsx(ce,{message:"无法生成PDF",description:r?"请检查设置和卡组数据":"请先选择包含卡片图片的文件夹",type:"warning",showIcon:!0})})]})},Zt=()=>{const[t,n]=C.useState({cards:[],layout:qt(),imageFolder:null,imageStatus:{total:0,loaded:0,missing:[],isProcessing:!1},pdfPages:[],isGenerating:!1});C.useEffect(()=>{Kt()},[]);const l=C.useCallback(a=>{n(h=>({...h,layout:a}))},[]),i=C.useCallback(async a=>{t.cards.length>0&&Wt(t.cards),n(h=>({...h,cards:a,imageStatus:{total:a.length,loaded:0,missing:[],isProcessing:!1}})),a.length>0&&t.imageFolder&&await o(a,t.imageFolder)},[t.imageFolder,t.cards]),r=C.useCallback(async()=>{try{if(!("showDirectoryPicker"in window)){T.error("您的浏览器不支持文件夹选择功能，请使用最新版Chrome或Edge浏览器");return}const a=await window.showDirectoryPicker();n(h=>({...h,imageFolder:a})),t.cards.length>0&&await o(t.cards,a),T.success("图片文件夹选择成功")}catch(a){a.name!=="AbortError"&&(console.error("选择文件夹失败:",a),T.error("选择文件夹失败"))}},[t.cards]),o=C.useCallback(async(a,h)=>{n(s=>({...s,imageStatus:{...s.imageStatus,isProcessing:!0}}));try{const s=await Ot(h,a,(d,m,f)=>{n(p=>({...p,imageStatus:{total:m,loaded:d,missing:f,isProcessing:d<m}}))});n(d=>({...d,cards:s,imageStatus:{...d.imageStatus,isProcessing:!1}}));const g=s.filter(d=>d.hasImage).length;T.success(`图片加载完成，找到 ${g}/${a.length} 张卡片图片`)}catch(s){console.error("加载图片失败:",s),T.error("加载图片失败: "+s.message),n(g=>({...g,imageStatus:{...g.imageStatus,isProcessing:!1}}))}},[]),c=C.useCallback(async()=>{if(t.cards.length===0){T.warning("请先导入卡组数据");return}if(!t.imageFolder){T.warning("请先选择图片文件夹");return}n(a=>({...a,isGenerating:!0}));try{const a=await At(t.cards,t.layout,(g,d,m)=>{console.log(`PDF生成进度: ${m} ${g}/${d}`)}),s=`yugioh_cards_${new Date().toISOString().slice(0,19).replace(/[:-]/g,"")}.pdf`;Ut(a,s),T.success("PDF生成成功")}catch(a){console.error("PDF生成失败:",a),T.error("PDF生成失败: "+a.message)}finally{n(a=>({...a,isGenerating:!1}))}},[t.cards,t.layout,t.imageFolder]);return e.jsxs("div",{className:"app-container",children:[e.jsx(kt,{layout:t.layout,onChange:l}),e.jsx(Xt,{cards:t.cards,layout:t.layout,isGenerating:t.isGenerating,onGeneratePdf:c,hasImageFolder:!!t.imageFolder}),e.jsx(Rt,{cards:t.cards,imageStatus:t.imageStatus,onCardsChange:i,onImageFolderSelect:r,hasImageFolder:!!t.imageFolder}),t.isGenerating&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{style:{backgroundColor:"white",padding:"30px",borderRadius:"8px",textAlign:"center",minWidth:"300px"},children:[e.jsx(de,{type:"circle",percent:0}),e.jsx("div",{style:{marginTop:"16px",fontSize:"16px"},children:"正在生成PDF文件..."}),e.jsx("div",{style:{marginTop:"8px",color:"#666",fontSize:"14px"},children:"请稍候，这可能需要几分钟时间"})]})})]})};he.createRoot(document.getElementById("root")).render(e.jsx(U.StrictMode,{children:e.jsx(nt,{locale:zt,children:e.jsx(Zt,{})})}));
