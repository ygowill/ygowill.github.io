import{r as x,c as bt,g as St,R as J}from"./vendor-BTWMFwqw.js";import{T as ne,S as be,a as T,B as _,b as Q,R as A,c as Te,D as qe,d as ee,e as le,f as Ge,I as _e,g as Ke,A as K,h as Ie,E as q,C as Qe,i as V,j as Pt,k as Ee,l as Ze,m as Xe,n as Je,o as Ct,p as ae,q as kt,r as $t,s as zt,M as Tt,U as _t,t as De,u as It,v as Rt,P as Se,L as Le,w as Et,x as Dt,y as Lt,z as W,F as At}from"./antd-DtRgrIVE.js";import{P as Mt,d as ve,r as N}from"./pdf-CSTLUYz4.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function l(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=l(r);fetch(r.href,s)}})();var et={exports:{}},he={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ht=x,Wt=Symbol.for("react.element"),Ot=Symbol.for("react.fragment"),Bt=Object.prototype.hasOwnProperty,Ft=Ht.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Nt={key:!0,ref:!0,__self:!0,__source:!0};function tt(t,i,l){var n,r={},s=null,o=null;l!==void 0&&(s=""+l),i.key!==void 0&&(s=""+i.key),i.ref!==void 0&&(o=i.ref);for(n in i)Bt.call(i,n)&&!Nt.hasOwnProperty(n)&&(r[n]=i[n]);if(t&&t.defaultProps)for(n in i=t.defaultProps,i)r[n]===void 0&&(r[n]=i[n]);return{$$typeof:Wt,type:t,key:s,ref:o,props:r,_owner:Ft.current}}he.Fragment=Ot;he.jsx=tt;he.jsxs=tt;et.exports=he;var e=et.exports,Pe={},Ae=bt;Pe.createRoot=Ae.createRoot,Pe.hydrateRoot=Ae.hydrateRoot;var ge={},it={exports:{}};(function(t){function i(l){return l&&l.__esModule?l:{default:l}}t.exports=i,t.exports.__esModule=!0,t.exports.default=t.exports})(it);var pe=it.exports,ue={};Object.defineProperty(ue,"__esModule",{value:!0});ue.default=void 0;var Yt={items_per_page:"条/页",jump_to:"跳至",jump_to_confirm:"确定",page:"页",prev_page:"上一页",next_page:"下一页",prev_5:"向前 5 页",next_5:"向后 5 页",prev_3:"向前 3 页",next_3:"向后 3 页",page_size:"页码"};ue.default=Yt;var me={},se={},fe={},nt={exports:{}},st={exports:{}},ot={exports:{}},rt={exports:{}};(function(t){function i(l){"@babel/helpers - typeof";return t.exports=i=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},t.exports.__esModule=!0,t.exports.default=t.exports,i(l)}t.exports=i,t.exports.__esModule=!0,t.exports.default=t.exports})(rt);var at=rt.exports,lt={exports:{}};(function(t){var i=at.default;function l(n,r){if(i(n)!="object"||!n)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var o=s.call(n,r||"default");if(i(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(n)}t.exports=l,t.exports.__esModule=!0,t.exports.default=t.exports})(lt);var Ut=lt.exports;(function(t){var i=at.default,l=Ut;function n(r){var s=l(r,"string");return i(s)=="symbol"?s:s+""}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports})(ot);var Vt=ot.exports;(function(t){var i=Vt;function l(n,r,s){return(r=i(r))in n?Object.defineProperty(n,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[r]=s,n}t.exports=l,t.exports.__esModule=!0,t.exports.default=t.exports})(st);var qt=st.exports;(function(t){var i=qt;function l(r,s){var o=Object.keys(r);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(r);s&&(c=c.filter(function(h){return Object.getOwnPropertyDescriptor(r,h).enumerable})),o.push.apply(o,c)}return o}function n(r){for(var s=1;s<arguments.length;s++){var o=arguments[s]!=null?arguments[s]:{};s%2?l(Object(o),!0).forEach(function(c){i(r,c,o[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):l(Object(o)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(o,c))})}return r}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports})(nt);var Gt=nt.exports,xe={};Object.defineProperty(xe,"__esModule",{value:!0});xe.commonLocale=void 0;xe.commonLocale={yearFormat:"YYYY",dayFormat:"D",cellMeridiemFormat:"A",monthBeforeYear:!0};var Kt=pe.default;Object.defineProperty(fe,"__esModule",{value:!0});fe.default=void 0;var Me=Kt(Gt),Qt=xe,Zt=(0,Me.default)((0,Me.default)({},Qt.commonLocale),{},{locale:"zh_CN",today:"今天",now:"此刻",backToToday:"返回今天",ok:"确定",timeSelect:"选择时间",dateSelect:"选择日期",weekSelect:"选择周",clear:"清除",week:"周",month:"月",year:"年",previousMonth:"上个月 (翻页上键)",nextMonth:"下个月 (翻页下键)",monthSelect:"选择月份",yearSelect:"选择年份",decadeSelect:"选择年代",previousYear:"上一年 (Control键加左方向键)",nextYear:"下一年 (Control键加右方向键)",previousDecade:"上一年代",nextDecade:"下一年代",previousCentury:"上一世纪",nextCentury:"下一世纪",yearFormat:"YYYY年",cellDateFormat:"D",monthBeforeYear:!1});fe.default=Zt;var oe={};Object.defineProperty(oe,"__esModule",{value:!0});oe.default=void 0;const Xt={placeholder:"请选择时间",rangePlaceholder:["开始时间","结束时间"]};oe.default=Xt;var ct=pe.default;Object.defineProperty(se,"__esModule",{value:!0});se.default=void 0;var Jt=ct(fe),ei=ct(oe);const dt={lang:Object.assign({placeholder:"请选择日期",yearPlaceholder:"请选择年份",quarterPlaceholder:"请选择季度",monthPlaceholder:"请选择月份",weekPlaceholder:"请选择周",rangePlaceholder:["开始日期","结束日期"],rangeYearPlaceholder:["开始年份","结束年份"],rangeMonthPlaceholder:["开始月份","结束月份"],rangeQuarterPlaceholder:["开始季度","结束季度"],rangeWeekPlaceholder:["开始周","结束周"]},Jt.default),timePickerLocale:Object.assign({},ei.default)};dt.lang.ok="确定";se.default=dt;var ti=pe.default;Object.defineProperty(me,"__esModule",{value:!0});me.default=void 0;var ii=ti(se);me.default=ii.default;var ye=pe.default;Object.defineProperty(ge,"__esModule",{value:!0});ge.default=void 0;var ni=ye(ue),si=ye(me),oi=ye(se),ri=ye(oe);const L="${label}不是一个有效的${type}",ai={locale:"zh-cn",Pagination:ni.default,DatePicker:oi.default,TimePicker:ri.default,Calendar:si.default,global:{placeholder:"请选择",close:"关闭"},Table:{filterTitle:"筛选",filterConfirm:"确定",filterReset:"重置",filterEmptyText:"无筛选项",filterCheckAll:"全选",filterSearchPlaceholder:"在筛选项中搜索",emptyText:"暂无数据",selectAll:"全选当页",selectInvert:"反选当页",selectNone:"清空所有",selectionAll:"全选所有",sortTitle:"排序",expand:"展开行",collapse:"关闭行",triggerDesc:"点击降序",triggerAsc:"点击升序",cancelSort:"取消排序"},Modal:{okText:"确定",cancelText:"取消",justOkText:"知道了"},Tour:{Next:"下一步",Previous:"上一步",Finish:"结束导览"},Popconfirm:{cancelText:"取消",okText:"确定"},Transfer:{titles:["",""],searchPlaceholder:"请输入搜索内容",itemUnit:"项",itemsUnit:"项",remove:"删除",selectCurrent:"全选当页",removeCurrent:"删除当页",selectAll:"全选所有",deselectAll:"取消全选",removeAll:"删除全部",selectInvert:"反选当页"},Upload:{uploading:"文件上传中",removeFile:"删除文件",uploadError:"上传错误",previewFile:"预览文件",downloadFile:"下载文件"},Empty:{description:"暂无数据"},Icon:{icon:"图标"},Text:{edit:"编辑",copy:"复制",copied:"复制成功",expand:"展开",collapse:"收起"},Form:{optional:"（可选）",defaultValidateMessages:{default:"字段验证错误${label}",required:"请输入${label}",enum:"${label}必须是其中一个[${enum}]",whitespace:"${label}不能为空字符",date:{format:"${label}日期格式无效",parse:"${label}不能转换为日期",invalid:"${label}是一个无效日期"},types:{string:L,method:L,array:L,object:L,number:L,date:L,boolean:L,integer:L,float:L,regexp:L,email:L,url:L,hex:L},string:{len:"${label}须为${len}个字符",min:"${label}最少${min}个字符",max:"${label}最多${max}个字符",range:"${label}须在${min}-${max}字符之间"},number:{len:"${label}必须等于${len}",min:"${label}最小值为${min}",max:"${label}最大值为${max}",range:"${label}须在${min}-${max}之间"},array:{len:"须为${len}个${label}",min:"最少${min}个${label}",max:"最多${max}个${label}",range:"${label}数量须在${min}-${max}之间"},pattern:{mismatch:"${label}与模式不匹配${pattern}"}}},Image:{preview:"预览"},QRCode:{expired:"二维码过期",refresh:"点击刷新",scanned:"已扫描"},ColorPicker:{presetEmpty:"暂无",transparent:"无色",singleColor:"单色",gradientColor:"渐变色"}};ge.default=ai;var li=ge;const ci=St(li),Re=[{name:"A0",width:84.1,height:118.9,category:"standard"},{name:"A1",width:59.4,height:84.1,category:"standard"},{name:"A2",width:42,height:59.4,category:"standard"},{name:"A3",width:29.7,height:42,category:"standard"},{name:"A4",width:21,height:29.7,category:"standard"},{name:"A5",width:14.8,height:21,category:"standard"},{name:"A6",width:10.5,height:14.8,category:"standard"},{name:"A7",width:7.4,height:10.5,category:"standard"},{name:"A8",width:5.2,height:7.4,category:"standard"},{name:"A9",width:3.7,height:5.2,category:"standard"},{name:"A10",width:2.6,height:3.7,category:"standard"}],ht=[{name:"Letter",width:21.6,height:27.9,category:"standard"},{name:"Legal",width:21.6,height:35.6,category:"standard"},{name:"Executive",width:18.4,height:26.7,category:"standard"},{name:"Ledger/Tabloid",width:27.9,height:43.2,category:"standard"}],gt=[{name:"10x15cm",width:10,height:15,category:"photo"},{name:"13x18cm",width:13,height:18,category:"photo"},{name:"15x21cm",width:15,height:21,category:"photo"},{name:"18x24cm",width:18,height:24,category:"photo"},{name:"20x25cm",width:20,height:25,category:"photo"},{name:"20x30cm",width:20,height:30,category:"photo"},{name:"25x35cm",width:25,height:35,category:"photo"},{name:"30x40cm",width:30,height:40,category:"photo"},{name:"30x45cm",width:30,height:45,category:"photo"},{name:"4x6英寸",width:10.2,height:15.2,category:"photo"},{name:"5x7英寸",width:12.7,height:17.8,category:"photo"},{name:"6x8英寸",width:15.2,height:20.3,category:"photo"},{name:"8x10英寸",width:20.3,height:25.4,category:"photo"},{name:"8x12英寸",width:20.3,height:30.5,category:"photo"},{name:"10x12英寸",width:25.4,height:30.5,category:"photo"},{name:"11x14英寸",width:27.9,height:35.6,category:"photo"},{name:"12x16英寸",width:30.5,height:40.6,category:"photo"},{name:"16x20英寸",width:40.6,height:50.8,category:"photo"},{name:"20x24英寸",width:50.8,height:61,category:"photo"},{name:"24x30英寸",width:61,height:76.2,category:"photo"},{name:"24x36英寸",width:61,height:91.4,category:"photo"}],pt=[{name:"B5",width:17.6,height:25,category:"standard"},{name:"B4",width:25,height:35.3,category:"standard"},{name:"B3",width:35.3,height:50,category:"standard"},{name:"C4",width:22.9,height:32.4,category:"standard"},{name:"C5",width:16.2,height:22.9,category:"standard"},{name:"DL",width:11,height:22,category:"standard"}],Ce=[...Re,...ht,...gt,...pt],He={standard:[...Re,...ht,...pt],photo:gt};function di(){return Re.find(t=>t.name==="A4")}function hi(t){return Ce.find(i=>i.name===t)}function gi(t){return`${t.name} (${t.width} × ${t.height} cm)`}function pi(t){return`${t.name} 横向 (${t.height} × ${t.width} cm)`}const{Title:Z,Text:z}=ne,{Option:We}=be,Oe=[{name:"标准卡",size:{width:5.9,height:8.6}},{name:"小卡",size:{width:4.2,height:6.1}},{name:"正方形",size:{width:6,height:6}},{name:"自定义",size:{width:0,height:0}}],ui=({layout:t,onChange:i})=>{const l=()=>{const d=Ce.find(b=>b.width===t.pageSettings.width&&b.height===t.pageSettings.height);return d?d.name:"A4"},[n,r]=x.useState(l()),s=d=>{i({...t,...d})},o=d=>{s({cardSize:{...t.cardSize,...d}})},c=d=>{s({spacing:{...t.spacing,...d}})},h=d=>{s({pageSettings:{...t.pageSettings,...d}})},u=d=>{s({imageQuality:{...t.imageQuality,...d}})},p=d=>{d.name!=="自定义"&&o(d.size)},g=()=>{for(const d of Oe)if(d.name!=="自定义"&&d.size.width===t.cardSize.width&&d.size.height===t.cardSize.height)return d.name;return"自定义"},f=d=>{const b=hi(d);b&&(r(d),h({width:b.width,height:b.height}))},y=d=>{s({orientation:d})},w=()=>{const d=Ce.find(b=>b.width===t.pageSettings.width&&b.height===t.pageSettings.height);return d?d.name:n},j=d=>t.orientation==="landscape"?pi(d):gi(d);return e.jsxs("div",{className:"settings-panel",children:[e.jsx("div",{className:"section-title",children:e.jsx(Z,{level:4,children:"排版设置"})}),e.jsxs("div",{className:"form-section",children:[e.jsx(Z,{level:5,style:{marginTop:0,marginBottom:12},children:"卡片尺寸 (厘米)"}),e.jsxs(T,{direction:"vertical",style:{width:"100%"},children:[e.jsx(z,{type:"secondary",children:"预设尺寸:"}),e.jsx("div",{className:"size-presets",children:Oe.map(d=>e.jsx(_,{type:g()===d.name?"primary":"default",size:"small",onClick:()=>p(d),style:{height:"auto",padding:"8px 12px"},children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{children:d.name}),d.name!=="自定义"&&e.jsxs("div",{style:{fontSize:"10px",opacity:.7},children:[d.size.width,"×",d.size.height]})]})},d.name))}),e.jsxs(T,{children:[e.jsxs("div",{children:[e.jsx(z,{children:"宽度:"}),e.jsx(Q,{value:t.cardSize.width,onChange:d=>o({width:d||0}),min:1,max:15,step:.01,precision:2,addonAfter:"cm",style:{width:100}})]}),e.jsxs("div",{children:[e.jsx(z,{children:"高度:"}),e.jsx(Q,{value:t.cardSize.height,onChange:d=>o({height:d||0}),min:1,max:20,step:.01,precision:2,addonAfter:"cm",style:{width:100}})]})]})]})]}),e.jsxs("div",{className:"form-section",style:{marginTop:16},children:[e.jsx(Z,{level:5,style:{marginBottom:12},children:"卡片间距 (厘米)"}),e.jsxs(T,{direction:"vertical",style:{width:"100%"},children:[e.jsxs("div",{children:[e.jsx(z,{children:"水平间距:"}),e.jsx(Q,{value:t.spacing.horizontal,onChange:d=>c({horizontal:d||0}),min:0,max:5,step:.01,precision:2,addonAfter:"cm",style:{width:120,marginLeft:8}})]}),e.jsxs("div",{children:[e.jsx(z,{children:"垂直间距:"}),e.jsx(Q,{value:t.spacing.vertical,onChange:d=>c({vertical:d||0}),min:0,max:5,step:.01,precision:2,addonAfter:"cm",style:{width:120,marginLeft:8}})]})]})]}),e.jsxs("div",{className:"form-section",style:{marginTop:16},children:[e.jsx(Z,{level:5,style:{marginBottom:12},children:"页面设置"}),e.jsxs(T,{direction:"vertical",style:{width:"100%"},children:[e.jsxs("div",{children:[e.jsx(z,{children:"页边距:"}),e.jsx(Q,{value:t.pageSettings.margin,onChange:d=>h({margin:d||0}),min:0,max:5,step:.01,precision:2,addonAfter:"cm",style:{width:120,marginLeft:8}})]}),e.jsxs("div",{children:[e.jsx(z,{children:"纸张方向:"}),e.jsxs(A.Group,{value:t.orientation,onChange:d=>y(d.target.value),style:{marginTop:8},children:[e.jsx(A.Button,{value:"portrait",children:"纵向"}),e.jsx(A.Button,{value:"landscape",children:"横向"})]}),e.jsx("div",{style:{marginTop:4},children:e.jsx(z,{type:"secondary",style:{fontSize:12},children:"横向模式会将纸张旋转90度，适合宽幅布局"})})]}),e.jsxs("div",{children:[e.jsx(z,{children:"卡片方向:"}),e.jsxs(A.Group,{value:t.cardRotation,onChange:d=>s({cardRotation:d.target.value}),style:{marginTop:8},children:[e.jsx(A.Button,{value:"normal",children:"正常"}),e.jsx(A.Button,{value:"rotated",children:"横排"})]}),e.jsx("div",{style:{marginTop:4},children:e.jsx(z,{type:"secondary",style:{fontSize:12},children:"横排模式会将卡片旋转90度，适合在纵向纸张上横向排列卡片"})})]}),e.jsxs("div",{children:[e.jsx(z,{children:"纸张尺寸:"}),e.jsx(Te,{type:"card",size:"small",style:{marginTop:8},items:[{key:"standard",label:"标准纸张",children:e.jsx(be,{value:w(),onChange:f,style:{width:"100%"},showSearch:!0,placeholder:"选择标准纸张尺寸",filterOption:(d,b)=>{var m;return(m=b==null?void 0:b.children)==null?void 0:m.toLowerCase().includes(d.toLowerCase())},children:He.standard.map(d=>e.jsx(We,{value:d.name,children:j(d)},d.name))})},{key:"photo",label:"照片纸",children:e.jsx(be,{value:w(),onChange:f,style:{width:"100%"},showSearch:!0,placeholder:"选择照片纸尺寸",filterOption:(d,b)=>{var m;return(m=b==null?void 0:b.children)==null?void 0:m.toLowerCase().includes(d.toLowerCase())},children:He.photo.map(d=>e.jsx(We,{value:d.name,children:j(d)},d.name))})}]})]})]})]}),e.jsx(qe,{style:{margin:"16px 0"}}),e.jsxs("div",{className:"form-section",children:[e.jsx(Z,{level:5,style:{marginTop:0,marginBottom:12},children:"图片设置"}),e.jsxs(T,{direction:"vertical",style:{width:"100%"},children:[e.jsxs("div",{children:[e.jsx(z,{children:"裁剪模式:"}),e.jsxs(A.Group,{value:t.cropMode,onChange:d=>s({cropMode:d.target.value}),style:{marginTop:8},children:[e.jsx(A.Button,{value:"fit",children:"等比缩放"}),e.jsx(A.Button,{value:"fill",children:"裁剪适应"})]})]}),e.jsxs("div",{children:[e.jsx(z,{children:"图片质量:"}),e.jsx("div",{style:{marginTop:8},children:e.jsxs(T,{direction:"vertical",style:{width:"100%"},children:[e.jsxs("div",{children:[e.jsxs(z,{type:"secondary",style:{fontSize:12},children:["分辨率倍数: ",t.imageQuality.resolution,"x"]}),e.jsx(ee,{title:"更高的分辨率会提升图片清晰度，但会增加文件大小和处理时间",children:e.jsx(le,{value:t.imageQuality.resolution,onChange:d=>u({resolution:d}),min:1,max:4,step:1,marks:{1:"1x",2:"2x",3:"3x",4:"4x"},style:{marginTop:4}})})]}),e.jsxs("div",{children:[e.jsxs(z,{type:"secondary",style:{fontSize:12},children:["压缩质量: ",Math.round(t.imageQuality.quality*100),"%"]}),e.jsx(ee,{title:"更高的质量会保持更多细节，但会增加文件大小",children:e.jsx(le,{value:t.imageQuality.quality,onChange:d=>u({quality:d}),min:.5,max:1,step:.05,marks:{.5:"50%",.75:"75%",.9:"90%",1:"100%"},style:{marginTop:4}})})]}),e.jsxs("div",{children:[e.jsx(z,{type:"secondary",style:{fontSize:12},children:"输出格式:"}),e.jsxs(A.Group,{value:t.imageQuality.format,onChange:d=>u({format:d.target.value}),style:{marginTop:4},children:[e.jsx(A.Button,{value:"png",children:"PNG (无损)"}),e.jsx(A.Button,{value:"jpeg",children:"JPEG (小文件)"})]})]})]})})]}),e.jsxs("div",{style:{marginTop:16},children:[e.jsxs(T,{align:"center",children:[e.jsx(z,{children:"显示切割线:"}),e.jsx(Ge,{checked:t.showCuttingLines,onChange:d=>i({...t,showCuttingLines:d})})]}),e.jsx("div",{style:{marginTop:4},children:e.jsx(z,{type:"secondary",style:{fontSize:12},children:"在每张卡片右下角显示切割参考线"})})]}),t.showCuttingLines&&e.jsxs("div",{style:{marginTop:12},children:[e.jsx(z,{children:"切割线宽度:"}),e.jsx("div",{style:{marginTop:8},children:e.jsx(T,{direction:"vertical",style:{width:"100%"},children:e.jsxs("div",{children:[e.jsxs(z,{type:"secondary",style:{fontSize:12},children:["宽度: ",t.cuttingLineWidth,"pt"]}),e.jsx(ee,{title:"调整切割线的粗细，数值越小线条越细",children:e.jsx(le,{value:t.cuttingLineWidth,onChange:d=>i({...t,cuttingLineWidth:d}),min:.01,max:3,step:.01,marks:{.01:"0.01",.05:"0.05",.1:"0.1",.5:"0.5",1:"1.0",1.5:"1.5",2:"2.0",3:"3.0"},style:{marginTop:4}})})]})})})]}),e.jsx("div",{style:{marginTop:16,padding:"8px 12px",backgroundColor:"#f9f9f9",borderRadius:"4px",border:"1px solid #e8e8e8"},children:e.jsxs(z,{type:"secondary",style:{fontSize:12},children:[e.jsx("div",{children:"• 等比缩放: 保持图片比例，可能有留白"}),e.jsx("div",{children:"• 裁剪适应: 填满卡片区域，可能裁剪图片"}),e.jsx("div",{children:"• PNG: 最佳质量，较大文件"}),e.jsx("div",{children:"• JPEG: 较小文件，轻微质量损失"}),e.jsx("div",{children:"• 切割线: 便于精确切割卡片"})]})})]})]})]})};function de(t){const i=t.split(`
`).map(r=>r.trim()).filter(r=>r),l={main:[],extra:[],side:[]};let n=null;for(const r of i){if(r.startsWith("#")||r.startsWith("!")){const s=r.toLowerCase();s.includes("main")?n="main":s.includes("extra")?n="extra":s.includes("side")&&(n="side");continue}/^\d+$/.test(r)&&n&&l[n].push(r)}return l}function ke(t,i=!0,l=!1){const n=[...t.main,...i?t.extra:[],...l?t.side:[]],r=new Map,s=new Map;for(let c=0;c<n.length;c++){const h=n[c];r.set(h,(r.get(h)||0)+1),s.has(h)||s.set(h,c)}const o=[];for(const[c,h]of r)o.push({id:c,count:h,hasImage:!1,firstIndex:s.get(c)||0});return o.sort((c,h)=>(c.firstIndex||0)-(h.firstIndex||0))}function $e(t){return!t||t.trim().length===0?!1:t.split(`
`).map(n=>n.trim()).filter(n=>n).some(n=>/^\d{8}$/.test(n))}function mi(t){return new Promise((i,l)=>{const n=new FileReader;n.onload=r=>{var o;const s=(o=r.target)==null?void 0:o.result;i(s)},n.onerror=()=>{l(new Error("读取文件失败"))},n.readAsText(t,"utf-8")})}const H=new Map,G=new Map;async function Be(t){if(t.length===0)return null;for(const i of t)if(G.has(i)&&G.get(i))return i;try{const i=t.map(async r=>{const s=await ce(r);return{url:r,isValid:s}}),n=(await Promise.all(i)).find(r=>r.isValid);return n?n.url:null}catch(i){return console.error("并行验证图片URLs失败:",i),null}}async function ce(t){return G.has(t)?G.get(t):new Promise(i=>{const l=new Image;let n=!1;const r=o=>{n||(n=!0,G.set(t,o),i(o))},s=setTimeout(()=>{r(!1)},2e3);l.onload=()=>{clearTimeout(s),r(!0)},l.onerror=()=>{clearTimeout(s),r(!1)},l.crossOrigin="anonymous",l.src=t})}async function fi(t,i){var l,n,r;try{const s=[i,`${i} (card)`,t,`Card ${t}`].filter(Boolean);for(const o of s)try{const h=`https://yugipedia.com/api.php?action=query&format=json&prop=imageinfo&iiprop=url&titles=${encodeURIComponent(o)}&origin=*`;console.log("查询Yugipedia:",{title:o,url:h});const u=await fetch(h);if(!u.ok)continue;const p=await u.json();if((l=p.query)!=null&&l.pages){const g=Object.values(p.query.pages);for(const f of g)if(f.imageinfo&&f.imageinfo.length>0){const y=f.imageinfo[0].url;return console.log("找到Yugipedia图片:",{title:o,imageUrl:y}),y}}}catch(c){console.warn(`Yugipedia查询失败 [${o}]:`,c);continue}if(i)try{const o=`https://yugipedia.com/api.php?action=query&format=json&list=search&srsearch=${encodeURIComponent(i)}&srlimit=5&origin=*`,c=await fetch(o);if(c.ok){const h=await c.json();if((n=h.query)!=null&&n.search&&h.query.search.length>0){const p=h.query.search[0].title,g=`https://yugipedia.com/api.php?action=query&format=json&prop=imageinfo&iiprop=url&titles=${encodeURIComponent(p)}&origin=*`,f=await fetch(g);if(f.ok){const y=await f.json();if((r=y.query)!=null&&r.pages){const w=Object.values(y.query.pages);for(const j of w)if(j.imageinfo&&j.imageinfo.length>0){const d=j.imageinfo[0].url;return console.log("通过搜索找到Yugipedia图片:",{cardName:i,pageTitle:p,imageUrl:d}),d}}}}}}catch(o){console.warn("Yugipedia搜索失败:",o)}return null}catch(s){return console.error("Yugipedia API错误:",s),null}}async function ut(t,i,l,n=!1,r=!1){const s=`${t}-${i||""}-${l||""}-${n}-${r}`;if(H.has(s))return H.get(s);let o;if(r&&!n){console.log("CDN优先模式：开始验证远程图片源:",{cardId:t});const p=[`https://cdn.233.momobako.com/ygopro/pics/${t}.jpg`,`https://cdn.jsdelivr.net/gh/Fluorohydride/ygopro-images/pics/${t}.jpg`,`https://images.ygoprodeck.com/images/cards/${t}.jpg`,`https://storage.googleapis.com/ygoprodeck.com/pics/${t}.jpg`],g=await Be(p);if(g){let f="fallback";return g.includes("momobako.com")?f="momobako":g.includes("ygoprodeck.com")&&(f="fallback"),o={url:g,source:f,isValid:!0},H.set(s,o),console.log("CDN优先：使用远程图片:",{cardId:t,url:g,source:f}),o}if(l&&(console.log("CDN失败，回退到本地图片:",{cardId:t,localImageUrl:l}),await ce(l)))return o={url:l,source:"local",isValid:!0},H.set(s,o),console.log("CDN优先模式：使用本地图片:",{cardId:t,url:l}),o}else if(l){if(console.log("检查本地图片:",{cardId:t,localImageUrl:l}),await ce(l))return o={url:l,source:"local",isValid:!0},H.set(s,o),console.log("使用本地图片:",{cardId:t,url:l}),o;console.log("本地图片无效:",{cardId:t,localImageUrl:l})}if(n)return console.log("设置为只使用本地图片，跳过网络图片获取:",{cardId:t}),o={url:"",source:"local",isValid:!1},H.set(s,o),o;console.log("开始并行验证远程图片源:",{cardId:t});const c=[`https://cdn.233.momobako.com/ygopro/pics/${t}.jpg`,`https://cdn.jsdelivr.net/gh/Fluorohydride/ygopro-images/pics/${t}.jpg`,`https://images.ygoprodeck.com/images/cards/${t}.jpg`,`https://storage.googleapis.com/ygoprodeck.com/pics/${t}.jpg`],h=await Be(c);if(h){let p="fallback";return h.includes("momobako.com")?p="momobako":h.includes("ygoprodeck.com")&&(p="fallback"),o={url:h,source:p,isValid:!0},H.set(s,o),console.log("并行验证成功，使用远程图片:",{cardId:t,url:h,source:p}),o}console.log("远程图片源都不可用，尝试Yugipedia:",{cardId:t});const u=await fi(t,i);return u&&await ce(u)?(o={url:u,source:"yugipedia",isValid:!0},H.set(s,o),console.log("使用Yugipedia图片:",{cardId:t,url:u}),o):(o={url:"",source:"local",isValid:!1},H.set(s,o),o)}async function xi(t,i=!1){const l=new Map,n=5;for(let r=0;r<t.length;r+=n){const o=t.slice(r,r+n).map(async h=>{const u=await ut(h.id,h.name,h.localImageUrl,i);return{cardId:h.id,imageInfo:u}}),c=await Promise.all(o);for(const{cardId:h,imageInfo:u}of c)l.set(h,u);r+n<t.length&&await new Promise(h=>setTimeout(h,100))}return l}function yi(){H.clear(),G.clear(),console.log("图片缓存已清除")}const ji={1:"战士族",2:"魔法师族",4:"天使族",8:"恶魔族",16:"不死族",32:"机械族",64:"水族",128:"炎族",256:"岩石族",512:"鸟兽族",1024:"植物族",2048:"昆虫族",4096:"雷族",8192:"龙族",16384:"兽族",32768:"兽战士族",65536:"恐龙族",131072:"鱼族",262144:"海龙族",524288:"爬虫类族",1048576:"念动力族",2097152:"幻神兽族",4194304:"创造神族",8388608:"幻龙族",16777216:"电子界族"},vi={1:"地",2:"水",4:"炎",8:"风",16:"光",32:"暗",64:"神"},we=new Map,te=new Map,wi="https://ygocdb.com/api/v0/";function bi(t){return{id:t.id.toString(),name:t.cn_name||t.sc_name||t.md_name||t.en_name,en_name:t.en_name,desc:t.text.desc||t.html.desc||"",type:t.text.types||"",atk:t.data.atk>=0?t.data.atk:void 0,def:t.data.def>=0?t.data.def:void 0,level:t.data.level>0?t.data.level:void 0,race:ji[t.data.race]||"未知种族",attribute:vi[t.data.attribute]||void 0}}async function mt(t){if(!t||t.trim().length===0)return[];const i=t.trim();if(we.has(i))return we.get(i);try{const l=`${wi}?search=${encodeURIComponent(i)}`;console.log("搜索卡片:",{query:i,url:l});const n=await fetch(l);if(!n.ok)throw new Error(`API请求失败: ${n.status}`);const s=((await n.json()).result||[]).map(bi);return we.set(i,s),s.forEach(o=>{te.set(o.id,o)}),console.log("搜索结果:",{query:i,count:s.length}),s}catch(l){return console.error("搜索卡片失败:",l),/^\d{8}$/.test(i)?[{id:i,name:`卡片 ${i}`,en_name:`Card ${i}`,desc:"无法获取卡片信息",type:"未知",race:"未知种族"}]:[]}}async function Si(t){if(!t||!t.trim())return null;const i=t.trim();if(te.has(i))return te.get(i);try{const l=await mt(i);return l.length>0?l[0]:null}catch(l){return console.error(`获取卡片信息失败 [${t}]:`,l),null}}async function ft(t){const i=new Map,l=[];for(const n of t)te.has(n)?i.set(n,te.get(n)):l.push(n);if(l.length>0){console.log("批量获取卡片信息:",l.length);const n=10;for(let r=0;r<l.length;r+=n){const o=l.slice(r,r+n).map(async c=>{try{const h=await Si(c);h&&i.set(c,h)}catch(h){console.error(`获取卡片信息失败 [${c}]:`,h)}});await Promise.all(o),r+n<l.length&&await new Promise(c=>setTimeout(c,100))}}return i}async function Fe(t){if(t.length===0)return t;console.log("开始获取卡片名称（仅本地）...");const i=t.map(r=>r.id),l=await ft(i),n=t.map(r=>{const s=l.get(r.id);return{...r,name:(s==null?void 0:s.name)||r.name||void 0,imageUrl:r.imageUrl,hasImage:!!r.imageUrl,imageSource:r.imageUrl?"local":void 0}});return console.log("卡片名称获取完成（仅本地）:",{total:t.length,enriched:n.filter(r=>r.name).length,withLocalImages:n.filter(r=>r.hasImage).length}),n}async function Pi(t){if(t.length===0)return t;console.log("开始获取卡片信息...");const i=t.map(o=>o.id),l=await ft(i),n=t.map(o=>{const c=l.get(o.id);return{id:o.id,name:(c==null?void 0:c.name)||o.name,localImageUrl:o.imageUrl}});console.log("正在获取图片信息...");const r=await xi(n),s=t.map(o=>{const c=l.get(o.id),h=r.get(o.id);return{...o,name:(c==null?void 0:c.name)||o.name||void 0,imageUrl:h!=null&&h.isValid?h.url:o.imageUrl,hasImage:(h==null?void 0:h.isValid)||!1,imageSource:(h==null?void 0:h.source)||"local"}});return console.log("卡片信息获取完成:",{total:t.length,enriched:s.filter(o=>o.name).length,withImages:s.filter(o=>o.hasImage).length,localImages:s.filter(o=>o.imageSource==="local").length,momobakoImages:s.filter(o=>o.imageSource==="momobako").length,yugipediaImages:s.filter(o=>o.imageSource==="yugipedia").length,fallbackImages:s.filter(o=>o.imageSource==="fallback").length}),s}const{Title:Ci,Text:X}=ne,{Search:ki}=_e,$i=({cardInfo:t})=>{var m;const[i,l]=x.useState(""),[n,r]=x.useState(""),[s,o]=x.useState(!1),[c,h]=x.useState(!1),[u,p]=x.useState(!1),g=x.useRef(null),f=x.useMemo(()=>[{url:`https://cdn.233.momobako.com/ygopro/pics/${t.id}.jpg`,source:"momobako",icon:"🚀"},{url:`https://cdn.jsdelivr.net/gh/Fluorohydride/ygopro-images/pics/${t.id}.jpg`,source:"fallback",icon:"🔄"},{url:`https://images.ygoprodeck.com/images/cards/${t.id}.jpg`,source:"fallback",icon:"🔄"}],[t.id]),[y,w]=x.useState(0);x.useEffect(()=>{const a=g.current;if(!a)return;const v=new IntersectionObserver(([P])=>{P.isIntersecting&&!c&&(h(!0),v.unobserve(a))},{rootMargin:"50px"});return v.observe(a),()=>v.disconnect()},[c]),x.useEffect(()=>{c&&(w(0),o(!1),p(!0),l(f[0].url),r(f[0].source),console.log("搜索预览开始懒加载图片:",{cardId:t.id,cardName:t.name,firstSource:f[0].url}))},[c,t.id,t.name,f]);const j=x.useCallback(()=>{const a=y+1;a<f.length?(console.log("图片加载失败，尝试下一个源:",{cardId:t.id,failedSource:f[y].url,nextSource:f[a].url}),w(a),l(f[a].url),r(f[a].source)):(console.log("所有图片源都加载失败:",{cardId:t.id}),o(!0),p(!1))},[y,f,t.id]),d=x.useCallback(()=>{p(!1),console.log("搜索预览图片懒加载成功:",{cardId:t.id,source:n,url:i})},[t.id,n,i]),b={width:60,height:87,backgroundColor:"#f5f5f5",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px",border:"1px solid #e5e7eb"};return e.jsx("div",{ref:g,style:{position:"relative"},children:c?s?e.jsx("div",{style:b,children:e.jsx(Ee,{style:{fontSize:16,color:"#d9d9d9"}})}):e.jsxs("div",{style:{position:"relative"},children:[e.jsx("img",{src:i,alt:t.name,onLoad:d,onError:j,style:{width:60,height:87,objectFit:"cover",borderRadius:"4px",border:"1px solid #e5e7eb",backgroundColor:"#f5f5f5",opacity:u?.3:1,transition:"opacity 0.3s ease"}}),u&&e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:1},children:e.jsx(Ie,{size:"small"})}),!u&&e.jsx("div",{style:{position:"absolute",bottom:2,right:2,fontSize:"8px",backgroundColor:"rgba(0,0,0,0.7)",color:"white",padding:"1px 3px",borderRadius:"2px"},children:((m=f[y])==null?void 0:m.icon)||"📁"})]}):e.jsx("div",{style:b,children:e.jsx(Ee,{style:{fontSize:16,color:"#d9d9d9"}})})})},zi=({onAddCard:t,existingCards:i})=>{const[l,n]=x.useState(""),[r,s]=x.useState([]),[o,c]=x.useState(!1),[h,u]=x.useState(null),p=x.useRef(null),g=x.useCallback(async m=>{if(!m||m.trim().length===0){s([]);return}c(!0),u(null);try{const a=await mt(m.trim());s(a),a.length===0&&u("未找到匹配的卡片，请尝试其他关键词")}catch(a){console.error("搜索失败:",a),u("搜索失败，请检查网络连接或稍后重试"),s([])}finally{c(!1)}},[]),f=x.useCallback(m=>{p.current&&clearTimeout(p.current),p.current=setTimeout(()=>{g(m)},500)},[g]),y=x.useCallback(m=>{if(n(m),!m||m.trim().length===0){s([]),u(null),c(!1),p.current&&clearTimeout(p.current);return}f(m)},[f]);x.useEffect(()=>()=>{p.current&&clearTimeout(p.current)},[]);const w=x.useCallback(async m=>{const a=await ut(m.id,m.name,void 0,!0),v={id:m.id,name:m.name,count:1,hasImage:a.isValid,imageUrl:a.isValid?a.url:void 0,imageSource:a.source};console.log("添加卡片:",{cardInfo:m,imageInfo:a,newCard:v}),t(v)},[t]),j=(m,a)=>e.jsx(Qe,{size:"small",style:{width:"100%",margin:"2px 0"},bodyStyle:{padding:"12px"},children:e.jsxs("div",{style:{display:"flex",gap:"12px"},children:[e.jsx("div",{style:{flexShrink:0},children:e.jsx($i,{cardInfo:m})}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"8px"},children:[e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs(X,{strong:!0,style:{display:"block",marginBottom:"4px"},children:[m.name,a>0&&e.jsxs(V,{color:"blue",style:{marginLeft:"8px",fontSize:"10px",padding:"0 6px",lineHeight:"18px"},children:["已有 ",a]})]}),e.jsxs(X,{type:"secondary",style:{fontSize:"12px"},children:["ID: ",m.id]})]}),e.jsx(_,{type:"primary",size:"small",icon:e.jsx(Pt,{}),onClick:()=>w(m),style:{flexShrink:0},children:"添加"})]}),e.jsx("div",{style:{marginBottom:"8px"},children:e.jsxs(T,{size:[4,4],wrap:!0,children:[e.jsx(V,{color:"blue",style:{fontSize:"11px"},children:m.type}),m.race&&e.jsx(V,{color:"green",style:{fontSize:"11px"},children:m.race}),m.attribute&&e.jsx(V,{color:"orange",style:{fontSize:"11px"},children:m.attribute}),m.level!==void 0&&e.jsxs(V,{color:"purple",style:{fontSize:"11px"},children:["Level ",m.level]})]})}),(m.atk!==void 0||m.def!==void 0)&&e.jsx("div",{style:{marginBottom:"8px"},children:e.jsxs(X,{style:{fontSize:"12px",color:"#666"},children:[m.atk!==void 0&&`ATK: ${m.atk}`,m.atk!==void 0&&m.def!==void 0&&" / ",m.def!==void 0&&`DEF: ${m.def}`]})}),m.desc&&e.jsx(ee,{title:m.desc,placement:"bottomLeft",children:e.jsx(X,{style:{fontSize:"11px",color:"#888",display:"block",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:m.desc})})]})]})}),d=m=>{const a=i.find(v=>v.id===m);return a?a.count:0},b=m=>{const a=d(m.id);return e.jsx("div",{style:{padding:"2px 4px"},children:j(m,a)},m.id)};return e.jsxs("div",{style:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{padding:"16px 16px 0 16px",flexShrink:0},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[e.jsxs(Ci,{level:5,style:{margin:0},children:[e.jsx(Ke,{})," 卡片搜索"]}),e.jsx(_,{size:"small",onClick:()=>{yi(),console.log("🗑️ 图片缓存已清除，下次搜索将重新获取图片")},style:{fontSize:"11px"},title:"清除图片缓存，重新验证所有图片源",children:"🗑️ 清除图片缓存"})]}),e.jsx(ki,{placeholder:"输入中文卡名、英文卡名或卡片ID...",value:l,onChange:m=>y(m.target.value),onSearch:g,loading:o,allowClear:!0,style:{marginBottom:"16px"}}),e.jsx(K,{message:"搜索提示",description:"支持中文卡名、英文卡名和8位数字的卡片ID搜索。可以输入部分关键词进行模糊匹配。",type:"info",showIcon:!0,style:{marginBottom:"16px"}})]}),e.jsxs("div",{style:{flex:1,padding:"0 16px 16px 16px",overflow:"hidden",display:"flex",flexDirection:"column",minHeight:0},children:[h&&e.jsx(K,{message:"搜索失败",description:h,type:"error",showIcon:!0,style:{marginBottom:"16px",flexShrink:0}}),o?e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",flexShrink:0},children:e.jsx(Ie,{size:"large",tip:"正在搜索..."})}):r.length===0?e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",flexShrink:0},children:e.jsx(q,{image:q.PRESENTED_IMAGE_SIMPLE,description:l?"未找到匹配的卡片":"输入关键词开始搜索"})}):e.jsxs("div",{style:{flex:1,overflow:"hidden",display:"flex",flexDirection:"column"},children:[e.jsx("div",{style:{marginBottom:"12px",flexShrink:0},children:e.jsxs(X,{type:"secondary",children:["找到 ",r.length," 张卡片"]})}),e.jsx("div",{style:{flex:1,overflow:"hidden",minHeight:"150px",border:"1px solid #d9d9d9",borderRadius:"6px",backgroundColor:"#fff",boxShadow:"0 1px 3px rgba(0,0,0,0.1)",display:"flex",flexDirection:"column"},children:e.jsx("div",{style:{flex:1,overflow:"auto",minHeight:0,padding:"4px"},children:r.map(b)})})]})]})]})},{TextArea:Ti}=_e,{Title:_i,Text:Ne}=ne,Ii=({cards:t,onCardsChange:i,initialYdkText:l=""})=>{const[n,r]=x.useState(l),[s,o]=x.useState(!1),[c,h]=x.useState(!1),[u,p]=x.useState(null),[g,f]=x.useState(!0),[y,w]=x.useState(!1),[j,d]=x.useState(null),b=x.useCallback(()=>{if(t.length===0)return`#created by Card PDF Generator
#main
#extra
!side
`;const C=[...t].sort((I,D)=>(I.firstIndex||0)-(D.firstIndex||0));let S=`#created by Card PDF Generator
#main
`;return C.forEach(I=>{for(let D=0;D<I.count;D++)S+=`${I.id}
`}),S+=`#extra
`,S+=`!side
`,S},[t]);x.useEffect(()=>{s||r(b())},[t,s,b]);const m=x.useCallback(C=>{try{if(!$e(C))return p("YDK格式无效"),d(null),!1;const S=de(C);return d(S),p(null),!0}catch(S){return p(S instanceof Error?S.message:"解析失败"),d(null),!1}},[]);x.useEffect(()=>{n.trim()?m(n):(p(null),d(null))},[n,m]);const a=x.useCallback(async()=>{if(m(n)){h(!0);try{const C=de(n);let S=ke(C,!0,!0);g&&(S=await Pi(S)),i(S),o(!1),p(null)}catch(C){p(C instanceof Error?C.message:"应用更改失败")}finally{h(!1)}}},[n,g,i,m]),v=x.useCallback(()=>{r(b()),o(!1),p(null)},[b]),P=x.useCallback(()=>{const C=new Blob([n],{type:"text/plain;charset=utf-8"}),S=URL.createObjectURL(C),I=document.createElement("a");I.href=S,I.download=`deck_${new Date().toISOString().slice(0,10)}.ydk`,document.body.appendChild(I),I.click(),document.body.removeChild(I),URL.revokeObjectURL(S)},[n]),k=j?{main:j.main.length,extra:j.extra.length,side:j.side.length,total:j.main.length+j.extra.length+j.side.length}:null;return e.jsxs("div",{style:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{padding:"16px 16px 0 16px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[e.jsxs(_i,{level:5,style:{margin:0},children:[e.jsx(Ze,{})," YDK编辑器"]}),e.jsxs(T,{children:[e.jsx(ee,{title:"自动获取卡片中文名称",children:e.jsxs(T,{children:[e.jsx(Ne,{style:{fontSize:"12px"},children:"自动获取卡名"}),e.jsx(Ge,{size:"small",checked:g,onChange:f})]})}),e.jsx(_,{size:"small",icon:e.jsx(Xe,{}),onClick:()=>w(!0),disabled:!j,children:"预览"}),e.jsx(_,{size:"small",icon:e.jsx(Je,{}),onClick:P,disabled:!n.trim(),children:"下载"})]})]}),k&&e.jsx(Qe,{size:"small",style:{marginBottom:"16px"},children:e.jsxs(Ct,{gutter:16,children:[e.jsx(ae,{span:6,children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"18px",fontWeight:"bold",color:"#1890ff"},children:k.main}),e.jsx("div",{style:{fontSize:"12px",color:"#666"},children:"主卡组"})]})}),e.jsx(ae,{span:6,children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"18px",fontWeight:"bold",color:"#52c41a"},children:k.extra}),e.jsx("div",{style:{fontSize:"12px",color:"#666"},children:"额外卡组"})]})}),e.jsx(ae,{span:6,children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"18px",fontWeight:"bold",color:"#fa8c16"},children:k.side}),e.jsx("div",{style:{fontSize:"12px",color:"#666"},children:"副卡组"})]})}),e.jsx(ae,{span:6,children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"18px",fontWeight:"bold",color:"#722ed1"},children:k.total}),e.jsx("div",{style:{fontSize:"12px",color:"#666"},children:"总计"})]})})]})}),u&&e.jsx(K,{message:"格式错误",description:u,type:"error",showIcon:!0,style:{marginBottom:"16px"}})]}),e.jsxs("div",{style:{flex:1,padding:"0 16px 16px 16px",display:"flex",flexDirection:"column"},children:[e.jsx(Ti,{value:n,onChange:C=>{r(C.target.value),s||o(!0)},placeholder:"在这里编辑YDK文件内容...",style:{flex:1,fontFamily:"monospace",fontSize:"12px",resize:"none"},autoSize:!1}),e.jsxs("div",{style:{marginTop:"12px",display:"flex",justifyContent:"space-between"},children:[e.jsx(T,{children:e.jsxs(Ne,{type:"secondary",style:{fontSize:"11px"},children:[e.jsx(kt,{}),' 支持实时编辑，修改后点击"应用更改"生效']})}),e.jsxs(T,{children:[e.jsx(_,{size:"small",icon:e.jsx($t,{}),onClick:v,disabled:!s,children:"重置"}),e.jsx(_,{type:"primary",size:"small",icon:e.jsx(zt,{}),onClick:a,loading:c,disabled:!s||!!u,children:"应用更改"})]})]})]}),e.jsx(Tt,{title:"YDK预览",open:y,onCancel:()=>w(!1),footer:[e.jsx(_,{onClick:()=>w(!1),children:"关闭"},"close")],width:600,children:j&&e.jsx(Te,{defaultActiveKey:"main",items:[{key:"main",label:`主卡组 (${j.main.length})`,children:e.jsx("div",{style:{maxHeight:"300px",overflow:"auto"},children:j.main.map((C,S)=>e.jsx("div",{style:{padding:"4px 8px",backgroundColor:S%2===0?"#fafafa":"white",fontSize:"12px"},children:C},S))})},{key:"extra",label:`额外卡组 (${j.extra.length})`,children:e.jsx("div",{style:{maxHeight:"300px",overflow:"auto"},children:j.extra.map((C,S)=>e.jsx("div",{style:{padding:"4px 8px",backgroundColor:S%2===0?"#fafafa":"white",fontSize:"12px"},children:C},S))})},{key:"side",label:`副卡组 (${j.side.length})`,children:e.jsx("div",{style:{maxHeight:"300px",overflow:"auto"},children:j.side.map((C,S)=>e.jsx("div",{style:{padding:"4px 8px",backgroundColor:S%2===0?"#fafafa":"white",fontSize:"12px"},children:C},S))})}]})})]})},{Dragger:Ri}=_t,{Title:Ei,Text:O}=ne,{TextArea:Di}=_e,Li=({cards:t,imageStatus:i,onCardsChange:l,onImageFolderSelect:n,hasImageFolder:r})=>{const[s,o]=x.useState(""),[c,h]=x.useState(!1),[u,p]=x.useState("upload"),[g,f]=x.useState(!1),y=async a=>{try{f(!0);const v=await mi(a);if(!$e(v))throw new Error("无效的YDK文件格式");const P=de(v);let $=ke(P,!0,!0);console.log("YDK解析结果:",{main:P.main.length,extra:P.extra.length,side:P.side.length,总卡片数:$.length});try{$=await Fe($),console.log("卡片名称获取完成（仅本地图片）")}catch(k){console.warn("获取卡片名称失败:",k)}l($),o(v),p("deck-info")}catch(v){console.error("YDK文件解析失败:",v)}finally{f(!1)}return!1},w=async()=>{try{if(f(!0),!$e(s))throw new Error("无效的YDK格式");const a=de(s);let v=ke(a,!0,!0);console.log("YDK文本解析结果:",{main:a.main.length,extra:a.extra.length,side:a.side.length,总卡片数:v.length});try{v=await Fe(v),console.log("卡片名称获取完成（仅本地图片）")}catch(P){console.warn("获取卡片名称失败:",P)}l(v),h(!1),p("deck-info")}catch(a){console.error("YDK文本解析失败:",a)}finally{f(!1)}},j=()=>{l([]),o(""),p("upload")},d=a=>{const v=t.findIndex(P=>P.id===a.id);if(v>=0){const P=[...t];P[v]={...P[v],count:P[v].count+a.count},l(P)}else{const P=[...t,a];l(P),t.length===0&&p("deck-info")}},m=(()=>{const a=t.reduce(($,k)=>$+k.count,0),v=t.filter($=>$.hasImage).reduce(($,k)=>$+k.count,0),P=a-v;return{total:a,found:v,missing:P}})();return e.jsxs("div",{className:"deck-panel",children:[e.jsx("div",{className:"section-title",children:e.jsx(Ei,{level:4,children:"卡组管理"})}),e.jsx("div",{style:{height:"calc(100vh - 120px)",display:"flex",flexDirection:"column"},children:e.jsx("div",{style:{flex:1,minHeight:"0",display:"flex",flexDirection:"column"},children:e.jsx(Te,{activeKey:u,onChange:p,style:{height:"100%",display:"flex",flexDirection:"column"},tabBarStyle:{flexShrink:0},items:[{key:"upload",label:e.jsxs("span",{children:[e.jsx(De,{}),"文件导入"]}),children:e.jsxs("div",{style:{padding:"16px",height:"100%",overflow:"auto",display:"flex",flexDirection:"column"},children:[e.jsxs(T,{direction:"vertical",style:{width:"100%"},children:[c?e.jsxs("div",{children:[e.jsx(Di,{value:s,onChange:a=>o(a.target.value),placeholder:"粘贴YDK文本内容...",rows:6,style:{marginBottom:12}}),e.jsxs(T,{children:[e.jsx(_,{type:"primary",onClick:w,loading:g,children:"导入"}),e.jsx(_,{onClick:()=>h(!1),children:"取消"})]})]}):e.jsxs(Ri,{accept:".ydk",beforeUpload:y,showUploadList:!1,style:{padding:"20px 16px"},children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(De,{})}),e.jsx("p",{className:"ant-upload-text",children:"点击或拖拽YDK文件到此区域"}),e.jsx("p",{className:"ant-upload-hint",children:"支持.ydk格式的卡组文件"})]}),e.jsx("div",{children:e.jsxs(T,{children:[e.jsx(_,{icon:e.jsx(It,{}),onClick:()=>h(!c),size:"small",children:c?"文件上传":"文本导入"}),t.length>0&&e.jsx(_,{onClick:j,size:"small",danger:!0,children:"清空卡组"})]})})]}),e.jsx(qe,{}),e.jsx("div",{style:{marginBottom:16},children:e.jsxs(T,{direction:"vertical",style:{width:"100%"},children:[e.jsx(O,{strong:!0,children:"图片文件夹:"}),e.jsx(_,{icon:e.jsx(Rt,{}),onClick:n,type:r?"default":"primary",block:!0,children:r?"重新选择图片文件夹":"选择图片文件夹"}),r&&e.jsx(K,{message:"图片文件夹已选择",description:"文件命名格式: 卡片ID.jpg 或 卡片ID_卡片名.jpg",type:"success",showIcon:!0}),e.jsxs("div",{style:{marginTop:12,padding:"12px",backgroundColor:"#f8f9fa",borderRadius:"6px",border:"1px solid #e9ecef"},children:[e.jsx(O,{strong:!0,style:{fontSize:13,color:"#495057"},children:"推荐卡图下载:"}),e.jsx("div",{style:{marginTop:8},children:e.jsx("a",{href:"https://www.bilibili.com/opus/1069400080244539448?from=search&spm_id_from=333.337.0.0",target:"_blank",rel:"noopener noreferrer",style:{display:"block",color:"#1890ff",textDecoration:"none",fontSize:12,padding:"4px 8px",backgroundColor:"#fff",borderRadius:"4px",border:"1px solid #d9d9d9",transition:"all 0.2s"},onMouseEnter:a=>{a.currentTarget.style.backgroundColor="#f0f8ff",a.currentTarget.style.borderColor="#1890ff"},onMouseLeave:a=>{a.currentTarget.style.backgroundColor="#fff",a.currentTarget.style.borderColor="#d9d9d9"},children:"📦 中文高清卡图资源包 (Bilibili)"})}),e.jsx("div",{style:{marginTop:6},children:e.jsx(O,{type:"secondary",style:{fontSize:11},children:'💡 提示: 下载后解压到文件夹，按"卡片ID.jpg"格式命名图片文件'})})]})]})}),(i.isProcessing||g)&&e.jsxs("div",{style:{marginBottom:16},children:[e.jsx(O,{children:g?"正在获取卡片信息...":"正在加载图片..."}),e.jsx(Se,{percent:i.isProcessing?Math.round(i.loaded/i.total*100):void 0,size:"small"})]})]})},{key:"search",label:e.jsxs("span",{children:[e.jsx(Ke,{}),"卡片搜索"]}),children:e.jsx("div",{style:{height:"100%",overflow:"hidden",display:"flex",flexDirection:"column"},children:e.jsx(zi,{onAddCard:d,existingCards:t})})},{key:"editor",label:e.jsxs("span",{children:[e.jsx(Ze,{}),"YDK编辑器"]}),children:e.jsx("div",{style:{height:"100%",display:"flex",flexDirection:"column",overflow:"hidden"},children:e.jsx(Ii,{cards:t,onCardsChange:l,initialYdkText:s})})},{key:"deck-info",label:e.jsx("span",{children:"📊 卡组信息"}),children:e.jsx("div",{style:{height:"100%",display:"flex",flexDirection:"column",overflow:"hidden"},children:t.length===0?e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"#999",fontSize:"14px"},children:"请先导入卡组数据"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{backgroundColor:"#fff",borderBottom:"1px solid #f0f0f0",flexShrink:0},children:[e.jsx("div",{style:{padding:"12px 16px",borderBottom:"1px solid #f0f0f0",backgroundColor:"#fafafa"},children:e.jsx(O,{strong:!0,children:"卡组统计"})}),e.jsxs("div",{style:{padding:"12px 16px"},children:[e.jsxs("div",{className:"grid-stats",style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"12px",marginBottom:"12px"},children:[e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"18px",fontWeight:"bold",color:"#333"},children:t.length}),e.jsx("div",{style:{fontSize:"12px",color:"#666"},children:"种类"})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"18px",fontWeight:"bold",color:"#333"},children:m.total}),e.jsx("div",{style:{fontSize:"12px",color:"#666"},children:"总数"})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"18px",fontWeight:"bold",color:"#52c41a"},children:m.found}),e.jsx("div",{style:{fontSize:"12px",color:"#666"},children:"已找到"})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"18px",fontWeight:"bold",color:"#ff4d4f"},children:m.missing}),e.jsx("div",{style:{fontSize:"12px",color:"#666"},children:"缺失"})]})]}),m.total>0&&e.jsxs("div",{style:{marginBottom:"12px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"6px"},children:[e.jsx(O,{style:{fontSize:"12px"},children:"完整度"}),e.jsxs(O,{style:{fontSize:"12px",fontWeight:"bold"},children:[Math.round(m.found/m.total*100),"%"]})]}),e.jsx(Se,{percent:Math.round(m.found/m.total*100),status:m.missing>0?"active":"success",size:"small",showInfo:!1})]}),t.some(a=>a.imageSource)&&e.jsxs("div",{style:{marginBottom:"12px"},children:[e.jsx(O,{style:{fontSize:"12px",color:"#666",marginBottom:"6px",display:"block"},children:"图片来源 (仅本地图片可用于PDF)"}),e.jsx("div",{style:{fontSize:"11px"},children:e.jsxs(T,{direction:"horizontal",size:"middle",wrap:!0,children:[t.filter(a=>a.imageSource==="local"&&a.hasImage).length>0&&e.jsxs("span",{style:{color:"#52c41a"},children:["📁 本地: ",t.filter(a=>a.imageSource==="local"&&a.hasImage).length]}),t.filter(a=>a.imageSource==="momobako"&&a.hasImage).length>0&&e.jsxs("span",{style:{color:"#f57c00"},children:["🚀 Momobako: ",t.filter(a=>a.imageSource==="momobako"&&a.hasImage).length]}),t.filter(a=>a.imageSource==="yugipedia"&&a.hasImage).length>0&&e.jsxs("span",{style:{color:"#f57c00"},children:["🌐 Yugipedia: ",t.filter(a=>a.imageSource==="yugipedia"&&a.hasImage).length]}),t.filter(a=>a.imageSource==="fallback"&&a.hasImage).length>0&&e.jsxs("span",{style:{color:"#f57c00"},children:["🔄 备用: ",t.filter(a=>a.imageSource==="fallback"&&a.hasImage).length]})]})})]}),i.missing.length>0&&e.jsx(K,{message:`${i.missing.length} 张卡片缺失本地图片`,type:"warning",showIcon:!0,style:{marginTop:"8px",fontSize:"12px"}})]})]}),e.jsxs("div",{style:{flex:1,backgroundColor:"#fff",display:"flex",flexDirection:"column",minHeight:"0"},children:[e.jsx("div",{style:{padding:"12px 16px",borderBottom:"1px solid #f0f0f0",backgroundColor:"#fafafa",flexShrink:0},children:e.jsx(O,{strong:!0,children:"卡片列表"})}),e.jsx("div",{style:{flex:1,overflow:"auto",minHeight:"0"},children:e.jsx(Le,{size:"small",dataSource:t,renderItem:a=>e.jsx(Le.Item,{style:{padding:"10px 16px",borderBottom:"1px solid #f5f5f5"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",width:"100%"},children:[e.jsx("div",{style:{width:"6px",height:"6px",borderRadius:"50%",backgroundColor:a.hasImage?"#52c41a":"#ff4d4f",marginRight:"10px",flexShrink:0}}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{fontSize:"13px",fontWeight:500,color:a.hasImage?"#333":"#ff4d4f",lineHeight:"18px"},children:[a.id,!a.hasImage&&e.jsx("span",{style:{color:"#ff4d4f",fontSize:"10px",marginLeft:"6px"},children:"[缺失]"})]}),a.name&&e.jsx("div",{style:{fontSize:"11px",color:"#666",lineHeight:"16px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:a.name}),a.imageSource&&a.hasImage&&e.jsx("div",{style:{fontSize:"10px",color:a.imageSource==="local"?"#52c41a":"#f57c00",lineHeight:"14px"},children:a.imageSource==="local"?"📁 本地":a.imageSource==="momobako"?"🚀 Momobako CDN":a.imageSource==="yugipedia"?"🌐 Yugipedia":"🔄 备用源"})]}),e.jsx(V,{color:a.hasImage?"success":"error",style:{fontSize:"11px",lineHeight:"18px",margin:0,minWidth:"36px",textAlign:"center"},children:a.count})]})})})})]})]})})}]})})})]})},Ai=[".jpg",".jpeg",".png",".webp"];async function Mi(t,i,l){const n=[...i],r=[];let s=0;const o=i.length,c=new Map,h=[];try{for await(const[u,p]of t.entries())if(p.kind==="file"){const g=await p.getFile(),f=u.toLowerCase().substring(u.lastIndexOf("."));if(Ai.includes(f)){h.push(u);const y=[/^(\d{8})(?:[_\-\.]|$)/,/^(\d+)(?:[_\-\.]|$)/];let w=null;for(const j of y){const d=u.match(j);if(d){w=d[1],w=w.padStart(8,"0");break}}if(w){c.set(w,g);const j=w.replace(/^0+/,"")||"0";j!==w&&c.set(j,g),console.log(`找到图片: ${u} -> 卡片ID: ${w} (也映射为: ${j})`)}else console.warn(`无法解析图片文件名: ${u}`)}}console.log(`扫描完成，找到 ${h.length} 个图片文件:`,h),console.log(`成功匹配 ${c.size} 个卡片ID:`,Array.from(c.keys())),console.log("需要查找的卡片ID:",i.map(u=>u.id));for(let u=0;u<n.length;u++){const p=n[u];let g=c.get(p.id);if(!g){const f=p.id.replace(/^0+/,"")||"0",y=f.padStart(8,"0");g=c.get(y),g||(g=c.get(f)),g&&console.log(`通过变换ID找到图片: ${p.id} -> ${f} -> ${g.name}`)}if(g){const f=URL.createObjectURL(g);n[u]={...p,imageUrl:f,hasImage:!0},s++,console.log(`成功加载图片: ${p.id} -> ${g.name}`)}else r.push(p.id),n[u]={...p,hasImage:!1},console.warn(`未找到图片: ${p.id}`);l&&l(s,o,r)}}catch(u){throw console.error("加载图片时出错:",u),new Error("无法访问图片文件夹")}return n}function Hi(t){return new Promise((i,l)=>{const n=new Image;n.onload=()=>i(n),n.onerror=()=>l(new Error(`图片加载失败: ${t}`)),n.src=t})}function Wi(t,i,l,n="fill",r=2){const s=document.createElement("canvas"),o=s.getContext("2d"),c=i*r,h=l*r;s.width=c,s.height=h,o.imageSmoothingEnabled=!0,o.imageSmoothingQuality="high",o.fillStyle="#ffffff",o.fillRect(0,0,c,h);const{width:u,height:p}=t,g=i/l,f=u/p;let y,w,j,d;return n==="fit"?f>g?(y=c,w=c/f,j=0,d=(h-w)/2):(w=h,y=h*f,j=(c-y)/2,d=0):f>g?(w=h,y=h*f,j=(c-y)/2,d=0):(y=c,w=c/f,j=0,d=(h-w)/2),o.drawImage(t,j,d,y,w),s}function Oi(t){for(const i of t)i.imageUrl&&URL.revokeObjectURL(i.imageUrl)}const M=28.35;function je(t){const{cardSize:i,spacing:l,pageSettings:n,orientation:r,cardRotation:s}=t;let o=i.width*M,c=i.height*M;s==="rotated"&&(console.log("旋转前尺寸:",{cardWidthPt:o,cardHeightPt:c}),[o,c]=[c,o],console.log("旋转后尺寸:",{cardWidthPt:o,cardHeightPt:c}));const h=l.horizontal*M,u=l.vertical*M,p=n.margin*M;let g,f;r==="landscape"?(g=n.height*M,f=n.width*M):(g=n.width*M,f=n.height*M);const y=g-2*p,w=f-2*p,j=Math.floor(h===0?y/o:(y+h)/(o+h)),d=Math.floor(u===0?w/c:(w+u)/(c+u)),b=j*d;return{columns:j,rows:d,cardsPerPage:b,cardWidthPt:o,cardHeightPt:c,spacingHPt:h,spacingVPt:u,marginPt:p,pageWidthPt:g,pageHeightPt:f,availableWidth:y,availableHeight:w,orientation:r,cardRotation:s}}function xt(t,i){const l=je(i),n=[],r=[];for(const s of t)for(let o=0;o<s.count;o++)r.push({...s,count:1});for(let s=0;s<r.length;s+=l.cardsPerPage){const o=r.slice(s,s+l.cardsPerPage);n.push({cards:o,layout:{columns:l.columns,rows:l.rows}})}return n}async function Bi(t,i,l){const n=je(i),r=xt(t,i);l&&l(0,r.length,"初始化PDF文档...");const s=await Mt.create(),o=new Map,c=t.filter(u=>u.hasImage&&u.imageUrl&&u.imageSource==="local");l&&l(0,c.length,"预加载图片...");for(let u=0;u<c.length;u++){const p=c[u];if(p.imageUrl&&!o.has(p.id))try{const g=await Hi(p.imageUrl);o.set(p.id,g)}catch(g){console.warn(`图片加载失败: ${p.id}`,g)}l&&l(u+1,c.length,"预加载图片...")}for(let u=0;u<r.length;u++){const p=r[u];l&&l(u+1,r.length,`生成第${u+1}页...`);const g=s.addPage([n.pageWidthPt,n.pageHeightPt]);for(let f=0;f<p.cards.length;f++){const y=p.cards[f],w=f%p.layout.columns,j=Math.floor(f/p.layout.columns);let d=n.spacingHPt===0?n.marginPt+w*n.cardWidthPt:n.marginPt+w*(n.cardWidthPt+n.spacingHPt),b=n.spacingVPt===0?n.pageHeightPt-n.marginPt-(j+1)*n.cardHeightPt:n.pageHeightPt-n.marginPt-(j+1)*(n.cardHeightPt+n.spacingVPt)+n.spacingVPt;const m=i.cardSize.width*M,a=i.cardSize.height*M;if(y.hasImage&&y.imageUrl&&y.imageSource==="local"&&o.has(y.id)){const v=o.get(y.id),P=Wi(v,m,a,i.cropMode,i.imageQuality.resolution),$=Fi(P,i.imageQuality.quality,i.imageQuality.format),k=i.imageQuality.format==="png"?await s.embedPng($):await s.embedJpg($);if(i.cardRotation==="rotated"){const C=d+n.cardWidthPt/2,S=b+n.cardHeightPt/2;g.drawImage(k,{x:C-a/2,y:S+m/2,width:m,height:a,rotate:ve(-90)})}else g.drawImage(k,{x:d,y:b,width:n.cardWidthPt,height:n.cardHeightPt});i.showCuttingLines&&Yi(g,d,b,n.cardWidthPt,n.cardHeightPt,n.pageHeightPt,i.cuttingLineWidth)}else if(i.cardRotation==="rotated"){const v=d+n.cardWidthPt/2,P=b+n.cardHeightPt/2;g.drawRectangle({x:v-a/2,y:P+m/2,width:m,height:a,borderColor:N(.8,.8,.8),borderWidth:1,color:N(.95,.95,.95),rotate:ve(-90)}),g.drawText(y.id||"未知",{x:v,y:P,size:8,color:N(.5,.5,.5),rotate:ve(-90)})}else g.drawRectangle({x:d,y:b,width:n.cardWidthPt,height:n.cardHeightPt,borderColor:N(.8,.8,.8),borderWidth:1,color:N(.95,.95,.95)}),g.drawText(y.id||"未知",{x:d+n.cardWidthPt/2-30,y:b+n.cardHeightPt/2,size:8,color:N(.5,.5,.5)})}}return l&&l(r.length,r.length,"保存PDF文件..."),await s.save()}function Fi(t,i=.95,l="png"){const n=l==="png"?"image/png":"image/jpeg",s=t.toDataURL(n,i).split(",")[1],o=atob(s),c=new Uint8Array(o.length);for(let h=0;h<o.length;h++)c[h]=o.charCodeAt(h);return c}function Ni(t,i="yugioh_cards.pdf"){const l=new Blob([t],{type:"application/pdf"}),n=URL.createObjectURL(l),r=document.createElement("a");r.href=n,r.download=i,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n)}function Yi(t,i,l,n,r,s,o=.5){const c=N(.6,.6,.6),h=o/2,u=i+n+h,p=l-h,g=i-h,f=l+r+h,y=t.getWidth();t.drawLine({start:{x:0,y:p},end:{x:y,y:p},thickness:o,color:c}),t.drawLine({start:{x:u,y:0},end:{x:u,y:s},thickness:o,color:c}),t.drawLine({start:{x:0,y:f},end:{x:y,y:f},thickness:o,color:c}),t.drawLine({start:{x:g,y:0},end:{x:g,y:s},thickness:o,color:c})}function Ui(){const t=di();return{cardSize:{width:5.9,height:8.6},spacing:{horizontal:.6,vertical:.6},pageSettings:{width:t.width,height:t.height,margin:.6},cropMode:"fill",orientation:"portrait",cardRotation:"normal",imageQuality:{resolution:3,quality:.95,format:"png"},showCuttingLines:!0,cuttingLineWidth:.5}}function Ye(t){const i=je(t);console.log("=== 布局调试信息 ==="),console.log("页面方向:",t.orientation),console.log("页面尺寸 (pt):",{width:i.pageWidthPt,height:i.pageHeightPt}),console.log("页边距 (pt):",i.marginPt),console.log("可用区域 (pt):",{width:i.availableWidth,height:i.availableHeight}),console.log("卡片尺寸 (pt):",{width:i.cardWidthPt,height:i.cardHeightPt}),console.log("间距 (pt):",{horizontal:i.spacingHPt,vertical:i.spacingVPt}),console.log("网格:",{columns:i.columns,rows:i.rows}),console.log("每页卡片数:",i.cardsPerPage);const l=i.spacingHPt===0?i.columns*i.cardWidthPt:i.columns*i.cardWidthPt+(i.columns-1)*i.spacingHPt,n=i.spacingVPt===0?i.rows*i.cardHeightPt:i.rows*i.cardHeightPt+(i.rows-1)*i.spacingVPt;if(console.log("实际使用区域 (pt):",{width:l,height:n}),console.log("剩余空间 (pt):",{width:i.availableWidth-l,height:i.availableHeight-n}),i.columns>0&&i.rows>0){const r=i.marginPt,s=i.pageHeightPt-i.marginPt-i.cardHeightPt;if(console.log("第一张卡片位置 (pt):",{x:r,y:s}),i.columns>1){const o=i.spacingHPt===0?i.marginPt+i.cardWidthPt:i.marginPt+i.cardWidthPt+i.spacingHPt;console.log("第二张卡片位置 (pt):",{x:o,y:s})}}return i}const ie=()=>window.innerWidth<=768,ze=()=>window.innerWidth<=480,Vi=()=>"ontouchstart"in window||navigator.maxTouchPoints>0,Ue=()=>ze()?30:ie()?50:80,qi=()=>{if(!ie())return;const t=document.querySelector("meta[name=viewport]"),i=t==null?void 0:t.content;document.addEventListener("focusin",l=>{(l.target instanceof HTMLInputElement||l.target instanceof HTMLTextAreaElement)&&t&&(t.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no")}),document.addEventListener("focusout",()=>{t&&i&&(t.content=i)})},Gi=()=>{typeof window>"u"||(qi(),ie()&&document.body.classList.add("mobile-device"),Vi()&&document.body.classList.add("touch-device"),ze()&&document.body.classList.add("small-screen"),window.addEventListener("orientationchange",()=>{setTimeout(()=>{window.scrollTo(0,0)},100)}),window.addEventListener("resize",()=>{const t=document.body;t.classList.toggle("mobile-device",ie()),t.classList.toggle("small-screen",ze())}))},{Title:Ki,Text:Ve}=ne,Qi=({cards:t,layout:i,isGenerating:l,onGeneratePdf:n,hasImageFolder:r})=>{const[s,o]=J.useState(()=>Ue()),[c,h]=J.useState(1);x.useEffect(()=>{const a=()=>{ie()&&o(Ue())};return window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]);const u=x.useMemo(()=>{if(t.length===0)return{pages:[],layoutInfo:null};const a=je(i),v=xt(t,i);return i.spacing.horizontal===0&&i.spacing.vertical===0&&(console.log("调试零间距布局:"),Ye(i)),i.pageSettings.margin!==1&&(console.log(`调试页边距 ${i.pageSettings.margin}cm:`),Ye(i)),{pages:v,layoutInfo:a}},[t,i]),{pages:p,layoutInfo:g}=u,f=J.useCallback(()=>{if(!g)return 80;const a=document.querySelector(".preview-content");if(!a)return 80;const v=a.clientWidth-40;let P=40;p.length>1&&(P+=80);const $=a.clientHeight-P,k=g.pageWidthPt,C=g.pageHeightPt,S=v/k*100,I=$/C*100,D=Math.min(S,I,400);return Math.max(25,Math.floor(D))},[g,p.length]),y=()=>{const a=f();o(a)};J.useEffect(()=>{g&&p.length>0&&setTimeout(()=>{const a=f();a>25&&o(a)},100)},[g,p.length,f]);const w=(a,v,P=0,$=0)=>{const k=P>0||$>0,C=i.cardRotation==="rotated";return e.jsx("div",{className:`card-item ${a.hasImage?"":"missing"} ${k?"":"no-spacing"} ${C?"rotated":""}`,style:{width:"100%",height:"100%",fontSize:`${Math.max(8,12*s/100)}px`,display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"},children:a.hasImage&&a.imageUrl?e.jsx("img",{src:a.imageUrl,alt:a.id,style:{width:"100%",height:"100%",objectFit:i.cropMode==="fill"?"cover":"contain"}}):e.jsxs("div",{style:{padding:"4px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"80%",marginBottom:"2px"},children:"缺失图片"}),e.jsx("div",{style:{fontSize:"70%",opacity:.7},children:a.id}),a.name&&e.jsx("div",{style:{fontSize:"60%",opacity:.5,marginTop:"2px",wordBreak:"break-all"},children:a.name})]})})},j=(a,v)=>{if(!g)return null;const P=g.pageWidthPt*s/100,$=g.pageHeightPt*s/100,k=g.marginPt*s/100,C=g.spacingHPt*s/100,S=g.spacingVPt*s/100;return e.jsxs("div",{className:"pdf-page",style:{width:`${P}px`,height:`${$}px`,margin:"0 auto"},children:[e.jsx("div",{className:"card-container",style:{position:"relative",width:`${P-2*k}px`,height:`${$-2*k}px`,left:`${k}px`,top:`${k}px`,border:i.pageSettings.margin>0?"1px dashed rgba(255, 0, 0, 0.3)":"none",boxSizing:"border-box"},children:a.cards.map((I,D)=>{const B=D%a.layout.columns,F=Math.floor(D/a.layout.columns),R=g.cardWidthPt*s/100,E=g.cardHeightPt*s/100;D===0&&console.log("卡片尺寸调试:",{rotation:i.cardRotation,originalSize:i.cardSize,rotatedWidth:R,rotatedHeight:E,widthPt:g.cardWidthPt,heightPt:g.cardHeightPt,zoomLevel:s,aspectRatio:R/E,expectedRatio:i.cardRotation==="rotated"?8.6/5.9:5.9/8.6,containerWidth:`${R}px`,containerHeight:`${E}px`});let Y,U;return i.cardRotation==="rotated"?(Y=C===0?B*R-(E-R)/2:B*(R+C)-(E-R)/2,U=S===0?F*E-(R-E)/2:F*(E+S)-(R-E)/2):(Y=C===0?B*R:B*(R+C),U=S===0?F*E:F*(E+S)),e.jsx("div",{style:{position:"absolute",left:`${Y}px`,top:`${U}px`,width:`${R}px`,height:`${E}px`,...i.cardRotation==="rotated"&&{width:`${E}px`,height:`${R}px`}},children:w(I,D,C,S)},`${I.id}-${D}`)})}),i.showCuttingLines&&a.cards.map((I,D)=>{const B=D%a.layout.columns,F=Math.floor(D/a.layout.columns),R=g.cardWidthPt*s/100,E=g.cardHeightPt*s/100,Y=k+(C===0?B*R:B*(R+C)),U=k+(S===0?F*E:F*(E+S)),re=Math.max(.5,(i.cuttingLineWidth||.5)*1.33*s/100),yt=Y+R,jt=U+E,vt=Y,wt=U;return e.jsxs("div",{children:[e.jsx("div",{style:{position:"absolute",left:0,top:`${jt}px`,width:"100%",height:`${re}px`,backgroundColor:"#999",pointerEvents:"none",zIndex:10}}),e.jsx("div",{style:{position:"absolute",left:`${yt}px`,top:0,width:`${re}px`,height:"100%",backgroundColor:"#999",pointerEvents:"none",zIndex:10}}),e.jsx("div",{style:{position:"absolute",left:0,top:`${wt}px`,width:"100%",height:`${re}px`,backgroundColor:"#999",pointerEvents:"none",zIndex:10}}),e.jsx("div",{style:{position:"absolute",left:`${vt}px`,top:0,width:`${re}px`,height:"100%",backgroundColor:"#999",pointerEvents:"none",zIndex:10}})]},`cutting-${I.id}-${D}`)})]},v)},d=t.length>0&&r,b=t.reduce((a,v)=>a+v.count,0),m=t.filter(a=>a.hasImage).reduce((a,v)=>a+v.count,0);return e.jsxs("div",{className:"preview-area",children:[e.jsxs("div",{className:"preview-toolbar",children:[e.jsx("div",{children:e.jsxs(T,{align:"center",children:[e.jsx(Ki,{level:5,style:{margin:0},children:"预览"}),p.length>0&&e.jsxs(Ve,{type:"secondary",children:[p.length," 页 | ",b," 张卡片",m<b&&e.jsxs("span",{style:{color:"#ff4d4f"},children:["(",b-m," 张缺失)"]}),g&&e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{color:"#d9d9d9",margin:"0 8px"},children:"|"}),e.jsxs("span",{children:["每页 ",g.cardsPerPage," 张"]}),e.jsx("span",{style:{color:"#d9d9d9",margin:"0 8px"},children:"|"}),e.jsxs("span",{children:[g.columns," 列 × ",g.rows," 行"]}),e.jsx("span",{style:{color:"#d9d9d9",margin:"0 8px"},children:"|"}),e.jsxs("span",{children:["卡片 ",i.cardSize.width,"×",i.cardSize.height,"cm"]})]})]})]})}),e.jsxs(T,{children:[e.jsxs(T,{align:"center",children:[e.jsx(Et,{}),e.jsx(le,{value:s,onChange:o,min:25,max:400,style:{width:120},tooltip:{formatter:a=>`${a}%`}}),e.jsx(Dt,{}),e.jsxs(Ve,{style:{minWidth:40},children:[s,"%"]}),e.jsx(_,{size:"small",icon:e.jsx(Xe,{}),onClick:y,title:"适合窗口",children:"适合"}),e.jsxs(_.Group,{size:"small",children:[e.jsx(_,{onClick:()=>o(100),title:"实际大小",children:"100%"}),e.jsx(_,{onClick:()=>o(150),title:"放大显示",children:"150%"}),e.jsx(_,{onClick:()=>o(200),title:"高清显示",children:"200%"})]})]}),e.jsx(_,{type:"primary",icon:e.jsx(Je,{}),onClick:n,loading:l,disabled:!d,children:"生成PDF"})]})]}),e.jsx("div",{className:"preview-content",children:p.length===0?e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:"100%",padding:"60px 20px"},children:t.length===0?e.jsx(q,{image:q.PRESENTED_IMAGE_SIMPLE,description:"请先导入YDK卡组文件"}):r?e.jsx(Ie,{size:"large",tip:"正在计算排版..."}):e.jsx(q,{image:q.PRESENTED_IMAGE_SIMPLE,description:"请先选择图片文件夹"})}):e.jsxs("div",{style:{width:"100%",minHeight:"100%",display:"flex",flexDirection:"column"},children:[p.length>1&&e.jsx("div",{style:{textAlign:"center",padding:"20px 20px 10px 20px",position:"sticky",top:0,backgroundColor:"#fafafa",zIndex:10,borderBottom:"1px solid #f0f0f0"},children:e.jsx(Lt,{current:c,total:p.length,pageSize:1,onChange:h,showSizeChanger:!1,showQuickJumper:!0,showTitle:!1,showTotal:a=>`共 ${a} 页`})}),e.jsx("div",{style:{padding:"20px",display:"flex",justifyContent:"center",flex:1},children:p[c-1]&&j(p[c-1],c-1)})]})}),!d&&t.length>0&&e.jsx("div",{style:{position:"absolute",bottom:20,left:20,right:20},children:e.jsx(K,{message:"无法生成PDF",description:r?"请检查设置和卡组数据":"请先选择包含卡片图片的文件夹",type:"warning",showIcon:!0})})]})},Zi=()=>{const[t,i]=x.useState({cards:[],layout:Ui(),imageFolder:null,imageStatus:{total:0,loaded:0,missing:[],isProcessing:!1},pdfPages:[],isGenerating:!1});x.useEffect(()=>{Gi()},[]);const l=x.useCallback(c=>{i(h=>({...h,layout:c}))},[]),n=x.useCallback(async c=>{t.cards.length>0&&Oi(t.cards),i(h=>({...h,cards:c,imageStatus:{total:c.length,loaded:0,missing:[],isProcessing:!1}})),c.length>0&&t.imageFolder&&await s(c,t.imageFolder)},[t.imageFolder,t.cards]),r=x.useCallback(async()=>{try{if(!("showDirectoryPicker"in window)){W.error("您的浏览器不支持文件夹选择功能，请使用最新版Chrome或Edge浏览器");return}const c=await window.showDirectoryPicker();i(h=>({...h,imageFolder:c})),t.cards.length>0&&await s(t.cards,c),W.success("图片文件夹选择成功")}catch(c){c.name!=="AbortError"&&(console.error("选择文件夹失败:",c),W.error("选择文件夹失败"))}},[t.cards]),s=x.useCallback(async(c,h)=>{i(u=>({...u,imageStatus:{...u.imageStatus,isProcessing:!0}}));try{const u=await Mi(h,c,(g,f,y)=>{i(w=>({...w,imageStatus:{total:f,loaded:g,missing:y,isProcessing:g<f}}))});i(g=>({...g,cards:u,imageStatus:{...g.imageStatus,isProcessing:!1}}));const p=u.filter(g=>g.hasImage).length;W.success(`图片加载完成，找到 ${p}/${c.length} 张卡片图片`)}catch(u){console.error("加载图片失败:",u),W.error("加载图片失败: "+u.message),i(p=>({...p,imageStatus:{...p.imageStatus,isProcessing:!1}}))}},[]),o=x.useCallback(async()=>{if(t.cards.length===0){W.warning("请先导入卡组数据");return}if(!t.imageFolder){W.warning("请先选择图片文件夹");return}i(c=>({...c,isGenerating:!0}));try{const c=await Bi(t.cards,t.layout,(p,g,f)=>{console.log(`PDF生成进度: ${f} ${p}/${g}`)}),u=`yugioh_cards_${new Date().toISOString().slice(0,19).replace(/[:-]/g,"")}.pdf`;Ni(c,u),W.success("PDF生成成功")}catch(c){console.error("PDF生成失败:",c),W.error("PDF生成失败: "+c.message)}finally{i(c=>({...c,isGenerating:!1}))}},[t.cards,t.layout,t.imageFolder]);return e.jsxs("div",{className:"app-container",children:[e.jsx(ui,{layout:t.layout,onChange:l}),e.jsx(Qi,{cards:t.cards,layout:t.layout,isGenerating:t.isGenerating,onGeneratePdf:o,hasImageFolder:!!t.imageFolder}),e.jsx(Li,{cards:t.cards,imageStatus:t.imageStatus,onCardsChange:n,onImageFolderSelect:r,hasImageFolder:!!t.imageFolder}),t.isGenerating&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{style:{backgroundColor:"white",padding:"30px",borderRadius:"8px",textAlign:"center",minWidth:"300px"},children:[e.jsx(Se,{type:"circle",percent:0}),e.jsx("div",{style:{marginTop:"16px",fontSize:"16px"},children:"正在生成PDF文件..."}),e.jsx("div",{style:{marginTop:"8px",color:"#666",fontSize:"14px"},children:"请稍候，这可能需要几分钟时间"})]})})]})};Pe.createRoot(document.getElementById("root")).render(e.jsx(J.StrictMode,{children:e.jsx(At,{locale:ci,children:e.jsx(Zi,{})})}));
