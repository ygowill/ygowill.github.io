import{r as x,c as bt,g as St,R as J}from"./vendor-BTWMFwqw.js";import{T as ne,S as be,a as T,B as _,b as Q,R as A,c as Te,D as qe,d as ee,e as le,f as Ge,I as _e,g as Ke,A as K,h as Ie,E as q,C as Qe,i as V,j as Pt,k as Ee,l as Ze,m as Xe,n as Je,o as Ct,p as ae,q as kt,r as $t,s as zt,M as Tt,U as _t,t as De,u as It,v as Rt,P as Se,L as Le,w as Et,x as Dt,y as Lt,z as W,F as At}from"./antd-DtRgrIVE.js";import{P as Mt,d as ve,r as N}from"./pdf-CSTLUYz4.js";(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function l(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(r){if(r.ep)return;r.ep=!0;const s=l(r);fetch(r.href,s)}})();var et={exports:{}},he={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Ht=x,Wt=Symbol.for("react.element"),Ot=Symbol.for("react.fragment"),Bt=Object.prototype.hasOwnProperty,Ft=Ht.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,Nt={key:!0,ref:!0,__self:!0,__source:!0};function tt(t,i,l){var n,r={},s=null,o=null;l!==void 0&&(s=""+l),i.key!==void 0&&(s=""+i.key),i.ref!==void 0&&(o=i.ref);for(n in i)Bt.call(i,n)&&!Nt.hasOwnProperty(n)&&(r[n]=i[n]);if(t&&t.defaultProps)for(n in i=t.defaultProps,i)r[n]===void 0&&(r[n]=i[n]);return{$$typeof:Wt,type:t,key:s,ref:o,props:r,_owner:Ft.current}}he.Fragment=Ot;he.jsx=tt;he.jsxs=tt;et.exports=he;var e=et.exports,Pe={},Ae=bt;Pe.createRoot=Ae.createRoot,Pe.hydrateRoot=Ae.hydrateRoot;var ge={},it={exports:{}};(function(t){function i(l){return l&&l.__esModule?l:{default:l}}t.exports=i,t.exports.__esModule=!0,t.exports.default=t.exports})(it);var pe=it.exports,ue={};Object.defineProperty(ue,"__esModule",{value:!0});ue.default=void 0;var Yt={items_per_page:"æ¡/é¡µ",jump_to:"è·³è‡³",jump_to_confirm:"ç¡®å®š",page:"é¡µ",prev_page:"ä¸Šä¸€é¡µ",next_page:"ä¸‹ä¸€é¡µ",prev_5:"å‘å‰ 5 é¡µ",next_5:"å‘å 5 é¡µ",prev_3:"å‘å‰ 3 é¡µ",next_3:"å‘å 3 é¡µ",page_size:"é¡µç "};ue.default=Yt;var me={},se={},fe={},nt={exports:{}},st={exports:{}},ot={exports:{}},rt={exports:{}};(function(t){function i(l){"@babel/helpers - typeof";return t.exports=i=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},t.exports.__esModule=!0,t.exports.default=t.exports,i(l)}t.exports=i,t.exports.__esModule=!0,t.exports.default=t.exports})(rt);var at=rt.exports,lt={exports:{}};(function(t){var i=at.default;function l(n,r){if(i(n)!="object"||!n)return n;var s=n[Symbol.toPrimitive];if(s!==void 0){var o=s.call(n,r||"default");if(i(o)!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(n)}t.exports=l,t.exports.__esModule=!0,t.exports.default=t.exports})(lt);var Ut=lt.exports;(function(t){var i=at.default,l=Ut;function n(r){var s=l(r,"string");return i(s)=="symbol"?s:s+""}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports})(ot);var Vt=ot.exports;(function(t){var i=Vt;function l(n,r,s){return(r=i(r))in n?Object.defineProperty(n,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):n[r]=s,n}t.exports=l,t.exports.__esModule=!0,t.exports.default=t.exports})(st);var qt=st.exports;(function(t){var i=qt;function l(r,s){var o=Object.keys(r);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(r);s&&(c=c.filter(function(h){return Object.getOwnPropertyDescriptor(r,h).enumerable})),o.push.apply(o,c)}return o}function n(r){for(var s=1;s<arguments.length;s++){var o=arguments[s]!=null?arguments[s]:{};s%2?l(Object(o),!0).forEach(function(c){i(r,c,o[c])}):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(o)):l(Object(o)).forEach(function(c){Object.defineProperty(r,c,Object.getOwnPropertyDescriptor(o,c))})}return r}t.exports=n,t.exports.__esModule=!0,t.exports.default=t.exports})(nt);var Gt=nt.exports,xe={};Object.defineProperty(xe,"__esModule",{value:!0});xe.commonLocale=void 0;xe.commonLocale={yearFormat:"YYYY",dayFormat:"D",cellMeridiemFormat:"A",monthBeforeYear:!0};var Kt=pe.default;Object.defineProperty(fe,"__esModule",{value:!0});fe.default=void 0;var Me=Kt(Gt),Qt=xe,Zt=(0,Me.default)((0,Me.default)({},Qt.commonLocale),{},{locale:"zh_CN",today:"ä»Šå¤©",now:"æ­¤åˆ»",backToToday:"è¿”å›ä»Šå¤©",ok:"ç¡®å®š",timeSelect:"é€‰æ‹©æ—¶é—´",dateSelect:"é€‰æ‹©æ—¥æœŸ",weekSelect:"é€‰æ‹©å‘¨",clear:"æ¸…é™¤",week:"å‘¨",month:"æœˆ",year:"å¹´",previousMonth:"ä¸Šä¸ªæœˆ (ç¿»é¡µä¸Šé”®)",nextMonth:"ä¸‹ä¸ªæœˆ (ç¿»é¡µä¸‹é”®)",monthSelect:"é€‰æ‹©æœˆä»½",yearSelect:"é€‰æ‹©å¹´ä»½",decadeSelect:"é€‰æ‹©å¹´ä»£",previousYear:"ä¸Šä¸€å¹´ (Controlé”®åŠ å·¦æ–¹å‘é”®)",nextYear:"ä¸‹ä¸€å¹´ (Controlé”®åŠ å³æ–¹å‘é”®)",previousDecade:"ä¸Šä¸€å¹´ä»£",nextDecade:"ä¸‹ä¸€å¹´ä»£",previousCentury:"ä¸Šä¸€ä¸–çºª",nextCentury:"ä¸‹ä¸€ä¸–çºª",yearFormat:"YYYYå¹´",cellDateFormat:"D",monthBeforeYear:!1});fe.default=Zt;var oe={};Object.defineProperty(oe,"__esModule",{value:!0});oe.default=void 0;const Xt={placeholder:"è¯·é€‰æ‹©æ—¶é—´",rangePlaceholder:["å¼€å§‹æ—¶é—´","ç»“æŸæ—¶é—´"]};oe.default=Xt;var ct=pe.default;Object.defineProperty(se,"__esModule",{value:!0});se.default=void 0;var Jt=ct(fe),ei=ct(oe);const dt={lang:Object.assign({placeholder:"è¯·é€‰æ‹©æ—¥æœŸ",yearPlaceholder:"è¯·é€‰æ‹©å¹´ä»½",quarterPlaceholder:"è¯·é€‰æ‹©å­£åº¦",monthPlaceholder:"è¯·é€‰æ‹©æœˆä»½",weekPlaceholder:"è¯·é€‰æ‹©å‘¨",rangePlaceholder:["å¼€å§‹æ—¥æœŸ","ç»“æŸæ—¥æœŸ"],rangeYearPlaceholder:["å¼€å§‹å¹´ä»½","ç»“æŸå¹´ä»½"],rangeMonthPlaceholder:["å¼€å§‹æœˆä»½","ç»“æŸæœˆä»½"],rangeQuarterPlaceholder:["å¼€å§‹å­£åº¦","ç»“æŸå­£åº¦"],rangeWeekPlaceholder:["å¼€å§‹å‘¨","ç»“æŸå‘¨"]},Jt.default),timePickerLocale:Object.assign({},ei.default)};dt.lang.ok="ç¡®å®š";se.default=dt;var ti=pe.default;Object.defineProperty(me,"__esModule",{value:!0});me.default=void 0;var ii=ti(se);me.default=ii.default;var ye=pe.default;Object.defineProperty(ge,"__esModule",{value:!0});ge.default=void 0;var ni=ye(ue),si=ye(me),oi=ye(se),ri=ye(oe);const L="${label}ä¸æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„${type}",ai={locale:"zh-cn",Pagination:ni.default,DatePicker:oi.default,TimePicker:ri.default,Calendar:si.default,global:{placeholder:"è¯·é€‰æ‹©",close:"å…³é—­"},Table:{filterTitle:"ç­›é€‰",filterConfirm:"ç¡®å®š",filterReset:"é‡ç½®",filterEmptyText:"æ— ç­›é€‰é¡¹",filterCheckAll:"å…¨é€‰",filterSearchPlaceholder:"åœ¨ç­›é€‰é¡¹ä¸­æœç´¢",emptyText:"æš‚æ— æ•°æ®",selectAll:"å…¨é€‰å½“é¡µ",selectInvert:"åé€‰å½“é¡µ",selectNone:"æ¸…ç©ºæ‰€æœ‰",selectionAll:"å…¨é€‰æ‰€æœ‰",sortTitle:"æ’åº",expand:"å±•å¼€è¡Œ",collapse:"å…³é—­è¡Œ",triggerDesc:"ç‚¹å‡»é™åº",triggerAsc:"ç‚¹å‡»å‡åº",cancelSort:"å–æ¶ˆæ’åº"},Modal:{okText:"ç¡®å®š",cancelText:"å–æ¶ˆ",justOkText:"çŸ¥é“äº†"},Tour:{Next:"ä¸‹ä¸€æ­¥",Previous:"ä¸Šä¸€æ­¥",Finish:"ç»“æŸå¯¼è§ˆ"},Popconfirm:{cancelText:"å–æ¶ˆ",okText:"ç¡®å®š"},Transfer:{titles:["",""],searchPlaceholder:"è¯·è¾“å…¥æœç´¢å†…å®¹",itemUnit:"é¡¹",itemsUnit:"é¡¹",remove:"åˆ é™¤",selectCurrent:"å…¨é€‰å½“é¡µ",removeCurrent:"åˆ é™¤å½“é¡µ",selectAll:"å…¨é€‰æ‰€æœ‰",deselectAll:"å–æ¶ˆå…¨é€‰",removeAll:"åˆ é™¤å…¨éƒ¨",selectInvert:"åé€‰å½“é¡µ"},Upload:{uploading:"æ–‡ä»¶ä¸Šä¼ ä¸­",removeFile:"åˆ é™¤æ–‡ä»¶",uploadError:"ä¸Šä¼ é”™è¯¯",previewFile:"é¢„è§ˆæ–‡ä»¶",downloadFile:"ä¸‹è½½æ–‡ä»¶"},Empty:{description:"æš‚æ— æ•°æ®"},Icon:{icon:"å›¾æ ‡"},Text:{edit:"ç¼–è¾‘",copy:"å¤åˆ¶",copied:"å¤åˆ¶æˆåŠŸ",expand:"å±•å¼€",collapse:"æ”¶èµ·"},Form:{optional:"ï¼ˆå¯é€‰ï¼‰",defaultValidateMessages:{default:"å­—æ®µéªŒè¯é”™è¯¯${label}",required:"è¯·è¾“å…¥${label}",enum:"${label}å¿…é¡»æ˜¯å…¶ä¸­ä¸€ä¸ª[${enum}]",whitespace:"${label}ä¸èƒ½ä¸ºç©ºå­—ç¬¦",date:{format:"${label}æ—¥æœŸæ ¼å¼æ— æ•ˆ",parse:"${label}ä¸èƒ½è½¬æ¢ä¸ºæ—¥æœŸ",invalid:"${label}æ˜¯ä¸€ä¸ªæ— æ•ˆæ—¥æœŸ"},types:{string:L,method:L,array:L,object:L,number:L,date:L,boolean:L,integer:L,float:L,regexp:L,email:L,url:L,hex:L},string:{len:"${label}é¡»ä¸º${len}ä¸ªå­—ç¬¦",min:"${label}æœ€å°‘${min}ä¸ªå­—ç¬¦",max:"${label}æœ€å¤š${max}ä¸ªå­—ç¬¦",range:"${label}é¡»åœ¨${min}-${max}å­—ç¬¦ä¹‹é—´"},number:{len:"${label}å¿…é¡»ç­‰äº${len}",min:"${label}æœ€å°å€¼ä¸º${min}",max:"${label}æœ€å¤§å€¼ä¸º${max}",range:"${label}é¡»åœ¨${min}-${max}ä¹‹é—´"},array:{len:"é¡»ä¸º${len}ä¸ª${label}",min:"æœ€å°‘${min}ä¸ª${label}",max:"æœ€å¤š${max}ä¸ª${label}",range:"${label}æ•°é‡é¡»åœ¨${min}-${max}ä¹‹é—´"},pattern:{mismatch:"${label}ä¸æ¨¡å¼ä¸åŒ¹é…${pattern}"}}},Image:{preview:"é¢„è§ˆ"},QRCode:{expired:"äºŒç»´ç è¿‡æœŸ",refresh:"ç‚¹å‡»åˆ·æ–°",scanned:"å·²æ‰«æ"},ColorPicker:{presetEmpty:"æš‚æ— ",transparent:"æ— è‰²",singleColor:"å•è‰²",gradientColor:"æ¸å˜è‰²"}};ge.default=ai;var li=ge;const ci=St(li),Re=[{name:"A0",width:84.1,height:118.9,category:"standard"},{name:"A1",width:59.4,height:84.1,category:"standard"},{name:"A2",width:42,height:59.4,category:"standard"},{name:"A3",width:29.7,height:42,category:"standard"},{name:"A4",width:21,height:29.7,category:"standard"},{name:"A5",width:14.8,height:21,category:"standard"},{name:"A6",width:10.5,height:14.8,category:"standard"},{name:"A7",width:7.4,height:10.5,category:"standard"},{name:"A8",width:5.2,height:7.4,category:"standard"},{name:"A9",width:3.7,height:5.2,category:"standard"},{name:"A10",width:2.6,height:3.7,category:"standard"}],ht=[{name:"Letter",width:21.6,height:27.9,category:"standard"},{name:"Legal",width:21.6,height:35.6,category:"standard"},{name:"Executive",width:18.4,height:26.7,category:"standard"},{name:"Ledger/Tabloid",width:27.9,height:43.2,category:"standard"}],gt=[{name:"10x15cm",width:10,height:15,category:"photo"},{name:"13x18cm",width:13,height:18,category:"photo"},{name:"15x21cm",width:15,height:21,category:"photo"},{name:"18x24cm",width:18,height:24,category:"photo"},{name:"20x25cm",width:20,height:25,category:"photo"},{name:"20x30cm",width:20,height:30,category:"photo"},{name:"25x35cm",width:25,height:35,category:"photo"},{name:"30x40cm",width:30,height:40,category:"photo"},{name:"30x45cm",width:30,height:45,category:"photo"},{name:"4x6è‹±å¯¸",width:10.2,height:15.2,category:"photo"},{name:"5x7è‹±å¯¸",width:12.7,height:17.8,category:"photo"},{name:"6x8è‹±å¯¸",width:15.2,height:20.3,category:"photo"},{name:"8x10è‹±å¯¸",width:20.3,height:25.4,category:"photo"},{name:"8x12è‹±å¯¸",width:20.3,height:30.5,category:"photo"},{name:"10x12è‹±å¯¸",width:25.4,height:30.5,category:"photo"},{name:"11x14è‹±å¯¸",width:27.9,height:35.6,category:"photo"},{name:"12x16è‹±å¯¸",width:30.5,height:40.6,category:"photo"},{name:"16x20è‹±å¯¸",width:40.6,height:50.8,category:"photo"},{name:"20x24è‹±å¯¸",width:50.8,height:61,category:"photo"},{name:"24x30è‹±å¯¸",width:61,height:76.2,category:"photo"},{name:"24x36è‹±å¯¸",width:61,height:91.4,category:"photo"}],pt=[{name:"B5",width:17.6,height:25,category:"standard"},{name:"B4",width:25,height:35.3,category:"standard"},{name:"B3",width:35.3,height:50,category:"standard"},{name:"C4",width:22.9,height:32.4,category:"standard"},{name:"C5",width:16.2,height:22.9,category:"standard"},{name:"DL",width:11,height:22,category:"standard"}],Ce=[...Re,...ht,...gt,...pt],He={standard:[...Re,...ht,...pt],photo:gt};function di(){return Re.find(t=>t.name==="A4")}function hi(t){return Ce.find(i=>i.name===t)}function gi(t){return`${t.name} (${t.width} Ã— ${t.height} cm)`}function pi(t){return`${t.name} æ¨ªå‘ (${t.height} Ã— ${t.width} cm)`}const{Title:Z,Text:z}=ne,{Option:We}=be,Oe=[{name:"æ ‡å‡†å¡",size:{width:5.9,height:8.6}},{name:"å°å¡",size:{width:4.2,height:6.1}},{name:"æ­£æ–¹å½¢",size:{width:6,height:6}},{name:"è‡ªå®šä¹‰",size:{width:0,height:0}}],ui=({layout:t,onChange:i})=>{const l=()=>{const d=Ce.find(b=>b.width===t.pageSettings.width&&b.height===t.pageSettings.height);return d?d.name:"A4"},[n,r]=x.useState(l()),s=d=>{i({...t,...d})},o=d=>{s({cardSize:{...t.cardSize,...d}})},c=d=>{s({spacing:{...t.spacing,...d}})},h=d=>{s({pageSettings:{...t.pageSettings,...d}})},u=d=>{s({imageQuality:{...t.imageQuality,...d}})},p=d=>{d.name!=="è‡ªå®šä¹‰"&&o(d.size)},g=()=>{for(const d of Oe)if(d.name!=="è‡ªå®šä¹‰"&&d.size.width===t.cardSize.width&&d.size.height===t.cardSize.height)return d.name;return"è‡ªå®šä¹‰"},f=d=>{const b=hi(d);b&&(r(d),h({width:b.width,height:b.height}))},y=d=>{s({orientation:d})},w=()=>{const d=Ce.find(b=>b.width===t.pageSettings.width&&b.height===t.pageSettings.height);return d?d.name:n},j=d=>t.orientation==="landscape"?pi(d):gi(d);return e.jsxs("div",{className:"settings-panel",children:[e.jsx("div",{className:"section-title",children:e.jsx(Z,{level:4,children:"æ’ç‰ˆè®¾ç½®"})}),e.jsxs("div",{className:"form-section",children:[e.jsx(Z,{level:5,style:{marginTop:0,marginBottom:12},children:"å¡ç‰‡å°ºå¯¸ (å˜ç±³)"}),e.jsxs(T,{direction:"vertical",style:{width:"100%"},children:[e.jsx(z,{type:"secondary",children:"é¢„è®¾å°ºå¯¸:"}),e.jsx("div",{className:"size-presets",children:Oe.map(d=>e.jsx(_,{type:g()===d.name?"primary":"default",size:"small",onClick:()=>p(d),style:{height:"auto",padding:"8px 12px"},children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{children:d.name}),d.name!=="è‡ªå®šä¹‰"&&e.jsxs("div",{style:{fontSize:"10px",opacity:.7},children:[d.size.width,"Ã—",d.size.height]})]})},d.name))}),e.jsxs(T,{children:[e.jsxs("div",{children:[e.jsx(z,{children:"å®½åº¦:"}),e.jsx(Q,{value:t.cardSize.width,onChange:d=>o({width:d||0}),min:1,max:15,step:.01,precision:2,addonAfter:"cm",style:{width:100}})]}),e.jsxs("div",{children:[e.jsx(z,{children:"é«˜åº¦:"}),e.jsx(Q,{value:t.cardSize.height,onChange:d=>o({height:d||0}),min:1,max:20,step:.01,precision:2,addonAfter:"cm",style:{width:100}})]})]})]})]}),e.jsxs("div",{className:"form-section",style:{marginTop:16},children:[e.jsx(Z,{level:5,style:{marginBottom:12},children:"å¡ç‰‡é—´è· (å˜ç±³)"}),e.jsxs(T,{direction:"vertical",style:{width:"100%"},children:[e.jsxs("div",{children:[e.jsx(z,{children:"æ°´å¹³é—´è·:"}),e.jsx(Q,{value:t.spacing.horizontal,onChange:d=>c({horizontal:d||0}),min:0,max:5,step:.01,precision:2,addonAfter:"cm",style:{width:120,marginLeft:8}})]}),e.jsxs("div",{children:[e.jsx(z,{children:"å‚ç›´é—´è·:"}),e.jsx(Q,{value:t.spacing.vertical,onChange:d=>c({vertical:d||0}),min:0,max:5,step:.01,precision:2,addonAfter:"cm",style:{width:120,marginLeft:8}})]})]})]}),e.jsxs("div",{className:"form-section",style:{marginTop:16},children:[e.jsx(Z,{level:5,style:{marginBottom:12},children:"é¡µé¢è®¾ç½®"}),e.jsxs(T,{direction:"vertical",style:{width:"100%"},children:[e.jsxs("div",{children:[e.jsx(z,{children:"é¡µè¾¹è·:"}),e.jsx(Q,{value:t.pageSettings.margin,onChange:d=>h({margin:d||0}),min:0,max:5,step:.01,precision:2,addonAfter:"cm",style:{width:120,marginLeft:8}})]}),e.jsxs("div",{children:[e.jsx(z,{children:"çº¸å¼ æ–¹å‘:"}),e.jsxs(A.Group,{value:t.orientation,onChange:d=>y(d.target.value),style:{marginTop:8},children:[e.jsx(A.Button,{value:"portrait",children:"çºµå‘"}),e.jsx(A.Button,{value:"landscape",children:"æ¨ªå‘"})]}),e.jsx("div",{style:{marginTop:4},children:e.jsx(z,{type:"secondary",style:{fontSize:12},children:"æ¨ªå‘æ¨¡å¼ä¼šå°†çº¸å¼ æ—‹è½¬90åº¦ï¼Œé€‚åˆå®½å¹…å¸ƒå±€"})})]}),e.jsxs("div",{children:[e.jsx(z,{children:"å¡ç‰‡æ–¹å‘:"}),e.jsxs(A.Group,{value:t.cardRotation,onChange:d=>s({cardRotation:d.target.value}),style:{marginTop:8},children:[e.jsx(A.Button,{value:"normal",children:"æ­£å¸¸"}),e.jsx(A.Button,{value:"rotated",children:"æ¨ªæ’"})]}),e.jsx("div",{style:{marginTop:4},children:e.jsx(z,{type:"secondary",style:{fontSize:12},children:"æ¨ªæ’æ¨¡å¼ä¼šå°†å¡ç‰‡æ—‹è½¬90åº¦ï¼Œé€‚åˆåœ¨çºµå‘çº¸å¼ ä¸Šæ¨ªå‘æ’åˆ—å¡ç‰‡"})})]}),e.jsxs("div",{children:[e.jsx(z,{children:"çº¸å¼ å°ºå¯¸:"}),e.jsx(Te,{type:"card",size:"small",style:{marginTop:8},items:[{key:"standard",label:"æ ‡å‡†çº¸å¼ ",children:e.jsx(be,{value:w(),onChange:f,style:{width:"100%"},showSearch:!0,placeholder:"é€‰æ‹©æ ‡å‡†çº¸å¼ å°ºå¯¸",filterOption:(d,b)=>{var m;return(m=b==null?void 0:b.children)==null?void 0:m.toLowerCase().includes(d.toLowerCase())},children:He.standard.map(d=>e.jsx(We,{value:d.name,children:j(d)},d.name))})},{key:"photo",label:"ç…§ç‰‡çº¸",children:e.jsx(be,{value:w(),onChange:f,style:{width:"100%"},showSearch:!0,placeholder:"é€‰æ‹©ç…§ç‰‡çº¸å°ºå¯¸",filterOption:(d,b)=>{var m;return(m=b==null?void 0:b.children)==null?void 0:m.toLowerCase().includes(d.toLowerCase())},children:He.photo.map(d=>e.jsx(We,{value:d.name,children:j(d)},d.name))})}]})]})]})]}),e.jsx(qe,{style:{margin:"16px 0"}}),e.jsxs("div",{className:"form-section",children:[e.jsx(Z,{level:5,style:{marginTop:0,marginBottom:12},children:"å›¾ç‰‡è®¾ç½®"}),e.jsxs(T,{direction:"vertical",style:{width:"100%"},children:[e.jsxs("div",{children:[e.jsx(z,{children:"è£å‰ªæ¨¡å¼:"}),e.jsxs(A.Group,{value:t.cropMode,onChange:d=>s({cropMode:d.target.value}),style:{marginTop:8},children:[e.jsx(A.Button,{value:"fit",children:"ç­‰æ¯”ç¼©æ”¾"}),e.jsx(A.Button,{value:"fill",children:"è£å‰ªé€‚åº”"})]})]}),e.jsxs("div",{children:[e.jsx(z,{children:"å›¾ç‰‡è´¨é‡:"}),e.jsx("div",{style:{marginTop:8},children:e.jsxs(T,{direction:"vertical",style:{width:"100%"},children:[e.jsxs("div",{children:[e.jsxs(z,{type:"secondary",style:{fontSize:12},children:["åˆ†è¾¨ç‡å€æ•°: ",t.imageQuality.resolution,"x"]}),e.jsx(ee,{title:"æ›´é«˜çš„åˆ†è¾¨ç‡ä¼šæå‡å›¾ç‰‡æ¸…æ™°åº¦ï¼Œä½†ä¼šå¢åŠ æ–‡ä»¶å¤§å°å’Œå¤„ç†æ—¶é—´",children:e.jsx(le,{value:t.imageQuality.resolution,onChange:d=>u({resolution:d}),min:1,max:4,step:1,marks:{1:"1x",2:"2x",3:"3x",4:"4x"},style:{marginTop:4}})})]}),e.jsxs("div",{children:[e.jsxs(z,{type:"secondary",style:{fontSize:12},children:["å‹ç¼©è´¨é‡: ",Math.round(t.imageQuality.quality*100),"%"]}),e.jsx(ee,{title:"æ›´é«˜çš„è´¨é‡ä¼šä¿æŒæ›´å¤šç»†èŠ‚ï¼Œä½†ä¼šå¢åŠ æ–‡ä»¶å¤§å°",children:e.jsx(le,{value:t.imageQuality.quality,onChange:d=>u({quality:d}),min:.5,max:1,step:.05,marks:{.5:"50%",.75:"75%",.9:"90%",1:"100%"},style:{marginTop:4}})})]}),e.jsxs("div",{children:[e.jsx(z,{type:"secondary",style:{fontSize:12},children:"è¾“å‡ºæ ¼å¼:"}),e.jsxs(A.Group,{value:t.imageQuality.format,onChange:d=>u({format:d.target.value}),style:{marginTop:4},children:[e.jsx(A.Button,{value:"png",children:"PNG (æ— æŸ)"}),e.jsx(A.Button,{value:"jpeg",children:"JPEG (å°æ–‡ä»¶)"})]})]})]})})]}),e.jsxs("div",{style:{marginTop:16},children:[e.jsxs(T,{align:"center",children:[e.jsx(z,{children:"æ˜¾ç¤ºåˆ‡å‰²çº¿:"}),e.jsx(Ge,{checked:t.showCuttingLines,onChange:d=>i({...t,showCuttingLines:d})})]}),e.jsx("div",{style:{marginTop:4},children:e.jsx(z,{type:"secondary",style:{fontSize:12},children:"åœ¨æ¯å¼ å¡ç‰‡å³ä¸‹è§’æ˜¾ç¤ºåˆ‡å‰²å‚è€ƒçº¿"})})]}),t.showCuttingLines&&e.jsxs("div",{style:{marginTop:12},children:[e.jsx(z,{children:"åˆ‡å‰²çº¿å®½åº¦:"}),e.jsx("div",{style:{marginTop:8},children:e.jsx(T,{direction:"vertical",style:{width:"100%"},children:e.jsxs("div",{children:[e.jsxs(z,{type:"secondary",style:{fontSize:12},children:["å®½åº¦: ",t.cuttingLineWidth,"pt"]}),e.jsx(ee,{title:"è°ƒæ•´åˆ‡å‰²çº¿çš„ç²—ç»†ï¼Œæ•°å€¼è¶Šå°çº¿æ¡è¶Šç»†",children:e.jsx(le,{value:t.cuttingLineWidth,onChange:d=>i({...t,cuttingLineWidth:d}),min:.01,max:3,step:.01,marks:{.01:"0.01",.05:"0.05",.1:"0.1",.5:"0.5",1:"1.0",1.5:"1.5",2:"2.0",3:"3.0"},style:{marginTop:4}})})]})})})]}),e.jsx("div",{style:{marginTop:16,padding:"8px 12px",backgroundColor:"#f9f9f9",borderRadius:"4px",border:"1px solid #e8e8e8"},children:e.jsxs(z,{type:"secondary",style:{fontSize:12},children:[e.jsx("div",{children:"â€¢ ç­‰æ¯”ç¼©æ”¾: ä¿æŒå›¾ç‰‡æ¯”ä¾‹ï¼Œå¯èƒ½æœ‰ç•™ç™½"}),e.jsx("div",{children:"â€¢ è£å‰ªé€‚åº”: å¡«æ»¡å¡ç‰‡åŒºåŸŸï¼Œå¯èƒ½è£å‰ªå›¾ç‰‡"}),e.jsx("div",{children:"â€¢ PNG: æœ€ä½³è´¨é‡ï¼Œè¾ƒå¤§æ–‡ä»¶"}),e.jsx("div",{children:"â€¢ JPEG: è¾ƒå°æ–‡ä»¶ï¼Œè½»å¾®è´¨é‡æŸå¤±"}),e.jsx("div",{children:"â€¢ åˆ‡å‰²çº¿: ä¾¿äºç²¾ç¡®åˆ‡å‰²å¡ç‰‡"})]})})]})]})]})};function de(t){const i=t.split(`
`).map(r=>r.trim()).filter(r=>r),l={main:[],extra:[],side:[]};let n=null;for(const r of i){if(r.startsWith("#")||r.startsWith("!")){const s=r.toLowerCase();s.includes("main")?n="main":s.includes("extra")?n="extra":s.includes("side")&&(n="side");continue}/^\d+$/.test(r)&&n&&l[n].push(r)}return l}function ke(t,i=!0,l=!1){const n=[...t.main,...i?t.extra:[],...l?t.side:[]],r=new Map,s=new Map;for(let c=0;c<n.length;c++){const h=n[c];r.set(h,(r.get(h)||0)+1),s.has(h)||s.set(h,c)}const o=[];for(const[c,h]of r)o.push({id:c,count:h,hasImage:!1,firstIndex:s.get(c)||0});return o.sort((c,h)=>(c.firstIndex||0)-(h.firstIndex||0))}function $e(t){return!t||t.trim().length===0?!1:t.split(`
`).map(n=>n.trim()).filter(n=>n).some(n=>/^\d{8}$/.test(n))}function mi(t){return new Promise((i,l)=>{const n=new FileReader;n.onload=r=>{var o;const s=(o=r.target)==null?void 0:o.result;i(s)},n.onerror=()=>{l(new Error("è¯»å–æ–‡ä»¶å¤±è´¥"))},n.readAsText(t,"utf-8")})}const H=new Map,G=new Map;async function Be(t){if(t.length===0)return null;for(const i of t)if(G.has(i)&&G.get(i))return i;try{const i=t.map(async r=>{const s=await ce(r);return{url:r,isValid:s}}),n=(await Promise.all(i)).find(r=>r.isValid);return n?n.url:null}catch(i){return console.error("å¹¶è¡ŒéªŒè¯å›¾ç‰‡URLså¤±è´¥:",i),null}}async function ce(t){return G.has(t)?G.get(t):new Promise(i=>{const l=new Image;let n=!1;const r=o=>{n||(n=!0,G.set(t,o),i(o))},s=setTimeout(()=>{r(!1)},2e3);l.onload=()=>{clearTimeout(s),r(!0)},l.onerror=()=>{clearTimeout(s),r(!1)},l.crossOrigin="anonymous",l.src=t})}async function fi(t,i){var l,n,r;try{const s=[i,`${i} (card)`,t,`Card ${t}`].filter(Boolean);for(const o of s)try{const h=`https://yugipedia.com/api.php?action=query&format=json&prop=imageinfo&iiprop=url&titles=${encodeURIComponent(o)}&origin=*`;console.log("æŸ¥è¯¢Yugipedia:",{title:o,url:h});const u=await fetch(h);if(!u.ok)continue;const p=await u.json();if((l=p.query)!=null&&l.pages){const g=Object.values(p.query.pages);for(const f of g)if(f.imageinfo&&f.imageinfo.length>0){const y=f.imageinfo[0].url;return console.log("æ‰¾åˆ°Yugipediaå›¾ç‰‡:",{title:o,imageUrl:y}),y}}}catch(c){console.warn(`YugipediaæŸ¥è¯¢å¤±è´¥ [${o}]:`,c);continue}if(i)try{const o=`https://yugipedia.com/api.php?action=query&format=json&list=search&srsearch=${encodeURIComponent(i)}&srlimit=5&origin=*`,c=await fetch(o);if(c.ok){const h=await c.json();if((n=h.query)!=null&&n.search&&h.query.search.length>0){const p=h.query.search[0].title,g=`https://yugipedia.com/api.php?action=query&format=json&prop=imageinfo&iiprop=url&titles=${encodeURIComponent(p)}&origin=*`,f=await fetch(g);if(f.ok){const y=await f.json();if((r=y.query)!=null&&r.pages){const w=Object.values(y.query.pages);for(const j of w)if(j.imageinfo&&j.imageinfo.length>0){const d=j.imageinfo[0].url;return console.log("é€šè¿‡æœç´¢æ‰¾åˆ°Yugipediaå›¾ç‰‡:",{cardName:i,pageTitle:p,imageUrl:d}),d}}}}}}catch(o){console.warn("Yugipediaæœç´¢å¤±è´¥:",o)}return null}catch(s){return console.error("Yugipedia APIé”™è¯¯:",s),null}}async function ut(t,i,l,n=!1,r=!1){const s=`${t}-${i||""}-${l||""}-${n}-${r}`;if(H.has(s))return H.get(s);let o;if(r&&!n){console.log("CDNä¼˜å…ˆæ¨¡å¼ï¼šå¼€å§‹éªŒè¯è¿œç¨‹å›¾ç‰‡æº:",{cardId:t});const p=[`https://cdn.233.momobako.com/ygopro/pics/${t}.jpg`,`https://cdn.jsdelivr.net/gh/Fluorohydride/ygopro-images/pics/${t}.jpg`,`https://images.ygoprodeck.com/images/cards/${t}.jpg`,`https://storage.googleapis.com/ygoprodeck.com/pics/${t}.jpg`],g=await Be(p);if(g){let f="fallback";return g.includes("momobako.com")?f="momobako":g.includes("ygoprodeck.com")&&(f="fallback"),o={url:g,source:f,isValid:!0},H.set(s,o),console.log("CDNä¼˜å…ˆï¼šä½¿ç”¨è¿œç¨‹å›¾ç‰‡:",{cardId:t,url:g,source:f}),o}if(l&&(console.log("CDNå¤±è´¥ï¼Œå›é€€åˆ°æœ¬åœ°å›¾ç‰‡:",{cardId:t,localImageUrl:l}),await ce(l)))return o={url:l,source:"local",isValid:!0},H.set(s,o),console.log("CDNä¼˜å…ˆæ¨¡å¼ï¼šä½¿ç”¨æœ¬åœ°å›¾ç‰‡:",{cardId:t,url:l}),o}else if(l){if(console.log("æ£€æŸ¥æœ¬åœ°å›¾ç‰‡:",{cardId:t,localImageUrl:l}),await ce(l))return o={url:l,source:"local",isValid:!0},H.set(s,o),console.log("ä½¿ç”¨æœ¬åœ°å›¾ç‰‡:",{cardId:t,url:l}),o;console.log("æœ¬åœ°å›¾ç‰‡æ— æ•ˆ:",{cardId:t,localImageUrl:l})}if(n)return console.log("è®¾ç½®ä¸ºåªä½¿ç”¨æœ¬åœ°å›¾ç‰‡ï¼Œè·³è¿‡ç½‘ç»œå›¾ç‰‡è·å–:",{cardId:t}),o={url:"",source:"local",isValid:!1},H.set(s,o),o;console.log("å¼€å§‹å¹¶è¡ŒéªŒè¯è¿œç¨‹å›¾ç‰‡æº:",{cardId:t});const c=[`https://cdn.233.momobako.com/ygopro/pics/${t}.jpg`,`https://cdn.jsdelivr.net/gh/Fluorohydride/ygopro-images/pics/${t}.jpg`,`https://images.ygoprodeck.com/images/cards/${t}.jpg`,`https://storage.googleapis.com/ygoprodeck.com/pics/${t}.jpg`],h=await Be(c);if(h){let p="fallback";return h.includes("momobako.com")?p="momobako":h.includes("ygoprodeck.com")&&(p="fallback"),o={url:h,source:p,isValid:!0},H.set(s,o),console.log("å¹¶è¡ŒéªŒè¯æˆåŠŸï¼Œä½¿ç”¨è¿œç¨‹å›¾ç‰‡:",{cardId:t,url:h,source:p}),o}console.log("è¿œç¨‹å›¾ç‰‡æºéƒ½ä¸å¯ç”¨ï¼Œå°è¯•Yugipedia:",{cardId:t});const u=await fi(t,i);return u&&await ce(u)?(o={url:u,source:"yugipedia",isValid:!0},H.set(s,o),console.log("ä½¿ç”¨Yugipediaå›¾ç‰‡:",{cardId:t,url:u}),o):(o={url:"",source:"local",isValid:!1},H.set(s,o),o)}async function xi(t,i=!1){const l=new Map,n=5;for(let r=0;r<t.length;r+=n){const o=t.slice(r,r+n).map(async h=>{const u=await ut(h.id,h.name,h.localImageUrl,i);return{cardId:h.id,imageInfo:u}}),c=await Promise.all(o);for(const{cardId:h,imageInfo:u}of c)l.set(h,u);r+n<t.length&&await new Promise(h=>setTimeout(h,100))}return l}function yi(){H.clear(),G.clear(),console.log("å›¾ç‰‡ç¼“å­˜å·²æ¸…é™¤")}const ji={1:"æˆ˜å£«æ—",2:"é­”æ³•å¸ˆæ—",4:"å¤©ä½¿æ—",8:"æ¶é­”æ—",16:"ä¸æ­»æ—",32:"æœºæ¢°æ—",64:"æ°´æ—",128:"ç‚æ—",256:"å²©çŸ³æ—",512:"é¸Ÿå…½æ—",1024:"æ¤ç‰©æ—",2048:"æ˜†è™«æ—",4096:"é›·æ—",8192:"é¾™æ—",16384:"å…½æ—",32768:"å…½æˆ˜å£«æ—",65536:"æé¾™æ—",131072:"é±¼æ—",262144:"æµ·é¾™æ—",524288:"çˆ¬è™«ç±»æ—",1048576:"å¿µåŠ¨åŠ›æ—",2097152:"å¹»ç¥å…½æ—",4194304:"åˆ›é€ ç¥æ—",8388608:"å¹»é¾™æ—",16777216:"ç”µå­ç•Œæ—"},vi={1:"åœ°",2:"æ°´",4:"ç‚",8:"é£",16:"å…‰",32:"æš—",64:"ç¥"},we=new Map,te=new Map,wi="https://ygocdb.com/api/v0/";function bi(t){return{id:t.id.toString(),name:t.cn_name||t.sc_name||t.md_name||t.en_name,en_name:t.en_name,desc:t.text.desc||t.html.desc||"",type:t.text.types||"",atk:t.data.atk>=0?t.data.atk:void 0,def:t.data.def>=0?t.data.def:void 0,level:t.data.level>0?t.data.level:void 0,race:ji[t.data.race]||"æœªçŸ¥ç§æ—",attribute:vi[t.data.attribute]||void 0}}async function mt(t){if(!t||t.trim().length===0)return[];const i=t.trim();if(we.has(i))return we.get(i);try{const l=`${wi}?search=${encodeURIComponent(i)}`;console.log("æœç´¢å¡ç‰‡:",{query:i,url:l});const n=await fetch(l);if(!n.ok)throw new Error(`APIè¯·æ±‚å¤±è´¥: ${n.status}`);const s=((await n.json()).result||[]).map(bi);return we.set(i,s),s.forEach(o=>{te.set(o.id,o)}),console.log("æœç´¢ç»“æœ:",{query:i,count:s.length}),s}catch(l){return console.error("æœç´¢å¡ç‰‡å¤±è´¥:",l),/^\d{8}$/.test(i)?[{id:i,name:`å¡ç‰‡ ${i}`,en_name:`Card ${i}`,desc:"æ— æ³•è·å–å¡ç‰‡ä¿¡æ¯",type:"æœªçŸ¥",race:"æœªçŸ¥ç§æ—"}]:[]}}async function Si(t){if(!t||!t.trim())return null;const i=t.trim();if(te.has(i))return te.get(i);try{const l=await mt(i);return l.length>0?l[0]:null}catch(l){return console.error(`è·å–å¡ç‰‡ä¿¡æ¯å¤±è´¥ [${t}]:`,l),null}}async function ft(t){const i=new Map,l=[];for(const n of t)te.has(n)?i.set(n,te.get(n)):l.push(n);if(l.length>0){console.log("æ‰¹é‡è·å–å¡ç‰‡ä¿¡æ¯:",l.length);const n=10;for(let r=0;r<l.length;r+=n){const o=l.slice(r,r+n).map(async c=>{try{const h=await Si(c);h&&i.set(c,h)}catch(h){console.error(`è·å–å¡ç‰‡ä¿¡æ¯å¤±è´¥ [${c}]:`,h)}});await Promise.all(o),r+n<l.length&&await new Promise(c=>setTimeout(c,100))}}return i}async function Fe(t){if(t.length===0)return t;console.log("å¼€å§‹è·å–å¡ç‰‡åç§°ï¼ˆä»…æœ¬åœ°ï¼‰...");const i=t.map(r=>r.id),l=await ft(i),n=t.map(r=>{const s=l.get(r.id);return{...r,name:(s==null?void 0:s.name)||r.name||void 0,imageUrl:r.imageUrl,hasImage:!!r.imageUrl,imageSource:r.imageUrl?"local":void 0}});return console.log("å¡ç‰‡åç§°è·å–å®Œæˆï¼ˆä»…æœ¬åœ°ï¼‰:",{total:t.length,enriched:n.filter(r=>r.name).length,withLocalImages:n.filter(r=>r.hasImage).length}),n}async function Pi(t){if(t.length===0)return t;console.log("å¼€å§‹è·å–å¡ç‰‡ä¿¡æ¯...");const i=t.map(o=>o.id),l=await ft(i),n=t.map(o=>{const c=l.get(o.id);return{id:o.id,name:(c==null?void 0:c.name)||o.name,localImageUrl:o.imageUrl}});console.log("æ­£åœ¨è·å–å›¾ç‰‡ä¿¡æ¯...");const r=await xi(n),s=t.map(o=>{const c=l.get(o.id),h=r.get(o.id);return{...o,name:(c==null?void 0:c.name)||o.name||void 0,imageUrl:h!=null&&h.isValid?h.url:o.imageUrl,hasImage:(h==null?void 0:h.isValid)||!1,imageSource:(h==null?void 0:h.source)||"local"}});return console.log("å¡ç‰‡ä¿¡æ¯è·å–å®Œæˆ:",{total:t.length,enriched:s.filter(o=>o.name).length,withImages:s.filter(o=>o.hasImage).length,localImages:s.filter(o=>o.imageSource==="local").length,momobakoImages:s.filter(o=>o.imageSource==="momobako").length,yugipediaImages:s.filter(o=>o.imageSource==="yugipedia").length,fallbackImages:s.filter(o=>o.imageSource==="fallback").length}),s}const{Title:Ci,Text:X}=ne,{Search:ki}=_e,$i=({cardInfo:t})=>{var m;const[i,l]=x.useState(""),[n,r]=x.useState(""),[s,o]=x.useState(!1),[c,h]=x.useState(!1),[u,p]=x.useState(!1),g=x.useRef(null),f=x.useMemo(()=>[{url:`https://cdn.233.momobako.com/ygopro/pics/${t.id}.jpg`,source:"momobako",icon:"ğŸš€"},{url:`https://cdn.jsdelivr.net/gh/Fluorohydride/ygopro-images/pics/${t.id}.jpg`,source:"fallback",icon:"ğŸ”„"},{url:`https://images.ygoprodeck.com/images/cards/${t.id}.jpg`,source:"fallback",icon:"ğŸ”„"}],[t.id]),[y,w]=x.useState(0);x.useEffect(()=>{const a=g.current;if(!a)return;const v=new IntersectionObserver(([P])=>{P.isIntersecting&&!c&&(h(!0),v.unobserve(a))},{rootMargin:"50px"});return v.observe(a),()=>v.disconnect()},[c]),x.useEffect(()=>{c&&(w(0),o(!1),p(!0),l(f[0].url),r(f[0].source),console.log("æœç´¢é¢„è§ˆå¼€å§‹æ‡’åŠ è½½å›¾ç‰‡:",{cardId:t.id,cardName:t.name,firstSource:f[0].url}))},[c,t.id,t.name,f]);const j=x.useCallback(()=>{const a=y+1;a<f.length?(console.log("å›¾ç‰‡åŠ è½½å¤±è´¥ï¼Œå°è¯•ä¸‹ä¸€ä¸ªæº:",{cardId:t.id,failedSource:f[y].url,nextSource:f[a].url}),w(a),l(f[a].url),r(f[a].source)):(console.log("æ‰€æœ‰å›¾ç‰‡æºéƒ½åŠ è½½å¤±è´¥:",{cardId:t.id}),o(!0),p(!1))},[y,f,t.id]),d=x.useCallback(()=>{p(!1),console.log("æœç´¢é¢„è§ˆå›¾ç‰‡æ‡’åŠ è½½æˆåŠŸ:",{cardId:t.id,source:n,url:i})},[t.id,n,i]),b={width:60,height:87,backgroundColor:"#f5f5f5",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"4px",border:"1px solid #e5e7eb"};return e.jsx("div",{ref:g,style:{position:"relative"},children:c?s?e.jsx("div",{style:b,children:e.jsx(Ee,{style:{fontSize:16,color:"#d9d9d9"}})}):e.jsxs("div",{style:{position:"relative"},children:[e.jsx("img",{src:i,alt:t.name,onLoad:d,onError:j,style:{width:60,height:87,objectFit:"cover",borderRadius:"4px",border:"1px solid #e5e7eb",backgroundColor:"#f5f5f5",opacity:u?.3:1,transition:"opacity 0.3s ease"}}),u&&e.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",zIndex:1},children:e.jsx(Ie,{size:"small"})}),!u&&e.jsx("div",{style:{position:"absolute",bottom:2,right:2,fontSize:"8px",backgroundColor:"rgba(0,0,0,0.7)",color:"white",padding:"1px 3px",borderRadius:"2px"},children:((m=f[y])==null?void 0:m.icon)||"ğŸ“"})]}):e.jsx("div",{style:b,children:e.jsx(Ee,{style:{fontSize:16,color:"#d9d9d9"}})})})},zi=({onAddCard:t,existingCards:i})=>{const[l,n]=x.useState(""),[r,s]=x.useState([]),[o,c]=x.useState(!1),[h,u]=x.useState(null),p=x.useRef(null),g=x.useCallback(async m=>{if(!m||m.trim().length===0){s([]);return}c(!0),u(null);try{const a=await mt(m.trim());s(a),a.length===0&&u("æœªæ‰¾åˆ°åŒ¹é…çš„å¡ç‰‡ï¼Œè¯·å°è¯•å…¶ä»–å…³é”®è¯")}catch(a){console.error("æœç´¢å¤±è´¥:",a),u("æœç´¢å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–ç¨åé‡è¯•"),s([])}finally{c(!1)}},[]),f=x.useCallback(m=>{p.current&&clearTimeout(p.current),p.current=setTimeout(()=>{g(m)},500)},[g]),y=x.useCallback(m=>{if(n(m),!m||m.trim().length===0){s([]),u(null),c(!1),p.current&&clearTimeout(p.current);return}f(m)},[f]);x.useEffect(()=>()=>{p.current&&clearTimeout(p.current)},[]);const w=x.useCallback(async m=>{const a=await ut(m.id,m.name,void 0,!0),v={id:m.id,name:m.name,count:1,hasImage:a.isValid,imageUrl:a.isValid?a.url:void 0,imageSource:a.source};console.log("æ·»åŠ å¡ç‰‡:",{cardInfo:m,imageInfo:a,newCard:v}),t(v)},[t]),j=(m,a)=>e.jsx(Qe,{size:"small",style:{width:"100%",margin:"2px 0"},bodyStyle:{padding:"12px"},children:e.jsxs("div",{style:{display:"flex",gap:"12px"},children:[e.jsx("div",{style:{flexShrink:0},children:e.jsx($i,{cardInfo:m})}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"8px"},children:[e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs(X,{strong:!0,style:{display:"block",marginBottom:"4px"},children:[m.name,a>0&&e.jsxs(V,{color:"blue",style:{marginLeft:"8px",fontSize:"10px",padding:"0 6px",lineHeight:"18px"},children:["å·²æœ‰ ",a]})]}),e.jsxs(X,{type:"secondary",style:{fontSize:"12px"},children:["ID: ",m.id]})]}),e.jsx(_,{type:"primary",size:"small",icon:e.jsx(Pt,{}),onClick:()=>w(m),style:{flexShrink:0},children:"æ·»åŠ "})]}),e.jsx("div",{style:{marginBottom:"8px"},children:e.jsxs(T,{size:[4,4],wrap:!0,children:[e.jsx(V,{color:"blue",style:{fontSize:"11px"},children:m.type}),m.race&&e.jsx(V,{color:"green",style:{fontSize:"11px"},children:m.race}),m.attribute&&e.jsx(V,{color:"orange",style:{fontSize:"11px"},children:m.attribute}),m.level!==void 0&&e.jsxs(V,{color:"purple",style:{fontSize:"11px"},children:["Level ",m.level]})]})}),(m.atk!==void 0||m.def!==void 0)&&e.jsx("div",{style:{marginBottom:"8px"},children:e.jsxs(X,{style:{fontSize:"12px",color:"#666"},children:[m.atk!==void 0&&`ATK: ${m.atk}`,m.atk!==void 0&&m.def!==void 0&&" / ",m.def!==void 0&&`DEF: ${m.def}`]})}),m.desc&&e.jsx(ee,{title:m.desc,placement:"bottomLeft",children:e.jsx(X,{style:{fontSize:"11px",color:"#888",display:"block",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:m.desc})})]})]})}),d=m=>{const a=i.find(v=>v.id===m);return a?a.count:0},b=m=>{const a=d(m.id);return e.jsx("div",{style:{padding:"2px 4px"},children:j(m,a)},m.id)};return e.jsxs("div",{style:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{padding:"16px 16px 0 16px",flexShrink:0},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[e.jsxs(Ci,{level:5,style:{margin:0},children:[e.jsx(Ke,{})," å¡ç‰‡æœç´¢"]}),e.jsx(_,{size:"small",onClick:()=>{yi(),console.log("ğŸ—‘ï¸ å›¾ç‰‡ç¼“å­˜å·²æ¸…é™¤ï¼Œä¸‹æ¬¡æœç´¢å°†é‡æ–°è·å–å›¾ç‰‡")},style:{fontSize:"11px"},title:"æ¸…é™¤å›¾ç‰‡ç¼“å­˜ï¼Œé‡æ–°éªŒè¯æ‰€æœ‰å›¾ç‰‡æº",children:"ğŸ—‘ï¸ æ¸…é™¤å›¾ç‰‡ç¼“å­˜"})]}),e.jsx(ki,{placeholder:"è¾“å…¥ä¸­æ–‡å¡åã€è‹±æ–‡å¡åæˆ–å¡ç‰‡ID...",value:l,onChange:m=>y(m.target.value),onSearch:g,loading:o,allowClear:!0,style:{marginBottom:"16px"}}),e.jsx(K,{message:"æœç´¢æç¤º",description:"æ”¯æŒä¸­æ–‡å¡åã€è‹±æ–‡å¡åå’Œ8ä½æ•°å­—çš„å¡ç‰‡IDæœç´¢ã€‚å¯ä»¥è¾“å…¥éƒ¨åˆ†å…³é”®è¯è¿›è¡Œæ¨¡ç³ŠåŒ¹é…ã€‚",type:"info",showIcon:!0,style:{marginBottom:"16px"}})]}),e.jsxs("div",{style:{flex:1,padding:"0 16px 16px 16px",overflow:"hidden",display:"flex",flexDirection:"column",minHeight:0},children:[h&&e.jsx(K,{message:"æœç´¢å¤±è´¥",description:h,type:"error",showIcon:!0,style:{marginBottom:"16px",flexShrink:0}}),o?e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",flexShrink:0},children:e.jsx(Ie,{size:"large",tip:"æ­£åœ¨æœç´¢..."})}):r.length===0?e.jsx("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"200px",flexShrink:0},children:e.jsx(q,{image:q.PRESENTED_IMAGE_SIMPLE,description:l?"æœªæ‰¾åˆ°åŒ¹é…çš„å¡ç‰‡":"è¾“å…¥å…³é”®è¯å¼€å§‹æœç´¢"})}):e.jsxs("div",{style:{flex:1,overflow:"hidden",display:"flex",flexDirection:"column"},children:[e.jsx("div",{style:{marginBottom:"12px",flexShrink:0},children:e.jsxs(X,{type:"secondary",children:["æ‰¾åˆ° ",r.length," å¼ å¡ç‰‡"]})}),e.jsx("div",{style:{flex:1,overflow:"hidden",minHeight:"150px",border:"1px solid #d9d9d9",borderRadius:"6px",backgroundColor:"#fff",boxShadow:"0 1px 3px rgba(0,0,0,0.1)",display:"flex",flexDirection:"column"},children:e.jsx("div",{style:{flex:1,overflow:"auto",minHeight:0,padding:"4px"},children:r.map(b)})})]})]})]})},{TextArea:Ti}=_e,{Title:_i,Text:Ne}=ne,Ii=({cards:t,onCardsChange:i,initialYdkText:l=""})=>{const[n,r]=x.useState(l),[s,o]=x.useState(!1),[c,h]=x.useState(!1),[u,p]=x.useState(null),[g,f]=x.useState(!0),[y,w]=x.useState(!1),[j,d]=x.useState(null),b=x.useCallback(()=>{if(t.length===0)return`#created by Card PDF Generator
#main
#extra
!side
`;const C=[...t].sort((I,D)=>(I.firstIndex||0)-(D.firstIndex||0));let S=`#created by Card PDF Generator
#main
`;return C.forEach(I=>{for(let D=0;D<I.count;D++)S+=`${I.id}
`}),S+=`#extra
`,S+=`!side
`,S},[t]);x.useEffect(()=>{s||r(b())},[t,s,b]);const m=x.useCallback(C=>{try{if(!$e(C))return p("YDKæ ¼å¼æ— æ•ˆ"),d(null),!1;const S=de(C);return d(S),p(null),!0}catch(S){return p(S instanceof Error?S.message:"è§£æå¤±è´¥"),d(null),!1}},[]);x.useEffect(()=>{n.trim()?m(n):(p(null),d(null))},[n,m]);const a=x.useCallback(async()=>{if(m(n)){h(!0);try{const C=de(n);let S=ke(C,!0,!0);g&&(S=await Pi(S)),i(S),o(!1),p(null)}catch(C){p(C instanceof Error?C.message:"åº”ç”¨æ›´æ”¹å¤±è´¥")}finally{h(!1)}}},[n,g,i,m]),v=x.useCallback(()=>{r(b()),o(!1),p(null)},[b]),P=x.useCallback(()=>{const C=new Blob([n],{type:"text/plain;charset=utf-8"}),S=URL.createObjectURL(C),I=document.createElement("a");I.href=S,I.download=`deck_${new Date().toISOString().slice(0,10)}.ydk`,document.body.appendChild(I),I.click(),document.body.removeChild(I),URL.revokeObjectURL(S)},[n]),k=j?{main:j.main.length,extra:j.extra.length,side:j.side.length,total:j.main.length+j.extra.length+j.side.length}:null;return e.jsxs("div",{style:{height:"100%",display:"flex",flexDirection:"column"},children:[e.jsxs("div",{style:{padding:"16px 16px 0 16px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"16px"},children:[e.jsxs(_i,{level:5,style:{margin:0},children:[e.jsx(Ze,{})," YDKç¼–è¾‘å™¨"]}),e.jsxs(T,{children:[e.jsx(ee,{title:"è‡ªåŠ¨è·å–å¡ç‰‡ä¸­æ–‡åç§°",children:e.jsxs(T,{children:[e.jsx(Ne,{style:{fontSize:"12px"},children:"è‡ªåŠ¨è·å–å¡å"}),e.jsx(Ge,{size:"small",checked:g,onChange:f})]})}),e.jsx(_,{size:"small",icon:e.jsx(Xe,{}),onClick:()=>w(!0),disabled:!j,children:"é¢„è§ˆ"}),e.jsx(_,{size:"small",icon:e.jsx(Je,{}),onClick:P,disabled:!n.trim(),children:"ä¸‹è½½"})]})]}),k&&e.jsx(Qe,{size:"small",style:{marginBottom:"16px"},children:e.jsxs(Ct,{gutter:16,children:[e.jsx(ae,{span:6,children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"18px",fontWeight:"bold",color:"#1890ff"},children:k.main}),e.jsx("div",{style:{fontSize:"12px",color:"#666"},children:"ä¸»å¡ç»„"})]})}),e.jsx(ae,{span:6,children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"18px",fontWeight:"bold",color:"#52c41a"},children:k.extra}),e.jsx("div",{style:{fontSize:"12px",color:"#666"},children:"é¢å¤–å¡ç»„"})]})}),e.jsx(ae,{span:6,children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"18px",fontWeight:"bold",color:"#fa8c16"},children:k.side}),e.jsx("div",{style:{fontSize:"12px",color:"#666"},children:"å‰¯å¡ç»„"})]})}),e.jsx(ae,{span:6,children:e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"18px",fontWeight:"bold",color:"#722ed1"},children:k.total}),e.jsx("div",{style:{fontSize:"12px",color:"#666"},children:"æ€»è®¡"})]})})]})}),u&&e.jsx(K,{message:"æ ¼å¼é”™è¯¯",description:u,type:"error",showIcon:!0,style:{marginBottom:"16px"}})]}),e.jsxs("div",{style:{flex:1,padding:"0 16px 16px 16px",display:"flex",flexDirection:"column"},children:[e.jsx(Ti,{value:n,onChange:C=>{r(C.target.value),s||o(!0)},placeholder:"åœ¨è¿™é‡Œç¼–è¾‘YDKæ–‡ä»¶å†…å®¹...",style:{flex:1,fontFamily:"monospace",fontSize:"12px",resize:"none"},autoSize:!1}),e.jsxs("div",{style:{marginTop:"12px",display:"flex",justifyContent:"space-between"},children:[e.jsx(T,{children:e.jsxs(Ne,{type:"secondary",style:{fontSize:"11px"},children:[e.jsx(kt,{}),' æ”¯æŒå®æ—¶ç¼–è¾‘ï¼Œä¿®æ”¹åç‚¹å‡»"åº”ç”¨æ›´æ”¹"ç”Ÿæ•ˆ']})}),e.jsxs(T,{children:[e.jsx(_,{size:"small",icon:e.jsx($t,{}),onClick:v,disabled:!s,children:"é‡ç½®"}),e.jsx(_,{type:"primary",size:"small",icon:e.jsx(zt,{}),onClick:a,loading:c,disabled:!s||!!u,children:"åº”ç”¨æ›´æ”¹"})]})]})]}),e.jsx(Tt,{title:"YDKé¢„è§ˆ",open:y,onCancel:()=>w(!1),footer:[e.jsx(_,{onClick:()=>w(!1),children:"å…³é—­"},"close")],width:600,children:j&&e.jsx(Te,{defaultActiveKey:"main",items:[{key:"main",label:`ä¸»å¡ç»„ (${j.main.length})`,children:e.jsx("div",{style:{maxHeight:"300px",overflow:"auto"},children:j.main.map((C,S)=>e.jsx("div",{style:{padding:"4px 8px",backgroundColor:S%2===0?"#fafafa":"white",fontSize:"12px"},children:C},S))})},{key:"extra",label:`é¢å¤–å¡ç»„ (${j.extra.length})`,children:e.jsx("div",{style:{maxHeight:"300px",overflow:"auto"},children:j.extra.map((C,S)=>e.jsx("div",{style:{padding:"4px 8px",backgroundColor:S%2===0?"#fafafa":"white",fontSize:"12px"},children:C},S))})},{key:"side",label:`å‰¯å¡ç»„ (${j.side.length})`,children:e.jsx("div",{style:{maxHeight:"300px",overflow:"auto"},children:j.side.map((C,S)=>e.jsx("div",{style:{padding:"4px 8px",backgroundColor:S%2===0?"#fafafa":"white",fontSize:"12px"},children:C},S))})}]})})]})},{Dragger:Ri}=_t,{Title:Ei,Text:O}=ne,{TextArea:Di}=_e,Li=({cards:t,imageStatus:i,onCardsChange:l,onImageFolderSelect:n,hasImageFolder:r})=>{const[s,o]=x.useState(""),[c,h]=x.useState(!1),[u,p]=x.useState("upload"),[g,f]=x.useState(!1),y=async a=>{try{f(!0);const v=await mi(a);if(!$e(v))throw new Error("æ— æ•ˆçš„YDKæ–‡ä»¶æ ¼å¼");const P=de(v);let $=ke(P,!0,!0);console.log("YDKè§£æç»“æœ:",{main:P.main.length,extra:P.extra.length,side:P.side.length,æ€»å¡ç‰‡æ•°:$.length});try{$=await Fe($),console.log("å¡ç‰‡åç§°è·å–å®Œæˆï¼ˆä»…æœ¬åœ°å›¾ç‰‡ï¼‰")}catch(k){console.warn("è·å–å¡ç‰‡åç§°å¤±è´¥:",k)}l($),o(v),p("deck-info")}catch(v){console.error("YDKæ–‡ä»¶è§£æå¤±è´¥:",v)}finally{f(!1)}return!1},w=async()=>{try{if(f(!0),!$e(s))throw new Error("æ— æ•ˆçš„YDKæ ¼å¼");const a=de(s);let v=ke(a,!0,!0);console.log("YDKæ–‡æœ¬è§£æç»“æœ:",{main:a.main.length,extra:a.extra.length,side:a.side.length,æ€»å¡ç‰‡æ•°:v.length});try{v=await Fe(v),console.log("å¡ç‰‡åç§°è·å–å®Œæˆï¼ˆä»…æœ¬åœ°å›¾ç‰‡ï¼‰")}catch(P){console.warn("è·å–å¡ç‰‡åç§°å¤±è´¥:",P)}l(v),h(!1),p("deck-info")}catch(a){console.error("YDKæ–‡æœ¬è§£æå¤±è´¥:",a)}finally{f(!1)}},j=()=>{l([]),o(""),p("upload")},d=a=>{const v=t.findIndex(P=>P.id===a.id);if(v>=0){const P=[...t];P[v]={...P[v],count:P[v].count+a.count},l(P)}else{const P=[...t,a];l(P),t.length===0&&p("deck-info")}},m=(()=>{const a=t.reduce(($,k)=>$+k.count,0),v=t.filter($=>$.hasImage).reduce(($,k)=>$+k.count,0),P=a-v;return{total:a,found:v,missing:P}})();return e.jsxs("div",{className:"deck-panel",children:[e.jsx("div",{className:"section-title",children:e.jsx(Ei,{level:4,children:"å¡ç»„ç®¡ç†"})}),e.jsx("div",{style:{height:"calc(100vh - 120px)",display:"flex",flexDirection:"column"},children:e.jsx("div",{style:{flex:1,minHeight:"0",display:"flex",flexDirection:"column"},children:e.jsx(Te,{activeKey:u,onChange:p,style:{height:"100%",display:"flex",flexDirection:"column"},tabBarStyle:{flexShrink:0},items:[{key:"upload",label:e.jsxs("span",{children:[e.jsx(De,{}),"æ–‡ä»¶å¯¼å…¥"]}),children:e.jsxs("div",{style:{padding:"16px",height:"100%",overflow:"auto",display:"flex",flexDirection:"column"},children:[e.jsxs(T,{direction:"vertical",style:{width:"100%"},children:[c?e.jsxs("div",{children:[e.jsx(Di,{value:s,onChange:a=>o(a.target.value),placeholder:"ç²˜è´´YDKæ–‡æœ¬å†…å®¹...",rows:6,style:{marginBottom:12}}),e.jsxs(T,{children:[e.jsx(_,{type:"primary",onClick:w,loading:g,children:"å¯¼å…¥"}),e.jsx(_,{onClick:()=>h(!1),children:"å–æ¶ˆ"})]})]}):e.jsxs(Ri,{accept:".ydk",beforeUpload:y,showUploadList:!1,style:{padding:"20px 16px"},children:[e.jsx("p",{className:"ant-upload-drag-icon",children:e.jsx(De,{})}),e.jsx("p",{className:"ant-upload-text",children:"ç‚¹å‡»æˆ–æ‹–æ‹½YDKæ–‡ä»¶åˆ°æ­¤åŒºåŸŸ"}),e.jsx("p",{className:"ant-upload-hint",children:"æ”¯æŒ.ydkæ ¼å¼çš„å¡ç»„æ–‡ä»¶"})]}),e.jsx("div",{children:e.jsxs(T,{children:[e.jsx(_,{icon:e.jsx(It,{}),onClick:()=>h(!c),size:"small",children:c?"æ–‡ä»¶ä¸Šä¼ ":"æ–‡æœ¬å¯¼å…¥"}),t.length>0&&e.jsx(_,{onClick:j,size:"small",danger:!0,children:"æ¸…ç©ºå¡ç»„"})]})})]}),e.jsx(qe,{}),e.jsx("div",{style:{marginBottom:16},children:e.jsxs(T,{direction:"vertical",style:{width:"100%"},children:[e.jsx(O,{strong:!0,children:"å›¾ç‰‡æ–‡ä»¶å¤¹:"}),e.jsx(_,{icon:e.jsx(Rt,{}),onClick:n,type:r?"default":"primary",block:!0,children:r?"é‡æ–°é€‰æ‹©å›¾ç‰‡æ–‡ä»¶å¤¹":"é€‰æ‹©å›¾ç‰‡æ–‡ä»¶å¤¹"}),r&&e.jsx(K,{message:"å›¾ç‰‡æ–‡ä»¶å¤¹å·²é€‰æ‹©",description:"æ–‡ä»¶å‘½åæ ¼å¼: å¡ç‰‡ID.jpg æˆ– å¡ç‰‡ID_å¡ç‰‡å.jpg",type:"success",showIcon:!0}),e.jsxs("div",{style:{marginTop:12,padding:"12px",backgroundColor:"#f8f9fa",borderRadius:"6px",border:"1px solid #e9ecef"},children:[e.jsx(O,{strong:!0,style:{fontSize:13,color:"#495057"},children:"æ¨èå¡å›¾ä¸‹è½½:"}),e.jsx("div",{style:{marginTop:8},children:e.jsx("a",{href:"https://www.bilibili.com/opus/1069400080244539448?from=search&spm_id_from=333.337.0.0",target:"_blank",rel:"noopener noreferrer",style:{display:"block",color:"#1890ff",textDecoration:"none",fontSize:12,padding:"4px 8px",backgroundColor:"#fff",borderRadius:"4px",border:"1px solid #d9d9d9",transition:"all 0.2s"},onMouseEnter:a=>{a.currentTarget.style.backgroundColor="#f0f8ff",a.currentTarget.style.borderColor="#1890ff"},onMouseLeave:a=>{a.currentTarget.style.backgroundColor="#fff",a.currentTarget.style.borderColor="#d9d9d9"},children:"ğŸ“¦ ä¸­æ–‡é«˜æ¸…å¡å›¾èµ„æºåŒ… (Bilibili)"})}),e.jsx("div",{style:{marginTop:6},children:e.jsx(O,{type:"secondary",style:{fontSize:11},children:'ğŸ’¡ æç¤º: ä¸‹è½½åè§£å‹åˆ°æ–‡ä»¶å¤¹ï¼ŒæŒ‰"å¡ç‰‡ID.jpg"æ ¼å¼å‘½åå›¾ç‰‡æ–‡ä»¶'})})]})]})}),(i.isProcessing||g)&&e.jsxs("div",{style:{marginBottom:16},children:[e.jsx(O,{children:g?"æ­£åœ¨è·å–å¡ç‰‡ä¿¡æ¯...":"æ­£åœ¨åŠ è½½å›¾ç‰‡..."}),e.jsx(Se,{percent:i.isProcessing?Math.round(i.loaded/i.total*100):void 0,size:"small"})]})]})},{key:"search",label:e.jsxs("span",{children:[e.jsx(Ke,{}),"å¡ç‰‡æœç´¢"]}),children:e.jsx("div",{style:{height:"100%",overflow:"hidden",display:"flex",flexDirection:"column"},children:e.jsx(zi,{onAddCard:d,existingCards:t})})},{key:"editor",label:e.jsxs("span",{children:[e.jsx(Ze,{}),"YDKç¼–è¾‘å™¨"]}),children:e.jsx("div",{style:{height:"100%",display:"flex",flexDirection:"column",overflow:"hidden"},children:e.jsx(Ii,{cards:t,onCardsChange:l,initialYdkText:s})})},{key:"deck-info",label:e.jsx("span",{children:"ğŸ“Š å¡ç»„ä¿¡æ¯"}),children:e.jsx("div",{style:{height:"100%",display:"flex",flexDirection:"column",overflow:"hidden"},children:t.length===0?e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:"100%",color:"#999",fontSize:"14px"},children:"è¯·å…ˆå¯¼å…¥å¡ç»„æ•°æ®"}):e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{backgroundColor:"#fff",borderBottom:"1px solid #f0f0f0",flexShrink:0},children:[e.jsx("div",{style:{padding:"12px 16px",borderBottom:"1px solid #f0f0f0",backgroundColor:"#fafafa"},children:e.jsx(O,{strong:!0,children:"å¡ç»„ç»Ÿè®¡"})}),e.jsxs("div",{style:{padding:"12px 16px"},children:[e.jsxs("div",{className:"grid-stats",style:{display:"grid",gridTemplateColumns:"repeat(4, 1fr)",gap:"12px",marginBottom:"12px"},children:[e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"18px",fontWeight:"bold",color:"#333"},children:t.length}),e.jsx("div",{style:{fontSize:"12px",color:"#666"},children:"ç§ç±»"})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"18px",fontWeight:"bold",color:"#333"},children:m.total}),e.jsx("div",{style:{fontSize:"12px",color:"#666"},children:"æ€»æ•°"})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"18px",fontWeight:"bold",color:"#52c41a"},children:m.found}),e.jsx("div",{style:{fontSize:"12px",color:"#666"},children:"å·²æ‰¾åˆ°"})]}),e.jsxs("div",{style:{textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"18px",fontWeight:"bold",color:"#ff4d4f"},children:m.missing}),e.jsx("div",{style:{fontSize:"12px",color:"#666"},children:"ç¼ºå¤±"})]})]}),m.total>0&&e.jsxs("div",{style:{marginBottom:"12px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:"6px"},children:[e.jsx(O,{style:{fontSize:"12px"},children:"å®Œæ•´åº¦"}),e.jsxs(O,{style:{fontSize:"12px",fontWeight:"bold"},children:[Math.round(m.found/m.total*100),"%"]})]}),e.jsx(Se,{percent:Math.round(m.found/m.total*100),status:m.missing>0?"active":"success",size:"small",showInfo:!1})]}),t.some(a=>a.imageSource)&&e.jsxs("div",{style:{marginBottom:"12px"},children:[e.jsx(O,{style:{fontSize:"12px",color:"#666",marginBottom:"6px",display:"block"},children:"å›¾ç‰‡æ¥æº (ä»…æœ¬åœ°å›¾ç‰‡å¯ç”¨äºPDF)"}),e.jsx("div",{style:{fontSize:"11px"},children:e.jsxs(T,{direction:"horizontal",size:"middle",wrap:!0,children:[t.filter(a=>a.imageSource==="local"&&a.hasImage).length>0&&e.jsxs("span",{style:{color:"#52c41a"},children:["ğŸ“ æœ¬åœ°: ",t.filter(a=>a.imageSource==="local"&&a.hasImage).length]}),t.filter(a=>a.imageSource==="momobako"&&a.hasImage).length>0&&e.jsxs("span",{style:{color:"#f57c00"},children:["ğŸš€ Momobako: ",t.filter(a=>a.imageSource==="momobako"&&a.hasImage).length]}),t.filter(a=>a.imageSource==="yugipedia"&&a.hasImage).length>0&&e.jsxs("span",{style:{color:"#f57c00"},children:["ğŸŒ Yugipedia: ",t.filter(a=>a.imageSource==="yugipedia"&&a.hasImage).length]}),t.filter(a=>a.imageSource==="fallback"&&a.hasImage).length>0&&e.jsxs("span",{style:{color:"#f57c00"},children:["ğŸ”„ å¤‡ç”¨: ",t.filter(a=>a.imageSource==="fallback"&&a.hasImage).length]})]})})]}),i.missing.length>0&&e.jsx(K,{message:`${i.missing.length} å¼ å¡ç‰‡ç¼ºå¤±æœ¬åœ°å›¾ç‰‡`,type:"warning",showIcon:!0,style:{marginTop:"8px",fontSize:"12px"}})]})]}),e.jsxs("div",{style:{flex:1,backgroundColor:"#fff",display:"flex",flexDirection:"column",minHeight:"0"},children:[e.jsx("div",{style:{padding:"12px 16px",borderBottom:"1px solid #f0f0f0",backgroundColor:"#fafafa",flexShrink:0},children:e.jsx(O,{strong:!0,children:"å¡ç‰‡åˆ—è¡¨"})}),e.jsx("div",{style:{flex:1,overflow:"auto",minHeight:"0"},children:e.jsx(Le,{size:"small",dataSource:t,renderItem:a=>e.jsx(Le.Item,{style:{padding:"10px 16px",borderBottom:"1px solid #f5f5f5"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",width:"100%"},children:[e.jsx("div",{style:{width:"6px",height:"6px",borderRadius:"50%",backgroundColor:a.hasImage?"#52c41a":"#ff4d4f",marginRight:"10px",flexShrink:0}}),e.jsxs("div",{style:{flex:1,minWidth:0},children:[e.jsxs("div",{style:{fontSize:"13px",fontWeight:500,color:a.hasImage?"#333":"#ff4d4f",lineHeight:"18px"},children:[a.id,!a.hasImage&&e.jsx("span",{style:{color:"#ff4d4f",fontSize:"10px",marginLeft:"6px"},children:"[ç¼ºå¤±]"})]}),a.name&&e.jsx("div",{style:{fontSize:"11px",color:"#666",lineHeight:"16px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:a.name}),a.imageSource&&a.hasImage&&e.jsx("div",{style:{fontSize:"10px",color:a.imageSource==="local"?"#52c41a":"#f57c00",lineHeight:"14px"},children:a.imageSource==="local"?"ğŸ“ æœ¬åœ°":a.imageSource==="momobako"?"ğŸš€ Momobako CDN":a.imageSource==="yugipedia"?"ğŸŒ Yugipedia":"ğŸ”„ å¤‡ç”¨æº"})]}),e.jsx(V,{color:a.hasImage?"success":"error",style:{fontSize:"11px",lineHeight:"18px",margin:0,minWidth:"36px",textAlign:"center"},children:a.count})]})})})})]})]})})}]})})})]})},Ai=[".jpg",".jpeg",".png",".webp"];async function Mi(t,i,l){const n=[...i],r=[];let s=0;const o=i.length,c=new Map,h=[];try{for await(const[u,p]of t.entries())if(p.kind==="file"){const g=await p.getFile(),f=u.toLowerCase().substring(u.lastIndexOf("."));if(Ai.includes(f)){h.push(u);const y=[/^(\d{8})(?:[_\-\.]|$)/,/^(\d+)(?:[_\-\.]|$)/];let w=null;for(const j of y){const d=u.match(j);if(d){w=d[1],w=w.padStart(8,"0");break}}if(w){c.set(w,g);const j=w.replace(/^0+/,"")||"0";j!==w&&c.set(j,g),console.log(`æ‰¾åˆ°å›¾ç‰‡: ${u} -> å¡ç‰‡ID: ${w} (ä¹Ÿæ˜ å°„ä¸º: ${j})`)}else console.warn(`æ— æ³•è§£æå›¾ç‰‡æ–‡ä»¶å: ${u}`)}}console.log(`æ‰«æå®Œæˆï¼Œæ‰¾åˆ° ${h.length} ä¸ªå›¾ç‰‡æ–‡ä»¶:`,h),console.log(`æˆåŠŸåŒ¹é… ${c.size} ä¸ªå¡ç‰‡ID:`,Array.from(c.keys())),console.log("éœ€è¦æŸ¥æ‰¾çš„å¡ç‰‡ID:",i.map(u=>u.id));for(let u=0;u<n.length;u++){const p=n[u];let g=c.get(p.id);if(!g){const f=p.id.replace(/^0+/,"")||"0",y=f.padStart(8,"0");g=c.get(y),g||(g=c.get(f)),g&&console.log(`é€šè¿‡å˜æ¢IDæ‰¾åˆ°å›¾ç‰‡: ${p.id} -> ${f} -> ${g.name}`)}if(g){const f=URL.createObjectURL(g);n[u]={...p,imageUrl:f,hasImage:!0},s++,console.log(`æˆåŠŸåŠ è½½å›¾ç‰‡: ${p.id} -> ${g.name}`)}else r.push(p.id),n[u]={...p,hasImage:!1},console.warn(`æœªæ‰¾åˆ°å›¾ç‰‡: ${p.id}`);l&&l(s,o,r)}}catch(u){throw console.error("åŠ è½½å›¾ç‰‡æ—¶å‡ºé”™:",u),new Error("æ— æ³•è®¿é—®å›¾ç‰‡æ–‡ä»¶å¤¹")}return n}function Hi(t){return new Promise((i,l)=>{const n=new Image;n.onload=()=>i(n),n.onerror=()=>l(new Error(`å›¾ç‰‡åŠ è½½å¤±è´¥: ${t}`)),n.src=t})}function Wi(t,i,l,n="fill",r=2){const s=document.createElement("canvas"),o=s.getContext("2d"),c=i*r,h=l*r;s.width=c,s.height=h,o.imageSmoothingEnabled=!0,o.imageSmoothingQuality="high",o.fillStyle="#ffffff",o.fillRect(0,0,c,h);const{width:u,height:p}=t,g=i/l,f=u/p;let y,w,j,d;return n==="fit"?f>g?(y=c,w=c/f,j=0,d=(h-w)/2):(w=h,y=h*f,j=(c-y)/2,d=0):f>g?(w=h,y=h*f,j=(c-y)/2,d=0):(y=c,w=c/f,j=0,d=(h-w)/2),o.drawImage(t,j,d,y,w),s}function Oi(t){for(const i of t)i.imageUrl&&URL.revokeObjectURL(i.imageUrl)}const M=28.35;function je(t){const{cardSize:i,spacing:l,pageSettings:n,orientation:r,cardRotation:s}=t;let o=i.width*M,c=i.height*M;s==="rotated"&&(console.log("æ—‹è½¬å‰å°ºå¯¸:",{cardWidthPt:o,cardHeightPt:c}),[o,c]=[c,o],console.log("æ—‹è½¬åå°ºå¯¸:",{cardWidthPt:o,cardHeightPt:c}));const h=l.horizontal*M,u=l.vertical*M,p=n.margin*M;let g,f;r==="landscape"?(g=n.height*M,f=n.width*M):(g=n.width*M,f=n.height*M);const y=g-2*p,w=f-2*p,j=Math.floor(h===0?y/o:(y+h)/(o+h)),d=Math.floor(u===0?w/c:(w+u)/(c+u)),b=j*d;return{columns:j,rows:d,cardsPerPage:b,cardWidthPt:o,cardHeightPt:c,spacingHPt:h,spacingVPt:u,marginPt:p,pageWidthPt:g,pageHeightPt:f,availableWidth:y,availableHeight:w,orientation:r,cardRotation:s}}function xt(t,i){const l=je(i),n=[],r=[];for(const s of t)for(let o=0;o<s.count;o++)r.push({...s,count:1});for(let s=0;s<r.length;s+=l.cardsPerPage){const o=r.slice(s,s+l.cardsPerPage);n.push({cards:o,layout:{columns:l.columns,rows:l.rows}})}return n}async function Bi(t,i,l){const n=je(i),r=xt(t,i);l&&l(0,r.length,"åˆå§‹åŒ–PDFæ–‡æ¡£...");const s=await Mt.create(),o=new Map,c=t.filter(u=>u.hasImage&&u.imageUrl&&u.imageSource==="local");l&&l(0,c.length,"é¢„åŠ è½½å›¾ç‰‡...");for(let u=0;u<c.length;u++){const p=c[u];if(p.imageUrl&&!o.has(p.id))try{const g=await Hi(p.imageUrl);o.set(p.id,g)}catch(g){console.warn(`å›¾ç‰‡åŠ è½½å¤±è´¥: ${p.id}`,g)}l&&l(u+1,c.length,"é¢„åŠ è½½å›¾ç‰‡...")}for(let u=0;u<r.length;u++){const p=r[u];l&&l(u+1,r.length,`ç”Ÿæˆç¬¬${u+1}é¡µ...`);const g=s.addPage([n.pageWidthPt,n.pageHeightPt]);for(let f=0;f<p.cards.length;f++){const y=p.cards[f],w=f%p.layout.columns,j=Math.floor(f/p.layout.columns);let d=n.spacingHPt===0?n.marginPt+w*n.cardWidthPt:n.marginPt+w*(n.cardWidthPt+n.spacingHPt),b=n.spacingVPt===0?n.pageHeightPt-n.marginPt-(j+1)*n.cardHeightPt:n.pageHeightPt-n.marginPt-(j+1)*(n.cardHeightPt+n.spacingVPt)+n.spacingVPt;const m=i.cardSize.width*M,a=i.cardSize.height*M;if(y.hasImage&&y.imageUrl&&y.imageSource==="local"&&o.has(y.id)){const v=o.get(y.id),P=Wi(v,m,a,i.cropMode,i.imageQuality.resolution),$=Fi(P,i.imageQuality.quality,i.imageQuality.format),k=i.imageQuality.format==="png"?await s.embedPng($):await s.embedJpg($);if(i.cardRotation==="rotated"){const C=d+n.cardWidthPt/2,S=b+n.cardHeightPt/2;g.drawImage(k,{x:C-a/2,y:S+m/2,width:m,height:a,rotate:ve(-90)})}else g.drawImage(k,{x:d,y:b,width:n.cardWidthPt,height:n.cardHeightPt});i.showCuttingLines&&Yi(g,d,b,n.cardWidthPt,n.cardHeightPt,n.pageHeightPt,i.cuttingLineWidth)}else if(i.cardRotation==="rotated"){const v=d+n.cardWidthPt/2,P=b+n.cardHeightPt/2;g.drawRectangle({x:v-a/2,y:P+m/2,width:m,height:a,borderColor:N(.8,.8,.8),borderWidth:1,color:N(.95,.95,.95),rotate:ve(-90)}),g.drawText(y.id||"æœªçŸ¥",{x:v,y:P,size:8,color:N(.5,.5,.5),rotate:ve(-90)})}else g.drawRectangle({x:d,y:b,width:n.cardWidthPt,height:n.cardHeightPt,borderColor:N(.8,.8,.8),borderWidth:1,color:N(.95,.95,.95)}),g.drawText(y.id||"æœªçŸ¥",{x:d+n.cardWidthPt/2-30,y:b+n.cardHeightPt/2,size:8,color:N(.5,.5,.5)})}}return l&&l(r.length,r.length,"ä¿å­˜PDFæ–‡ä»¶..."),await s.save()}function Fi(t,i=.95,l="png"){const n=l==="png"?"image/png":"image/jpeg",s=t.toDataURL(n,i).split(",")[1],o=atob(s),c=new Uint8Array(o.length);for(let h=0;h<o.length;h++)c[h]=o.charCodeAt(h);return c}function Ni(t,i="yugioh_cards.pdf"){const l=new Blob([t],{type:"application/pdf"}),n=URL.createObjectURL(l),r=document.createElement("a");r.href=n,r.download=i,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(n)}function Yi(t,i,l,n,r,s,o=.5){const c=N(.6,.6,.6),h=o/2,u=i+n+h,p=l-h,g=i-h,f=l+r+h,y=t.getWidth();t.drawLine({start:{x:0,y:p},end:{x:y,y:p},thickness:o,color:c}),t.drawLine({start:{x:u,y:0},end:{x:u,y:s},thickness:o,color:c}),t.drawLine({start:{x:0,y:f},end:{x:y,y:f},thickness:o,color:c}),t.drawLine({start:{x:g,y:0},end:{x:g,y:s},thickness:o,color:c})}function Ui(){const t=di();return{cardSize:{width:5.9,height:8.6},spacing:{horizontal:.6,vertical:.6},pageSettings:{width:t.width,height:t.height,margin:.6},cropMode:"fill",orientation:"portrait",cardRotation:"normal",imageQuality:{resolution:3,quality:.95,format:"png"},showCuttingLines:!0,cuttingLineWidth:.5}}function Ye(t){const i=je(t);console.log("=== å¸ƒå±€è°ƒè¯•ä¿¡æ¯ ==="),console.log("é¡µé¢æ–¹å‘:",t.orientation),console.log("é¡µé¢å°ºå¯¸ (pt):",{width:i.pageWidthPt,height:i.pageHeightPt}),console.log("é¡µè¾¹è· (pt):",i.marginPt),console.log("å¯ç”¨åŒºåŸŸ (pt):",{width:i.availableWidth,height:i.availableHeight}),console.log("å¡ç‰‡å°ºå¯¸ (pt):",{width:i.cardWidthPt,height:i.cardHeightPt}),console.log("é—´è· (pt):",{horizontal:i.spacingHPt,vertical:i.spacingVPt}),console.log("ç½‘æ ¼:",{columns:i.columns,rows:i.rows}),console.log("æ¯é¡µå¡ç‰‡æ•°:",i.cardsPerPage);const l=i.spacingHPt===0?i.columns*i.cardWidthPt:i.columns*i.cardWidthPt+(i.columns-1)*i.spacingHPt,n=i.spacingVPt===0?i.rows*i.cardHeightPt:i.rows*i.cardHeightPt+(i.rows-1)*i.spacingVPt;if(console.log("å®é™…ä½¿ç”¨åŒºåŸŸ (pt):",{width:l,height:n}),console.log("å‰©ä½™ç©ºé—´ (pt):",{width:i.availableWidth-l,height:i.availableHeight-n}),i.columns>0&&i.rows>0){const r=i.marginPt,s=i.pageHeightPt-i.marginPt-i.cardHeightPt;if(console.log("ç¬¬ä¸€å¼ å¡ç‰‡ä½ç½® (pt):",{x:r,y:s}),i.columns>1){const o=i.spacingHPt===0?i.marginPt+i.cardWidthPt:i.marginPt+i.cardWidthPt+i.spacingHPt;console.log("ç¬¬äºŒå¼ å¡ç‰‡ä½ç½® (pt):",{x:o,y:s})}}return i}const ie=()=>window.innerWidth<=768,ze=()=>window.innerWidth<=480,Vi=()=>"ontouchstart"in window||navigator.maxTouchPoints>0,Ue=()=>ze()?30:ie()?50:80,qi=()=>{if(!ie())return;const t=document.querySelector("meta[name=viewport]"),i=t==null?void 0:t.content;document.addEventListener("focusin",l=>{(l.target instanceof HTMLInputElement||l.target instanceof HTMLTextAreaElement)&&t&&(t.content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no")}),document.addEventListener("focusout",()=>{t&&i&&(t.content=i)})},Gi=()=>{typeof window>"u"||(qi(),ie()&&document.body.classList.add("mobile-device"),Vi()&&document.body.classList.add("touch-device"),ze()&&document.body.classList.add("small-screen"),window.addEventListener("orientationchange",()=>{setTimeout(()=>{window.scrollTo(0,0)},100)}),window.addEventListener("resize",()=>{const t=document.body;t.classList.toggle("mobile-device",ie()),t.classList.toggle("small-screen",ze())}))},{Title:Ki,Text:Ve}=ne,Qi=({cards:t,layout:i,isGenerating:l,onGeneratePdf:n,hasImageFolder:r})=>{const[s,o]=J.useState(()=>Ue()),[c,h]=J.useState(1);x.useEffect(()=>{const a=()=>{ie()&&o(Ue())};return window.addEventListener("resize",a),()=>window.removeEventListener("resize",a)},[]);const u=x.useMemo(()=>{if(t.length===0)return{pages:[],layoutInfo:null};const a=je(i),v=xt(t,i);return i.spacing.horizontal===0&&i.spacing.vertical===0&&(console.log("è°ƒè¯•é›¶é—´è·å¸ƒå±€:"),Ye(i)),i.pageSettings.margin!==1&&(console.log(`è°ƒè¯•é¡µè¾¹è· ${i.pageSettings.margin}cm:`),Ye(i)),{pages:v,layoutInfo:a}},[t,i]),{pages:p,layoutInfo:g}=u,f=J.useCallback(()=>{if(!g)return 80;const a=document.querySelector(".preview-content");if(!a)return 80;const v=a.clientWidth-40;let P=40;p.length>1&&(P+=80);const $=a.clientHeight-P,k=g.pageWidthPt,C=g.pageHeightPt,S=v/k*100,I=$/C*100,D=Math.min(S,I,400);return Math.max(25,Math.floor(D))},[g,p.length]),y=()=>{const a=f();o(a)};J.useEffect(()=>{g&&p.length>0&&setTimeout(()=>{const a=f();a>25&&o(a)},100)},[g,p.length,f]);const w=(a,v,P=0,$=0)=>{const k=P>0||$>0,C=i.cardRotation==="rotated";return e.jsx("div",{className:`card-item ${a.hasImage?"":"missing"} ${k?"":"no-spacing"} ${C?"rotated":""}`,style:{width:"100%",height:"100%",fontSize:`${Math.max(8,12*s/100)}px`,display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden"},children:a.hasImage&&a.imageUrl?e.jsx("img",{src:a.imageUrl,alt:a.id,style:{width:"100%",height:"100%",objectFit:i.cropMode==="fill"?"cover":"contain"}}):e.jsxs("div",{style:{padding:"4px",textAlign:"center"},children:[e.jsx("div",{style:{fontSize:"80%",marginBottom:"2px"},children:"ç¼ºå¤±å›¾ç‰‡"}),e.jsx("div",{style:{fontSize:"70%",opacity:.7},children:a.id}),a.name&&e.jsx("div",{style:{fontSize:"60%",opacity:.5,marginTop:"2px",wordBreak:"break-all"},children:a.name})]})})},j=(a,v)=>{if(!g)return null;const P=g.pageWidthPt*s/100,$=g.pageHeightPt*s/100,k=g.marginPt*s/100,C=g.spacingHPt*s/100,S=g.spacingVPt*s/100;return e.jsxs("div",{className:"pdf-page",style:{width:`${P}px`,height:`${$}px`,margin:"0 auto"},children:[e.jsx("div",{className:"card-container",style:{position:"relative",width:`${P-2*k}px`,height:`${$-2*k}px`,left:`${k}px`,top:`${k}px`,border:i.pageSettings.margin>0?"1px dashed rgba(255, 0, 0, 0.3)":"none",boxSizing:"border-box"},children:a.cards.map((I,D)=>{const B=D%a.layout.columns,F=Math.floor(D/a.layout.columns),R=g.cardWidthPt*s/100,E=g.cardHeightPt*s/100;D===0&&console.log("å¡ç‰‡å°ºå¯¸è°ƒè¯•:",{rotation:i.cardRotation,originalSize:i.cardSize,rotatedWidth:R,rotatedHeight:E,widthPt:g.cardWidthPt,heightPt:g.cardHeightPt,zoomLevel:s,aspectRatio:R/E,expectedRatio:i.cardRotation==="rotated"?8.6/5.9:5.9/8.6,containerWidth:`${R}px`,containerHeight:`${E}px`});let Y,U;return i.cardRotation==="rotated"?(Y=C===0?B*R-(E-R)/2:B*(R+C)-(E-R)/2,U=S===0?F*E-(R-E)/2:F*(E+S)-(R-E)/2):(Y=C===0?B*R:B*(R+C),U=S===0?F*E:F*(E+S)),e.jsx("div",{style:{position:"absolute",left:`${Y}px`,top:`${U}px`,width:`${R}px`,height:`${E}px`,...i.cardRotation==="rotated"&&{width:`${E}px`,height:`${R}px`}},children:w(I,D,C,S)},`${I.id}-${D}`)})}),i.showCuttingLines&&a.cards.map((I,D)=>{const B=D%a.layout.columns,F=Math.floor(D/a.layout.columns),R=g.cardWidthPt*s/100,E=g.cardHeightPt*s/100,Y=k+(C===0?B*R:B*(R+C)),U=k+(S===0?F*E:F*(E+S)),re=Math.max(.5,(i.cuttingLineWidth||.5)*1.33*s/100),yt=Y+R,jt=U+E,vt=Y,wt=U;return e.jsxs("div",{children:[e.jsx("div",{style:{position:"absolute",left:0,top:`${jt}px`,width:"100%",height:`${re}px`,backgroundColor:"#999",pointerEvents:"none",zIndex:10}}),e.jsx("div",{style:{position:"absolute",left:`${yt}px`,top:0,width:`${re}px`,height:"100%",backgroundColor:"#999",pointerEvents:"none",zIndex:10}}),e.jsx("div",{style:{position:"absolute",left:0,top:`${wt}px`,width:"100%",height:`${re}px`,backgroundColor:"#999",pointerEvents:"none",zIndex:10}}),e.jsx("div",{style:{position:"absolute",left:`${vt}px`,top:0,width:`${re}px`,height:"100%",backgroundColor:"#999",pointerEvents:"none",zIndex:10}})]},`cutting-${I.id}-${D}`)})]},v)},d=t.length>0&&r,b=t.reduce((a,v)=>a+v.count,0),m=t.filter(a=>a.hasImage).reduce((a,v)=>a+v.count,0);return e.jsxs("div",{className:"preview-area",children:[e.jsxs("div",{className:"preview-toolbar",children:[e.jsx("div",{children:e.jsxs(T,{align:"center",children:[e.jsx(Ki,{level:5,style:{margin:0},children:"é¢„è§ˆ"}),p.length>0&&e.jsxs(Ve,{type:"secondary",children:[p.length," é¡µ | ",b," å¼ å¡ç‰‡",m<b&&e.jsxs("span",{style:{color:"#ff4d4f"},children:["(",b-m," å¼ ç¼ºå¤±)"]}),g&&e.jsxs(e.Fragment,{children:[e.jsx("span",{style:{color:"#d9d9d9",margin:"0 8px"},children:"|"}),e.jsxs("span",{children:["æ¯é¡µ ",g.cardsPerPage," å¼ "]}),e.jsx("span",{style:{color:"#d9d9d9",margin:"0 8px"},children:"|"}),e.jsxs("span",{children:[g.columns," åˆ— Ã— ",g.rows," è¡Œ"]}),e.jsx("span",{style:{color:"#d9d9d9",margin:"0 8px"},children:"|"}),e.jsxs("span",{children:["å¡ç‰‡ ",i.cardSize.width,"Ã—",i.cardSize.height,"cm"]})]})]})]})}),e.jsxs(T,{children:[e.jsxs(T,{align:"center",children:[e.jsx(Et,{}),e.jsx(le,{value:s,onChange:o,min:25,max:400,style:{width:120},tooltip:{formatter:a=>`${a}%`}}),e.jsx(Dt,{}),e.jsxs(Ve,{style:{minWidth:40},children:[s,"%"]}),e.jsx(_,{size:"small",icon:e.jsx(Xe,{}),onClick:y,title:"é€‚åˆçª—å£",children:"é€‚åˆ"}),e.jsxs(_.Group,{size:"small",children:[e.jsx(_,{onClick:()=>o(100),title:"å®é™…å¤§å°",children:"100%"}),e.jsx(_,{onClick:()=>o(150),title:"æ”¾å¤§æ˜¾ç¤º",children:"150%"}),e.jsx(_,{onClick:()=>o(200),title:"é«˜æ¸…æ˜¾ç¤º",children:"200%"})]})]}),e.jsx(_,{type:"primary",icon:e.jsx(Je,{}),onClick:n,loading:l,disabled:!d,children:"ç”ŸæˆPDF"})]})]}),e.jsx("div",{className:"preview-content",children:p.length===0?e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:"100%",padding:"60px 20px"},children:t.length===0?e.jsx(q,{image:q.PRESENTED_IMAGE_SIMPLE,description:"è¯·å…ˆå¯¼å…¥YDKå¡ç»„æ–‡ä»¶"}):r?e.jsx(Ie,{size:"large",tip:"æ­£åœ¨è®¡ç®—æ’ç‰ˆ..."}):e.jsx(q,{image:q.PRESENTED_IMAGE_SIMPLE,description:"è¯·å…ˆé€‰æ‹©å›¾ç‰‡æ–‡ä»¶å¤¹"})}):e.jsxs("div",{style:{width:"100%",minHeight:"100%",display:"flex",flexDirection:"column"},children:[p.length>1&&e.jsx("div",{style:{textAlign:"center",padding:"20px 20px 10px 20px",position:"sticky",top:0,backgroundColor:"#fafafa",zIndex:10,borderBottom:"1px solid #f0f0f0"},children:e.jsx(Lt,{current:c,total:p.length,pageSize:1,onChange:h,showSizeChanger:!1,showQuickJumper:!0,showTitle:!1,showTotal:a=>`å…± ${a} é¡µ`})}),e.jsx("div",{style:{padding:"20px",display:"flex",justifyContent:"center",flex:1},children:p[c-1]&&j(p[c-1],c-1)})]})}),!d&&t.length>0&&e.jsx("div",{style:{position:"absolute",bottom:20,left:20,right:20},children:e.jsx(K,{message:"æ— æ³•ç”ŸæˆPDF",description:r?"è¯·æ£€æŸ¥è®¾ç½®å’Œå¡ç»„æ•°æ®":"è¯·å…ˆé€‰æ‹©åŒ…å«å¡ç‰‡å›¾ç‰‡çš„æ–‡ä»¶å¤¹",type:"warning",showIcon:!0})})]})},Zi=()=>{const[t,i]=x.useState({cards:[],layout:Ui(),imageFolder:null,imageStatus:{total:0,loaded:0,missing:[],isProcessing:!1},pdfPages:[],isGenerating:!1});x.useEffect(()=>{Gi()},[]);const l=x.useCallback(c=>{i(h=>({...h,layout:c}))},[]),n=x.useCallback(async c=>{t.cards.length>0&&Oi(t.cards),i(h=>({...h,cards:c,imageStatus:{total:c.length,loaded:0,missing:[],isProcessing:!1}})),c.length>0&&t.imageFolder&&await s(c,t.imageFolder)},[t.imageFolder,t.cards]),r=x.useCallback(async()=>{try{if(!("showDirectoryPicker"in window)){W.error("æ‚¨çš„æµè§ˆå™¨ä¸æ”¯æŒæ–‡ä»¶å¤¹é€‰æ‹©åŠŸèƒ½ï¼Œè¯·ä½¿ç”¨æœ€æ–°ç‰ˆChromeæˆ–Edgeæµè§ˆå™¨");return}const c=await window.showDirectoryPicker();i(h=>({...h,imageFolder:c})),t.cards.length>0&&await s(t.cards,c),W.success("å›¾ç‰‡æ–‡ä»¶å¤¹é€‰æ‹©æˆåŠŸ")}catch(c){c.name!=="AbortError"&&(console.error("é€‰æ‹©æ–‡ä»¶å¤¹å¤±è´¥:",c),W.error("é€‰æ‹©æ–‡ä»¶å¤¹å¤±è´¥"))}},[t.cards]),s=x.useCallback(async(c,h)=>{i(u=>({...u,imageStatus:{...u.imageStatus,isProcessing:!0}}));try{const u=await Mi(h,c,(g,f,y)=>{i(w=>({...w,imageStatus:{total:f,loaded:g,missing:y,isProcessing:g<f}}))});i(g=>({...g,cards:u,imageStatus:{...g.imageStatus,isProcessing:!1}}));const p=u.filter(g=>g.hasImage).length;W.success(`å›¾ç‰‡åŠ è½½å®Œæˆï¼Œæ‰¾åˆ° ${p}/${c.length} å¼ å¡ç‰‡å›¾ç‰‡`)}catch(u){console.error("åŠ è½½å›¾ç‰‡å¤±è´¥:",u),W.error("åŠ è½½å›¾ç‰‡å¤±è´¥: "+u.message),i(p=>({...p,imageStatus:{...p.imageStatus,isProcessing:!1}}))}},[]),o=x.useCallback(async()=>{if(t.cards.length===0){W.warning("è¯·å…ˆå¯¼å…¥å¡ç»„æ•°æ®");return}if(!t.imageFolder){W.warning("è¯·å…ˆé€‰æ‹©å›¾ç‰‡æ–‡ä»¶å¤¹");return}i(c=>({...c,isGenerating:!0}));try{const c=await Bi(t.cards,t.layout,(p,g,f)=>{console.log(`PDFç”Ÿæˆè¿›åº¦: ${f} ${p}/${g}`)}),u=`yugioh_cards_${new Date().toISOString().slice(0,19).replace(/[:-]/g,"")}.pdf`;Ni(c,u),W.success("PDFç”ŸæˆæˆåŠŸ")}catch(c){console.error("PDFç”Ÿæˆå¤±è´¥:",c),W.error("PDFç”Ÿæˆå¤±è´¥: "+c.message)}finally{i(c=>({...c,isGenerating:!1}))}},[t.cards,t.layout,t.imageFolder]);return e.jsxs("div",{className:"app-container",children:[e.jsx(ui,{layout:t.layout,onChange:l}),e.jsx(Qi,{cards:t.cards,layout:t.layout,isGenerating:t.isGenerating,onGeneratePdf:o,hasImageFolder:!!t.imageFolder}),e.jsx(Li,{cards:t.cards,imageStatus:t.imageStatus,onCardsChange:n,onImageFolderSelect:r,hasImageFolder:!!t.imageFolder}),t.isGenerating&&e.jsx("div",{style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},children:e.jsxs("div",{style:{backgroundColor:"white",padding:"30px",borderRadius:"8px",textAlign:"center",minWidth:"300px"},children:[e.jsx(Se,{type:"circle",percent:0}),e.jsx("div",{style:{marginTop:"16px",fontSize:"16px"},children:"æ­£åœ¨ç”ŸæˆPDFæ–‡ä»¶..."}),e.jsx("div",{style:{marginTop:"8px",color:"#666",fontSize:"14px"},children:"è¯·ç¨å€™ï¼Œè¿™å¯èƒ½éœ€è¦å‡ åˆ†é’Ÿæ—¶é—´"})]})})]})};Pe.createRoot(document.getElementById("root")).render(e.jsx(J.StrictMode,{children:e.jsx(At,{locale:ci,children:e.jsx(Zi,{})})}));
